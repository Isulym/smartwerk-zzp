<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>📬 Payment Reminder - SmartWerk</title>
  <link rel="stylesheet" href="style-payment-reminder.css"/>
</head>
<body>
  <div class="container">
    <header>
      <h1>📬 Payment Reminder</h1>
      <p class="muted">Send professional reminders for unpaid invoices. Use AI assistance, export to PDF, or send by email.</p>
    </header>

    <!-- 1. Business Info -->
    <section>
      <h2>🧾 Business Info (From)</h2>
      <input type="text" id="businessName" placeholder="Business Name">
      <input type="text" id="senderName" placeholder="Your Name">
      <input type="email" id="senderEmail" placeholder="Your Email">
      <input type="text" id="senderIBAN" placeholder="IBAN">
      <input type="text" id="senderAddress" placeholder="Address">
    </section>

    <!-- 2. Client Info -->
    <section>
      <h2>👤 Client Info (To)</h2>
      <input type="text" id="clientName" placeholder="Client Name">
      <input type="email" id="clientEmail" placeholder="Client Email">
      <input type="text" id="clientAddress" placeholder="Client Address">
    </section>

    <!-- 3. Invoice Details -->
    <section>
      <h2>📄 Invoice Details</h2>
      <input type="text" id="invoiceNumber" placeholder="Invoice Number">
      <input type="date" id="invoiceDate" placeholder="Invoice Date">
      <input type="date" id="dueDate" placeholder="Due Date">
      <input type="number" id="amountDue" placeholder="Amount Due (€)">
    </section>

    <!-- 4. Status & Countdown -->
    <section>
      <h2>🎯 Reminder Type</h2>
      <select id="reminderStatus">
        <option value="first">⏳ First Reminder</option>
        <option value="second">⚠️ Second Notice</option>
        <option value="final">❗ Final Reminder</option>
      </select>
      <p id="countdownNotice"></p>
    </section>

    <!-- 5. Body Message -->
    <section>
      <h2>💬 Message Body</h2>
      <textarea id="messageBody" placeholder="Message to the client..."></textarea>
      <div class="tone-controls">
        <button id="makeStrict">🧠 Make it more strict</button>
        <button id="makeFriendly">🤝 Make it more friendly</button>
      </div>
    </section>

    <!-- 6. Date & Location -->
    <section>
      <h2>📅 Date & Location</h2>
      <input type="text" id="city" placeholder="City">
      <input type="date" id="currentDate">
    </section>

    <!-- 7. Signature -->
    <section>
      <h2>✍️ Signature</h2>
      <input type="text" id="signatureName" placeholder="Your Full Name">
      <input type="text" id="signatureRole" placeholder="Position (optional)">
      <input type="text" id="signatureContact" placeholder="Phone or Email (optional)">
    </section>

    <!-- 8. Payment Link -->
    <section>
      <h2>💳 Payment</h2>
      <input type="url" id="paymentLink" placeholder="Payment Link (PayPal, Mollie, etc.)">
      <button id="payNowBtn">💳 Pay Now</button>
    </section>

    <!-- 9. Attach Invoice -->
    <section>
      <h2>📥 Attach Original Invoice</h2>
      <input type="file" id="invoiceFile">
      <p id="attachedFileName"></p>
    </section>

    <!-- ACTION BUTTONS -->
    <section class="actions">
      <button id="aiFill">🤖 AI Fill</button>
      <button id="loadExample">📂 Load Example</button>
      <button id="translate">🌐 Translate</button>
      <button id="saveReminder">💾 Save</button>
      <button id="savedReminders">📬 Saved Reminders</button>
      <button id="previewEmail">🔐 Preview</button>
      <button id="printReminder">🖨️ Print</button>
      <button id="sendEmail">📤 Send via Email</button>
      <button id="exportPDF">📄 Export as PDF</button>
    </section>

    <!-- Footer -->
    <footer>
      <p class="muted">SmartWerk — smartwerk.nl | PRO features available</p>
    </footer>
  </div>

  <script>


    // payment-reminder.js — SmartWerk

document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("reminderForm");

  // Elements
  const aiBtn = document.getElementById("aiFillBtn");
  const exampleBtn = document.getElementById("loadExampleBtn");
  const translateBtn = document.getElementById("translateBtn");
  const saveBtn = document.getElementById("saveBtn");
  const savedBtn = document.getElementById("viewSavedBtn");
  const printBtn = document.getElementById("printBtn");
  const pdfBtn = document.getElementById("exportPDFBtn");
  const sendBtn = document.getElementById("sendBtn");
  const toneStrict = document.getElementById("toneStrictBtn");
  const toneFriendly = document.getElementById("toneFriendlyBtn");

  const dueDate = document.getElementById("dueDate");
  const countdown = document.getElementById("countdown");
  const reminderStatus = document.getElementById("reminderStatus");

  // Autofill date
  document.getElementById("todayDate").value = new Date().toISOString().slice(0, 10);

  function updateCountdown() {
    const due = new Date(dueDate.value);
    const today = new Date();
    const diffTime = due - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    if (!dueDate.value) {
      countdown.textContent = "";
    } else if (diffDays > 0) {
      countdown.textContent = `💡 Due in ${diffDays} days`;
    } else if (diffDays === 0) {
      countdown.textContent = `⚠️ Due today`;
    } else {
      countdown.textContent = `⚠️ Overdue by ${Math.abs(diffDays)} days`;
    }
  }

  dueDate.addEventListener("change", updateCountdown);
  updateCountdown();

  aiBtn.addEventListener("click", () => {
    const invoiceNumber = document.getElementById("invoiceNumber").value || "INV-2025-001";
    const dueDate = document.getElementById("dueDate").value || "01/09/2025";
    const amountDue = document.getElementById("amountDue").value || "€500";

    const body = `This is a friendly reminder that invoice ${invoiceNumber} was due on ${dueDate}. Please arrange payment of ${amountDue} at your earliest convenience.`;
    const messageBody = document.getElementById("emailBody");
    messageBody.value = body;
    messageBody.classList.add("ai-filled");
  });

  exampleBtn.addEventListener("click", () => {
    document.getElementById("companyName").value = "SmartWerk B.V.";
    document.getElementById("fromName").value = "John Smart";
    document.getElementById("fromEmail").value = "john@smartwerk.nl";
    document.getElementById("fromIBAN").value = "NL12RABO1234567890";
    document.getElementById("fromAddress").value = "Eindhoven, Netherlands";

    document.getElementById("clientName").value = "Anna Client";
    document.getElementById("clientEmail").value = "anna@example.com";
    document.getElementById("clientAddress").value = "Utrecht, Netherlands";

    document.getElementById("invoiceNumber").value = "INV-2025-001";
    document.getElementById("invoiceDate").value = "2025-08-15";
    document.getElementById("dueDate").value = "2025-09-01";
    document.getElementById("amountDue").value = "€500";

    document.getElementById("emailBody").value = "This is a friendly reminder that invoice INV-2025-001 was due on 01/09/2025. Please arrange payment of €500.";
    document.getElementById("city").value = "Amsterdam";
    document.getElementById("signName").value = "John Smart";
    document.getElementById("signPosition").value = "Finance Manager";
    document.getElementById("signContact").value = "+31 612345678";
    document.getElementById("reminderStatus").value = "First Reminder";

    updateCountdown();
  });

  saveBtn.addEventListener("click", () => {
    const data = Object.fromEntries(new FormData(form));
    let saved = JSON.parse(localStorage.getItem("savedReminders") || "[]");
    saved.push(data);
    localStorage.setItem("savedReminders", JSON.stringify(saved));
    alert("✅ Reminder saved!");
  });

  savedBtn.addEventListener("click", () => {
    const saved = JSON.parse(localStorage.getItem("savedReminders") || "[]");
    if (!saved.length) return alert("No saved reminders yet.");
    const list = saved.map(r => `${r.invoiceNumber} — ${r.clientName} — ${r.dueDate}`).join("\n");
    alert("📬 Saved Reminders:\n\n" + list);
  });

  printBtn.addEventListener("click", () => window.print());

  sendBtn.addEventListener("click", () => {
    const to = document.getElementById("clientEmail").value;
    const subject = `Payment Reminder: ${document.getElementById("invoiceNumber").value}`;
    const body = document.getElementById("emailBody").value;
    const mailto = `mailto:${to}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.open(mailto, "_blank");
  });

  toneStrict.addEventListener("click", () => {
    const invoiceNumber = document.getElementById("invoiceNumber").value || "INV-2025-001";
    const dueDate = document.getElementById("dueDate").value || "01/09/2025";
    const amountDue = document.getElementById("amountDue").value || "€500";
    const body = `This is a final reminder regarding invoice ${invoiceNumber}, which was due on ${dueDate}. Immediate payment of ${amountDue} is required to avoid further action.`;
    const messageBody = document.getElementById("emailBody");
    messageBody.value = body;
    messageBody.classList.add("ai-filled");
  });

  toneFriendly.addEventListener("click", () => {
    aiBtn.click(); // Reuse AI fill
  });

  pdfBtn.addEventListener("click", async () => {
    const { jsPDF } = await import("https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js");
    const doc = new jsPDF();

    const get = id => document.getElementById(id)?.value || "-";
    let y = 20;

    const add = (title, content) => {
      doc.setFontSize(14);
      doc.setFont(undefined, "bold");
      doc.text(title, 14, y);
      y += 6;
      doc.setFontSize(12);
      doc.setFont(undefined, "normal");
      const lines = doc.splitTextToSize(content, 180);
      doc.text(lines, 14, y);
      y += lines.length * 6 + 4;
    };

    doc.setFontSize(18);
    doc.text("📬 Payment Reminder", 14, y);
    y += 10;

    add("🧾 From", `${get("companyName")}
${get("fromName")}
${get("fromEmail")}
${get("fromIBAN")}
${get("fromAddress")}`);
    add("👤 To", `${get("clientName")}
${get("clientEmail")}
${get("clientAddress")}`);
    add("📄 Invoice", `Number: ${get("invoiceNumber")}
Date: ${get("invoiceDate")}
Due: ${get("dueDate")}
Amount Due: ${get("amountDue")}`);
    add("💬 Message", get("emailBody"));
    add("📅 Date & City", `${get("todayDate")} — ${get("city")}`);
    add("✍️ Signature", `${get("signName")} (${get("signPosition")})
${get("signContact")}`);
    add("🔖 Status", get("reminderStatus"));

    doc.setFontSize(10);
    doc.setTextColor(150);
    doc.text("Generated with SmartWerk — smartwerk.nl", 14, 290);

    doc.save(`Payment-Reminder-${get("invoiceNumber")}.pdf`);
  });
});

    </script>
</body>
</html>
