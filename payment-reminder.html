<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üì¨ Payment Reminder - SmartWerk</title>
  <link rel="stylesheet" href="style-payment-reminder.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>üì¨ Payment Reminder</h1>
      <p class="muted">Send professional reminders for unpaid invoices. Use AI assistance, export to PDF, or send by email.</p>
    </header>

    <!-- 1. Business Info -->
   <section>
  <h2>üßæ Business Info (From)</h2>
  <input type="text" id="businessName" placeholder="Business Name" />
  <input type="text" id="businessEmail" placeholder="Your Email" />
  <input type="text" id="businessIBAN" placeholder="IBAN" />
  <input type="text" id="businessAddress" placeholder="Address" />
</section>
    <!-- 2. Client Info -->
    <section>
      <h2>üë§ Client Info (To)</h2>
      <input type="text" id="clientName" placeholder="Client Name">
      <input type="email" id="clientEmail" placeholder="Client Email">
      <input type="text" id="clientAddress" placeholder="Client Address">
    </section>

    <!-- 3. Invoice Details -->
    <section>
      <h2>üìÑ Invoice Details</h2>
      <input type="text" id="invoiceNumber" placeholder="Invoice Number">
      <input type="date" id="invoiceDate" placeholder="Invoice Date">
      <input type="date" id="dueDate" placeholder="Due Date">
      <input type="number" id="amountDue" placeholder="Amount Due (‚Ç¨)">
      <div id="dueCountdown" class="countdown-text"></div>
      <input type="text" id="paymentURL" placeholder="Payment Link (optional)">
    </section>

    <!-- 4. Status & Countdown -->
    <section>
      <h2>üéØ Reminder Type</h2>
      <select id="status">
        <option value="first">‚è≥ First Reminder</option>
        <option value="second">‚ö†Ô∏è Second Notice</option>
        <option value="final">‚ùó Final Reminder</option>
      </select>
      <p id="countdownNotice"></p>
    </section>

    <!-- 5. Body Message -->
    <section>
      <h2>üí¨ Message Body</h2>
      <textarea id="messageBody" placeholder="Message to the client..."></textarea>
      <div class="tone-controls">
        <button id="makeStrict">üß† Make it more strict</button>
        <button id="makeFriendly">ü§ù Make it more friendly</button>
      </div>
    </section>

    <!-- 6. Date & Location -->
    <section>
      <h2>üìÖ Date & Location</h2>
      <input type="text" id="city" placeholder="City">
      <input type="date" id="currentDate">
      <input type="date" id="todayDate" name="todayDate" />
    </section>

    <!-- 7. Signature -->
    <section>
      <h2>‚úçÔ∏è Signature</h2>
      <input type="text" id="signatureName" placeholder="Your Full Name">
      <input type="text" id="signatureRole" placeholder="Position (optional)">
      <input type="text" id="signatureContact" placeholder="Phone or Email (optional)">
    </section>

    <!-- 8. Payment Link -->
    <section>
      <h2>üí≥ Payment</h2>
      <input type="url" id="paymentLink" placeholder="Payment Link (PayPal, Mollie, etc.)">
      <button id="payNowBtn">üí≥ Pay Now</button>
    </section>

    <!-- 9. Attach Invoice -->
    <section>
      <h2>üì• Attach Original Invoice</h2>
      <input type="file" id="invoiceFile">
      <p id="attachedFileName"></p>
    </section>

    <!-- ACTION BUTTONS -->
    <section class="actions">
      <button id="aiFillBtn">ü§ñ AI Fill</button>
      <button id="loadExampleBtn">üìÇ Load Example</button>
      <button id="translateBtn">üåê Translate</button>
      <button id="saveBtn">üíæ Save</button>
      <button id="savedReminderbtn">üì¨ Saved Reminders</button>
      <button id="previewBtn">üîê Preview</button>
      <button id="printBtn">üñ®Ô∏è Print</button>
      <button id="sendBtn">üì§ Send via Email</button>
      <button id="pdfBtn">üìÑ Export as PDF</button>
    </section>

    <!-- Footer -->
    <footer>
      <p class="muted">SmartWerk ‚Äî smartwerk.nl | PRO features available</p>
    </footer>
  </div>

  <script>


    // payment-reminder.js ‚Äî SmartWerk

document.addEventListener("DOMContentLoaded", () => {
  const reminderForm = document.getElementById("reminderForm");
  const todayDate = new Date().toISOString().split("T")[0];
  document.getElementById("todayDate").value = todayDate;

  // === üìå Auto Countdown ===
  const dueDateField = document.getElementById("dueDate");
  const countdownField = document.getElementById("dueCountdown");
  function updateCountdown() {
    const due = new Date(dueDateField.value);
    const now = new Date();
    const diff = Math.floor((due - now) / (1000 * 60 * 60 * 24));
    if (isNaN(diff)) return (countdownField.textContent = "");
    if (diff < 0) countdownField.textContent = `‚ö†Ô∏è This invoice is overdue by ${-diff} days.`;
    else if (diff === 0) countdownField.textContent = "‚ö†Ô∏è Due today.";
    else countdownField.textContent = `üí° Due in ${diff} days.`;
  }
  dueDateField.addEventListener("input", updateCountdown);
  updateCountdown();

  // === ü§ñ AI Fill ===
  document.getElementById("aiFillBtn").addEventListener("click", () => {
  const name = document.getElementById("clientName").value || "your client";
  const invoice = document.getElementById("invoiceNumber").value || "INV-000";
  const due = document.getElementById("dueDate").value || "some date";
  const amount = document.getElementById("amountDue").value || "‚Ç¨___";

  const body = `This is a polite reminder that invoice ${invoice} due on ${due} is still pending. Please arrange the payment of ‚Ç¨${amount} as soon as possible. Thank you, ${name}.`;

  const msgEl = document.getElementById("messageBody");
  msgEl.value = body;
  msgEl.classList.add("ai-filled");
});

  // === üìÇ Load Example ===
  document.getElementById("loadExampleBtn").addEventListener("click", () => {
    document.getElementById("businessName").value = "SmartWerk B.V.";
    document.getElementById("businessEmail").value = "info@smartwerk.nl";
    document.getElementById("businessIBAN").value = "NL91ABNA0417164300";
    document.getElementById("businessAddress").value = "Stationsstraat 12, 5211BN Den Bosch";

    document.getElementById("clientName").value = "John Client";
    document.getElementById("clientEmail").value = "john@example.com";
    document.getElementById("clientAddress").value = "Keizersgracht 123, 1015CJ Amsterdam";

    document.getElementById("invoiceNumber").value = "INV-2025-001";
    document.getElementById("invoiceDate").value = "2025-08-01";
    document.getElementById("dueDate").value = "2025-09-01";
    document.getElementById("amountDue").value = 500; // ‚úÖ —Ç—ñ–ª—å–∫–∏ —á–∏—Å–ª–æ

    document.getElementById("messageBody").value = "This is a friendly reminder that invoice #INV-2025-001 was due on 01/09/2025. Please arrange payment of ‚Ç¨500 at your earliest convenience.";
    document.getElementById("messageBody").classList.add("ai-filled");
    updateCountdown();
  });

  // === üåê Translate ===
 document.getElementById("translateBtn").addEventListener("click", async () => {
  const msgEl = document.getElementById("messageBody");
  const text = msgEl.value.trim();

  if (!text) return alert("No message to translate.");

  // –ü—Ä–æ—Å—Ç–∞ –ª–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è EN/NL (–µ–º–æ—Ü—ñ–π–Ω–∞ —Å–∏–º—É–ª—è—Ü—ñ—è)
  const isEnglish = /invoice|please|payment|reminder/i.test(text);
  if (isEnglish) {
    msgEl.value = `Dit is een vriendelijke herinnering dat factuur ${document.getElementById("invoiceNumber").value} vervaldatum ${document.getElementById("dueDate").value} nog openstaat. Gelieve het bedrag van ‚Ç¨${document.getElementById("amountDue").value} zo snel mogelijk te betalen.`;
  } else {
    msgEl.value = `This is a friendly reminder that invoice ${document.getElementById("invoiceNumber").value} with due date ${document.getElementById("dueDate").value} is still unpaid. Kindly settle the amount of ‚Ç¨${document.getElementById("amountDue").value} as soon as possible.`;
  }

  msgEl.classList.add("ai-filled");
});

  // === üíæ Save ===
  document.getElementById("saveBtn").addEventListener("click", () => {
    const reminder = {
      businessName: document.getElementById("businessName").value,
      businessEmail: document.getElementById("businessEmail").value,
      businessIBAN: document.getElementById("businessIBAN").value,
      businessAddress: document.getElementById("businessAddress").value,
      clientName: document.getElementById("clientName").value,
      clientEmail: document.getElementById("clientEmail").value,
      clientAddress: document.getElementById("clientAddress").value,
      invoiceNumber: document.getElementById("invoiceNumber").value,
      invoiceDate: document.getElementById("invoiceDate").value,
      dueDate: document.getElementById("dueDate").value,
      amountDue: document.getElementById("amountDue").value,
      messageBody: document.getElementById("messageBody").value,
      todayDate: document.getElementById("todayDate").value,
      city: document.getElementById("city").value,
      signatureName: document.getElementById("signatureName").value,
      signatureRole: document.getElementById("signatureRole").value,
      signatureContact: document.getElementById("signatureContact").value,
      paymentURL: document.getElementById("paymentURL").value,
      status: document.getElementById("status").value,
    };
    const key = `reminder-${reminder.invoiceNumber}`;
    localStorage.setItem(key, JSON.stringify(reminder));
    alert("üíæ Reminder saved!");
  });

  // === üì¨ View Saved Reminders ===
  document.getElementById("savedReminderbtn").addEventListener("click", () => {
  const container = document.createElement("div");
  container.style.position = "fixed";
  container.style.top = "10%";
  container.style.left = "50%";
  container.style.transform = "translateX(-50%)";
  container.style.background = "#1c1f2b";
  container.style.color = "#fff";
  container.style.padding = "20px";
  container.style.borderRadius = "12px";
  container.style.zIndex = 9999;
  container.style.maxHeight = "80vh";
  container.style.overflowY = "auto";
  container.style.boxShadow = "0 0 10px rgba(0,0,0,0.6)";

  const list = Object.keys(localStorage)
    .filter(k => k.startsWith("reminder-"))
    .map(k => {
      const reminder = JSON.parse(localStorage.getItem(k));
      return `<li>
        <b>${reminder.invoiceNumber}</b> ‚Äî ${reminder.clientName}<br>
        <button onclick="loadReminder('${k}')">Load</button>
        <button onclick="deleteReminder('${k}', this)">Delete</button>
      </li>`;
    }).join("");

  container.innerHTML = `
    <h3>üì¨ Saved Reminders</h3>
    <ul style="list-style:none;padding:0;">${list || "<li>No reminders found.</li>"}</ul>
    <button onclick="this.parentElement.remove()">‚ùå Close</button>
  `;

  document.body.appendChild(container);
});

// –§—É–Ω–∫—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è reminder
function loadReminder(key) {
  const reminder = JSON.parse(localStorage.getItem(key));
  for (let field in reminder) {
    const el = document.getElementById(field);
    if (el) el.value = reminder[field];
  }
  alert("üîÑ Reminder loaded!");
}

// –§—É–Ω–∫—Ü—ñ—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è reminder
function deleteReminder(key, btn) {
  if (confirm("Delete this reminder?")) {
    localStorage.removeItem(key);
    btn.parentElement.remove();
  }
}

  // === üñ®Ô∏è Print ===
  document.getElementById("printBtn").addEventListener("click", () => window.print());

  // === üì§ Send via Email ===
  document.getElementById("sendBtn").addEventListener("click", () => {
  const toEmail = document.getElementById("clientEmail").value;
  const subject = `Payment Reminder: ${document.getElementById("invoiceNumber").value}`;
  const body = document.getElementById("messageBody").value;
  const status = document.getElementById("status").value;
  const days = document.getElementById("dueCountdown").innerText;
  const amount = document.getElementById("amountDue").value;
  const payURL = document.getElementById("paymentURL").value;
  const city = document.getElementById("city").value;
  const date = document.getElementById("todayDate").value;
  const name = document.getElementById("signatureName").value;
  const role = document.getElementById("signatureRole").value;
  const contact = document.getElementById("signatureContact").value;

  if (!toEmail || !body) {
    alert("Please fill in client email and message body.");
    return;
  }

  let statusLabel = {
    first: "üîµ First Reminder",
    second: "üü† Second Notice",
    final: "üî¥ Final Reminder"
  }[status] || "Reminder";

  const previewHTML = `
    <div style="font-family:sans-serif; max-width:600px; margin:auto; padding:20px; border:1px solid #ccc; border-radius:10px;">
      <h2 style="color:#3b79ff;">üì¨ ${statusLabel}</h2>
      <p><strong>To:</strong> ${toEmail}</p>
      <p><strong>Subject:</strong> ${subject}</p>

      <div style="background:#f9f9f9; padding:15px; border-radius:8px; margin-top:10px; white-space:pre-line;">
        ${body}
      </div>

      <p style="margin-top:20px;">
        üí∂ <strong>Amount Due:</strong> ‚Ç¨${amount}<br>
        ‚è≥ <strong>Status:</strong> ${days}<br>
        ${payURL ? `üí≥ <strong>Pay Now:</strong> <a href="${payURL}" target="_blank">${payURL}</a><br>` : ""}
      </p>

      <hr style="margin:30px 0;">
      <p>
        ${city}, ${date}<br>
        üñãÔ∏è <strong>${name}</strong><br>
        ${role ? role + "<br>" : ""}
        ${contact ? contact + "<br>" : ""}
      </p>
    </div>
  `;

  const win = window.open("", "_blank", "width=800,height=700");
  win.document.write(previewHTML);
  win.document.close();
});

  // === üîê Preview Email ===
  document.getElementById("previewBtn").addEventListener("click", () => {
  const preview = document.getElementById("messageBody").value;
  document.getElementById("previewMessage").innerText = "üì¨ Preview:\n\n" + preview;
  document.getElementById("previewModal").style.display = "flex";
});

function closePreview() {
  document.getElementById("previewModal").style.display = "none";
}

function printPreview() {
  const preview = document.getElementById("messageBody").value;
  const printWindow = window.open('', '_blank');
  printWindow.document.write(`<pre style="font-family: sans-serif; font-size: 18px; padding: 20px;">${preview}</pre>`);
  printWindow.document.close();
  printWindow.print();
}

  // === üìÑ Export as PDF ===
  document.getElementById("pdfBtn").addEventListener("click", async () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    let y = 20;
    const get = (id) => document.getElementById(id).value || "-";

    doc.setFontSize(18);
    doc.text("üì¨ Payment Reminder", 14, y);
    y += 10;

    const sections = [
      ["üßæ Business Info", `${get("businessName")}
${get("businessEmail")}
${get("businessIBAN")}
${get("businessAddress")}`],
      ["üë§ Client Info", `${get("clientName")}
${get("clientEmail")}
${get("clientAddress")}`],
      ["üìÑ Invoice Details", `Invoice #: ${get("invoiceNumber")}
Invoice Date: ${get("invoiceDate")}
Due Date: ${get("dueDate")}
Amount Due: ${get("amountDue")}`],
      ["üí¨ Message", get("messageBody")],
      ["üìÖ Date & Location", `${get("todayDate")} ‚Äî ${get("city")}`],
      ["‚úçÔ∏è Signature", `${get("signatureName")}
${get("signatureRole")}
${get("signatureContact")}`],
      ["üé® Status", get("status")],
    ];

    for (const [title, content] of sections) {
      doc.setFontSize(14);
      doc.setFont(undefined, "bold");
      doc.text(title, 14, y);
      y += 6;
      doc.setFontSize(12);
      doc.setFont(undefined, "normal");
      const lines = doc.splitTextToSize(content, 180);
      doc.text(lines, 14, y);
      y += lines.length * 6 + 4;
    }

    doc.setFontSize(10);
    doc.setTextColor(150);
    doc.text("Generated with SmartWerk ‚Äî smartwerk.nl", 14, 290);

    doc.save(`Payment-Reminder-${get("invoiceNumber")}.pdf`);
  });
});

document.getElementById("pdfBtn").addEventListener("click", async () => {
  const {
    jsPDF
  } = window.jspdf;
  const doc = new jsPDF();

  const businessName = document.getElementById("businessName").value;
  const businessEmail = document.getElementById("businessEmail").value;
  const businessIBAN = document.getElementById("businessIBAN").value;
  const businessAddress = document.getElementById("businessAddress").value;

  const clientName = document.getElementById("clientName").value;
  const clientEmail = document.getElementById("clientEmail").value;
  const clientAddress = document.getElementById("clientAddress").value;

  const invoiceNumber = document.getElementById("invoiceNumber").value;
  const invoiceDate = document.getElementById("invoiceDate").value;
  const dueDate = document.getElementById("dueDate").value;
  const amountDue = document.getElementById("amountDue").value;
  const messageBody = document.getElementById("messageBody").value;

  const todayDate = document.getElementById("todayDate").value;
  const city = document.getElementById("city").value;
  const signatureName = document.getElementById("signatureName").value;
  const signatureRole = document.getElementById("signatureRole").value;
  const signatureContact = document.getElementById("signatureContact").value;

  const paymentURL = document.getElementById("paymentURL").value;
  const status = document.getElementById("status").value;

  // === Header ===
  doc.setFontSize(18);
  doc.text("Payment Reminder", 14, 20);

  doc.setFontSize(12);
  doc.text(`Reminder Type: ${status}`, 14, 28);
  doc.text(`Invoice: ${invoiceNumber}`, 14, 34);
  doc.text(`Due Date: ${dueDate}`, 14, 40);
  doc.text(`Amount Due: ‚Ç¨${amountDue}`, 14, 46);

  // === Business Info ===
  doc.setFontSize(14);
  doc.text("Business Info", 14, 58);
  doc.setFontSize(11);
  doc.text(`${businessName}`, 14, 64);
  doc.text(`${businessEmail}`, 14, 70);
  doc.text(`IBAN: ${businessIBAN}`, 14, 76);
  doc.text(`${businessAddress}`, 14, 82);

  // === Client Info ===
  doc.setFontSize(14);
  doc.text("Client Info", 105, 58);
  doc.setFontSize(11);
  doc.text(`${clientName}`, 105, 64);
  doc.text(`${clientEmail}`, 105, 70);
  doc.text(`${clientAddress}`, 105, 76);

  // === Message ===
  doc.setFontSize(13);
  doc.text("Message:", 14, 95);
  doc.setFontSize(11);
  doc.text(doc.splitTextToSize(messageBody, 180), 14, 102);

  // === Signature ===
  doc.setFontSize(11);
  doc.text(`\n\n\nSincerely,\n${signatureName}`, 14, 160);
  if (signatureRole) doc.text(`${signatureRole}`, 14, 167);
  if (signatureContact) doc.text(`${signatureContact}`, 14, 172);

  // === Location & Date ===
  doc.setFontSize(10);
  doc.text(`Signed in ${city || "___"} on ${todayDate || "___"}`, 14, 182);

  // === Payment Link (if exists)
  if (paymentURL) {
    doc.setFontSize(11);
    doc.setTextColor(0, 0, 255);
    doc.textWithLink("üí≥ Pay Now", 14, 192, { url: paymentURL });
    doc.setTextColor(0, 0, 0);
  }

  // === Footer ===
  doc.setFontSize(9);
  doc.text("SmartWerk.nl ‚Äî All rights reserved", 14, 290);

  // === Save file ===
  doc.save(`Reminder-${invoiceNumber}.pdf`);
});

    function loadReminder(key) {
  const reminder = JSON.parse(localStorage.getItem(key));
  if (!reminder) return alert("Reminder not found!");

  document.getElementById("businessName").value = reminder.businessName;
  document.getElementById("businessEmail").value = reminder.businessEmail;
  document.getElementById("businessIBAN").value = reminder.businessIBAN;
  document.getElementById("businessAddress").value = reminder.businessAddress;

  document.getElementById("clientName").value = reminder.clientName;
  document.getElementById("clientEmail").value = reminder.clientEmail;
  document.getElementById("clientAddress").value = reminder.clientAddress;

  document.getElementById("invoiceNumber").value = reminder.invoiceNumber;
  document.getElementById("invoiceDate").value = reminder.invoiceDate;
  document.getElementById("dueDate").value = reminder.dueDate;
  document.getElementById("amountDue").value = reminder.amountDue;
  document.getElementById("messageBody").value = reminder.messageBody;

  document.getElementById("todayDate").value = reminder.todayDate;
  document.getElementById("city").value = reminder.city;

  document.getElementById("signatureName").value = reminder.signatureName;
  document.getElementById("signatureRole").value = reminder.signatureRole;
  document.getElementById("signatureContact").value = reminder.signatureContact;

  document.getElementById("paymentURL").value = reminder.paymentURL;
  document.getElementById("status").value = reminder.status;

  alert("Reminder loaded!");
}

    function deleteReminder(key) {
  if (confirm("Are you sure you want to delete this reminder?")) {
    localStorage.removeItem(key);
    alert("Reminder deleted!");
    location.reload(); // –∞–±–æ –æ–Ω–æ–≤–∏ —Å–ø–∏—Å–æ–∫ –≤—Ä—É—á–Ω—É
  }
}
    
    </script>
</body>
</html>
