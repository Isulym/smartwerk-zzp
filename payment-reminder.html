<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Payment Reminder — SmartWerk</title>
  <link rel="stylesheet" href="style-payment-reminder.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>📈 Payment Reminder</h1>
    <p>Send professional reminders for unpaid invoices. Use AI assistance, export to PDF, or send by email.</p>

    <section>
      <h2>💼 Business Info (From)</h2>
      <input id="fromName" placeholder="Business Name" />
      <input id="fromEmail" placeholder="Business Email" />
      <input id="fromIBAN" placeholder="IBAN" />
      <input id="fromAddress" placeholder="Business Address" />
    </section>

    <section>
      <h2>👨‍💼 Client Info (To)</h2>
      <input id="clientName" placeholder="Client Name" />
      <input id="clientEmail" placeholder="Client Email" />
      <input id="clientAddress" placeholder="Client Address" />
    </section>

    <section>
      <h2>📄 Invoice Details</h2>
      <input id="reminderId" placeholder="Reminder ID (e.g., REM-2025-001)" readonly />
      <input id="invoiceNumber" placeholder="Invoice Number (e.g., INV-2025-001)" />
      <input id="invoiceDate" type="date" placeholder="Invoice Date" />
      <input id="dueDate" type="date" placeholder="Due Date" />
      <input id="amount" placeholder="Amount Due (e.g., 500)" />
      <select id="invoiceSelect">
     <option>Select from saved invoices...</option>
     </select>
    </section>

    <section>
      <h2>📣 Reminder Type</h2>
      <select id="reminderType">
        <option value="First Reminder">First Reminder</option>
        <option value="Second Notice">Second Notice</option>
        <option value="Final Reminder">Final Reminder</option>
      </select>
    </section>

    <section>
      <h2>💬 Message Body</h2>
      <textarea id="messageBody" rows="6" placeholder="Message..."></textarea>
      <div class="row">
        <button id="btn-strict">💬 Make it more strict</button>
        <button id="btn-friendly">👍 Make it more friendly</button>
      </div>
    </section>

    <section>
      <h2>🗓 Date & Location</h2>
      <input id="city" placeholder="City" />
      <input id="reminderDate" type="date" placeholder="Reminder Date" />
    </section>

    <section>
      <h2>✍️ Signature</h2>
      <input id="signatureName" placeholder="Your Name" />
      <input id="signaturePosition" placeholder="Position (optional)" />
      <input id="signatureEmail" placeholder="Your Email" />
    </section>

    <section>
      <h2>💳 Payment</h2>
      <input id="paymentLink" placeholder="Payment Link (PayPal, Mollie, etc.)" />
      <a id="btn-pay" class="btn-green" target="_blank">Pay Now</a>
    </section>

    <section>
      <h2>📧 Attach Original Invoice</h2>
      <input type="file" id="attachedFile" />
    </section>

    <div class="buttons">
      <button id="aiFillBtn">🤖 AI Fill</button>
      <button id="loadExampleBtn">Load Example</button>
      <button id="translateBtn">Translate</button>
      <button id="btn-save">📃 Save</button>
      <button id="btn-view-saved">📂 Saved Reminders</button>
      <button id="btn-preview">📅 Preview</button>
      <button id="btn-send-email">Send via Email</button>
      <button id="btn-export-pdf">📄 Export as PDF</button>
      <button id="btn-print">🖨 Print</button>
    </div>

    <div id="savedRemindersModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="document.getElementById('savedRemindersModal').style.display='none'">&times;</span>
        <h3>📂 Saved Reminders</h3>
        <div id="savedRemindersList"></div>
      </div>
    </div>

  </div>

  <script>

// payment-reminder.js (сумісний з останнім payment-reminder.html)

document.addEventListener("DOMContentLoaded", () => {
  const get = (id) => document.getElementById(id)?.value || "";
  const set = (id, val) => { const el = document.getElementById(id); if (el) el.value = val; };

  // ✅ Автоматична генерація Reminder ID (REM-2025-001)
  const reminderIdField = document.getElementById("reminderId");
  if (reminderIdField) {
    const savedReminders = JSON.parse(localStorage.getItem("savedReminders") || "[]");
    const year = new Date().getFullYear();
    let counter = 1;
    const used = savedReminders
      .map(r => parseInt((r.reminderId || "").split("-")[2]))
      .filter(n => !isNaN(n));
    if (used.length) counter = Math.max(...used) + 1;
    reminderIdField.value = `REM-${year}-${String(counter).padStart(3, "0")}`;
  }

  // ✅ Автоматична дата Reminder Date
  const reminderDate = document.getElementById("reminderDate");
  if (reminderDate) reminderDate.value = new Date().toISOString().slice(0, 10);

  // ✅ Dropdown збережених інвойсів
function populateInvoiceDropdown() {
  const invoiceSelect = document.getElementById("invoiceSelect");
  const invoices = JSON.parse(localStorage.getItem("invoices") || "[]");

  if (!invoiceSelect || invoices.length === 0) return;

  invoiceSelect.innerHTML = '<option>Select from saved invoices...</option>';

  invoices.forEach((inv, i) => {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = `${inv.invoiceNumber || `Invoice ${i + 1}`} — ${inv.clientName || "Client"}`;
    invoiceSelect.appendChild(opt);
  });

  invoiceSelect.addEventListener("change", () => {
    const selected = invoices[invoiceSelect.value];
    if (!selected) return;

    // Заповнення полів із обраного інвойсу
    document.getElementById("invoiceNumber").value = selected.invoiceNumber || "";
    document.getElementById("invoiceDate").value = selected.invoiceDate || "";
    document.getElementById("dueDate").value = selected.dueDate || "";
    document.getElementById("amount").value = selected.total || selected.amount || "";
    document.getElementById("clientName").value = selected.clientName || "";
    document.getElementById("clientEmail").value = selected.clientEmail || "";
    document.getElementById("clientAddress").value = selected.clientAddress || "";
    document.getElementById("businessName").value = selected.businessName || selected.businessName || "";
    document.getElementById("email").value = selected.email || selected.email || "";
    document.getElementById("businessAddress").value = selected.businessAddress || selected.businessAddress || "";
    document.getElementById("iban").value = selected.iban || selected.iban || "";
  });
}

// 🔃 Виклик функції
populateInvoiceDropdown();



 

  // ... додай інші кнопки тут (AI Fill, Save, Export PDF тощо) ...

  // AI Fill
  document.getElementById("aiFillBtn")?.addEventListener("click", () => {
    set("fromName", "SmartWerk B.V.");
    set("fromEmail", "info@smartwerk.nl");
    set("fromIBAN", "NL12BANK0123456789");
    set("fromAddress", "Stationsstraat 12, 5211 AB, Den Bosch");
    set("clientName", "John Doe");
    set("clientEmail", "john@example.com");
    set("clientAddress", "Clientstraat 5, 1011 AA Amsterdam");
    set("invoiceNumber", "INV-2025-001");
    set("invoiceDate", "2025-08-01");
    set("dueDate", "2025-08-15");
    set("amount", "500");
    set("city", "Den Bosch");
    set("signatureName", "Ihor Sulima");
    set("signaturePosition", "Founder");
    set("signatureEmail", "ihor@smartwerk.nl");
    set("paymentLink", "https://pay.smartwerk.nl/12345");
    set("messageBody", `Dear John,

This is a friendly reminder that invoice INV-2025-001, dated 01.08.2025 for the amount of €500, is still unpaid. Please make the payment as soon as possible.

Thank you.`);
    generateReminderId();
  });

  // Generate Reminder ID
  function generateReminderId() {
  const year = new Date().getFullYear();
  const saved = JSON.parse(localStorage.getItem("savedReminders") || "[]");

  let nextNumber = 1;
  const ids = saved
    .map(e => e.reminderId)
    .filter(id => id && id.startsWith(`REM-${year}-`))
    .map(id => parseInt(id.split("-")[2]))
    .filter(n => !isNaN(n));

  if (ids.length > 0) {
    nextNumber = Math.max(...ids) + 1;
  }

  const newId = `REM-${year}-${String(nextNumber).padStart(3, "0")}`;
  document.getElementById("reminderId").value = newId;
}

  // Translate
  document.getElementById("translateBtn")?.addEventListener("click", () => {
    const lang = prompt("Translate to (en/nl)?", "nl");
    if (lang === "nl") {
      set("messageBody", "Beste John,\n\nDit is een vriendelijke herinnering dat factuur INV-2025-001 van €500 nog niet is betaald. Gelieve zo snel mogelijk te betalen.\n\nDank u wel.");
    } else {
      set("messageBody", "Dear John,\n\nThis is a friendly reminder that invoice INV-2025-001 of €500 remains unpaid. Please pay soon.\n\nThank you.");
    }
  });

  // Friendly / Strict buttons
  document.getElementById("btn-friendly")?.addEventListener("click", () => {
    set("messageBody", "Hi John,\n\nJust a reminder about your unpaid invoice. Please process it soon.\nThanks!");
  });
  document.getElementById("btn-strict")?.addEventListener("click", () => {
    set("messageBody", "Final Notice: Your invoice remains unpaid. Pay immediately to avoid further actions.");
  });

  // Payment Link
  document.getElementById("paymentLink")?.addEventListener("input", (e) => {
    const link = e.target.value;
    const btn = document.getElementById("btn-pay");
    if (link && btn) {
      btn.href = link;
      btn.style.display = "inline-block";
    }
  });

  // Save Reminder
  document.getElementById("btn-save")?.addEventListener("click", () => {
    const reminders = JSON.parse(localStorage.getItem("savedReminders") || "[]");
    reminders.push({
      fromName: get("fromName"), fromEmail: get("fromEmail"), fromIBAN: get("fromIBAN"), fromAddress: get("fromAddress"),
      clientName: get("clientName"), clientEmail: get("clientEmail"), clientAddress: get("clientAddress"),
      invoiceNumber: get("invoiceNumber"), invoiceDate: get("invoiceDate"), dueDate: get("dueDate"),
      amount: get("amount"), reminderId: get("reminderId"), reminderType: get("reminderType"),
      messageBody: get("messageBody"), city: get("city"), reminderDate: get("reminderDate"),
      signatureName: get("signatureName"), signaturePosition: get("signaturePosition"), signatureEmail: get("signatureEmail"),
      paymentLink: get("paymentLink")
    });
    localStorage.setItem("savedReminders", JSON.stringify(reminders));
    alert("✅ Reminder saved!");
  });

  // View Saved
  document.getElementById("btn-view-saved")?.addEventListener("click", () => {
    const modal = document.getElementById("savedRemindersModal");
    const list = document.getElementById("savedRemindersList");
    const saved = JSON.parse(localStorage.getItem("savedReminders") || "[]");
    list.innerHTML = saved.map((r, i) => `
      <div class="email-entry">
        <strong>${r.reminderId}</strong> — ${r.clientName} (€${r.amount})<br/>
        <button onclick="loadReminder(${i})">Load</button>
        <button onclick="deleteReminder(${i})">Delete</button>
      </div>
    `).join("");
    modal.style.display = "block";
  });

  window.loadReminder = function(index) {
    const r = JSON.parse(localStorage.getItem("savedReminders") || "[]")[index];
    if (!r) return;
    for (let key in r) set(key, r[key]);
    document.getElementById("savedRemindersModal").style.display = "none";
  };

  window.deleteReminder = function(index) {
    const saved = JSON.parse(localStorage.getItem("savedReminders") || "[]");
    if (!confirm("Delete this reminder?")) return;
    saved.splice(index, 1);
    localStorage.setItem("savedReminders", JSON.stringify(saved));
    document.getElementById("btn-view-saved").click(); // Reload list
  };

  // Export PDF
  document.getElementById("btn-export-pdf")?.addEventListener("click", async () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    let y = 20;

    const addSection = (title, content) => {
      doc.setFontSize(14); doc.setFont(undefined, "bold"); doc.text(title, 14, y); y += 6;
      doc.setFontSize(12); doc.setFont(undefined, "normal");
      const lines = doc.splitTextToSize(content, 180);
      doc.text(lines, 14, y);
      y += lines.length * 6 + 4;
    };

    doc.setFontSize(18);
    doc.text("📈 Payment Reminder", 14, y);
    y += 10;

    addSection("From", `${get("fromName")}, ${get("fromEmail")}, ${get("fromAddress")}`);
    addSection("To", `${get("clientName")}, ${get("clientEmail")}, ${get("clientAddress")}`);
    addSection("Invoice", `Invoice #: ${get("invoiceNumber")}, Amount: €${get("amount")}, Due: ${get("dueDate")}`);
    addSection("Message", get("messageBody"));
    addSection("Signature", `${get("signatureName")} — ${get("signaturePosition")}\n${get("signatureEmail")}`);
    addSection("Reminder Date", `${get("reminderDate")} — ${get("city")}`);

    doc.setFontSize(10);
    doc.setTextColor(150);
    doc.text("Generated with SmartWerk — smartwerk.nl", 14, 290);

    doc.save(`Payment-Reminder-${get("invoiceNumber") || "SmartWerk"}.pdf`);
  });

  // Print
  document.getElementById("btn-print")?.addEventListener("click", () => {
    window.print();
  });

  // Preview
  document.getElementById("btn-preview")?.addEventListener("click", () => {
    alert("🔍 Preview coming soon — in next PRO version!");
  });
});


    
  </script>
</body>
</html>
