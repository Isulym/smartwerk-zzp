<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartWerk Invoice v3.0</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<!-- ‚úÖ Step 1: Business & Client Info (–æ–±'—î–¥–Ω–∞–Ω–∏–π –±–ª–æ–∫) -->
<section class="step" id="step-1">
  <h2>üßæ Step 1: Business & Client Info</h2>
  <form id="invoiceInfoForm">
    <label>Business Name:
      <input type="text" id="businessName" required>
    </label><br>
    <label>KvK Number:
      <input type="text" id="kvk" required>
    </label><br>
    <label>IBAN:
      <input type="text" id="iban" required>
    </label><br>
    <label>Email:
      <input type="email" id="email" required>
    </label><br>
    <label>Client Name:
      <input type="text" id="clientName" required>
    </label><br>
    <label>Invoice Number:
      <input type="text" id="invoiceNumber" placeholder="INV-2025-001">
    </label><br>
    <label>Invoice Date:
      <input type="date" id="invoiceDate">
    </label><br>
    <label>Due Date:
      <input type="date" id="dueDate">
    </label><br>
    <label>Status:
      <select id="status">
        <option value="Draft">Draft</option>
        <option value="Sent">Sent</option>
        <option value="Paid">Paid</option>
      </select>
    </label><br><br>
    <button type="button" onclick="saveInvoiceInfo()">üíæ Save Info</button>
  </form>
</section>

  <!-- Step 2: Add Line Items -->
<section class="step" id="step-2">
  <table>
    <thead>
      <tr>
        <th>Description</th>
        <th>Qty</th>
        <th>Unit Price</th>
        <th>VAT (%)</th>
        <th>Total</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="itemsBody">
      <tr>
        <td><input type="text" class="desc" placeholder="Service Description"></td>
        <td><input type="number" class="qty" value="1" min="1"></td>
        <td><input type="number" class="price" value="0" step="0.01"></td>
        <td><input type="number" class="vat" value="21" step="1"></td>
        <td class="item-total">‚Ç¨0.00</td>
        <td><button onclick="this.parentElement.parentElement.remove(); updateTotals();">‚ùå</button></td>
      </tr>
    </tbody>
  </table>
  <button onclick="addItemRow()">‚ûï Add Item</button>
</section>

  <h3>üìÑ Saved Invoices</h3>
<ul id="invoiceList"></ul>
  <!-- Step 3: Summary & Export -->
<section class="step" id="step-3">
  <h2>üì§ Step 3: Summary & Export</h2>
  <div class="summary-box">
    <p>üè¢ Business: <span id="summaryBusinessName"></span></p>
    <p>üí≥ IBAN: <span id="summaryIBAN"></span> | KvK: <span id="summaryKVK"></span></p>
    <p>üìß Email: <span id="summaryEmail"></span></p>
    <p>üìÑ Invoice #: <span id="summaryInvoiceNumber"></span> | üóì Date: <span id="summaryInvoiceDate"></span> | üìÖ Due: <span id="summaryDueDate"></span></p>
    <p>üë§ Client: <span id="summaryClient"></span></p>
    <p>üßæ Status: <span id="summaryStatus"></span></p>
  </div>

  <button onclick="generatePDF()">üìÑ Export PDF</button>
</section>
  <!-- Step 5: Invoice Items Table -->
<h3>üìä Invoice Items</h3>
<table id="itemsTable" border="1" cellpadding="8" style="width: 100%; border-collapse: collapse">
  <thead>
    <tr>
      <th>Description</th>
      <th>Quantity</th>
      <th>Unit Price (‚Ç¨)</th>
      <th>VAT (%)</th>
      <th>Total (‚Ç¨)</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="itemsBody">
    <!-- Rows will be dynamically added here -->
  </tbody>
</table>
<br />
<button onclick="addItemRow()">‚ûï Add Item</button>
<p><strong>Total Amount (incl. VAT):</strong> <span id="invoiceTotalAmount">0.00</span> ‚Ç¨</p>


  <script>
    const form = document.getElementById('invoiceForm');
    const invoiceBody = document.getElementById('invoiceBody');

    function loadInvoices() {
      invoiceBody.innerHTML = '';
      const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
      invoices.forEach((invoice, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${invoice.clientName}</td>
          <td>${invoice.description}</td>
          <td>‚Ç¨${invoice.amount.toFixed(2)}</td>
          <td>${invoice.dueDate}</td>
          <td>${invoice.status}</td>
          <td>
            <button onclick="deleteInvoice(${index})">‚ùå Delete</button>
          </td>
        `;
        invoiceBody.appendChild(row);
      });
    }

    function deleteInvoice(index) {
      const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
      invoices.splice(index, 1);
      localStorage.setItem('invoices', JSON.stringify(invoices));
      loadInvoices();
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const newInvoice = {
        clientName: document.getElementById('clientName').value,
        description: document.getElementById('description').value,
        amount: parseFloat(document.getElementById('amount').value),
        dueDate: document.getElementById('dueDate').value,
        status: document.getElementById('status').value
      };
      const invoices = JSON.parse(localStorage.getItem('invoices')) || [];
      invoices.push(newInvoice);
      localStorage.setItem('invoices', JSON.stringify(invoices));
      form.reset();
      loadInvoices();
    });

    loadInvoices();
// –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫
function addInvoiceItem(description = "", quantity = 1, price = 0, vat = 21) {
  const tbody = document.getElementById("itemsBody");
  const row = document.createElement("tr");

  row.innerHTML = `
    <td><input type="text" value="${description}" class="desc"></td>
    <td><input type="number" value="${quantity}" min="1" class="qty" onchange="updateTotals()"></td>
    <td><input type="number" value="${price}" step="0.01" class="price" onchange="updateTotals()"></td>
    <td><input type="number" value="${vat}" step="0.01" class="vat" onchange="updateTotals()"></td>
    <td class="item-total">0.00</td>
    <td><button onclick="this.closest('tr').remove(); updateTotals();">‚ùå</button></td>
  `;

  tbody.appendChild(row);
  updateTotals();
}

// –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ —Å—É–º –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä—è–¥–∫–∞ + –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ Total
function updateTotals() {
  const rows = document.querySelectorAll("#itemsBody tr");
  let total = 0;

  rows.forEach(row => {
    const qty = parseFloat(row.querySelector(".qty").value) || 0;
    const price = parseFloat(row.querySelector(".price").value) || 0;
    const vat = parseFloat(row.querySelector(".vat").value) || 0;

    const subtotal = qty * price;
    const vatAmount = subtotal * (vat / 100);
    const itemTotal = subtotal + vatAmount;

    row.querySelector(".item-total").innerText = itemTotal.toFixed(2);
    total += itemTotal;
  });

  // –ü–æ–∫–∞–∑–∞—Ç–∏ –∑–∞–≥–∞–ª—å–Ω–∏–π –ø—ñ–¥—Å—É–º–æ–∫ (–º–æ–∂–Ω–∞ –≤—Å—Ç–∞–≤–∏—Ç–∏ –≤ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É Step)
  document.getElementById("invoiceTotalAmount").innerText = total.toFixed(2);
  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è Summary Preview
document.getElementById("summaryBusinessName").innerText = document.getElementById("businessName").value;
document.getElementById("summaryIBAN").innerText = document.getElementById("iban").value;
document.getElementById("summaryKvK").innerText = document.getElementById("kvk").value;
document.getElementById("summaryEmail").innerText = document.getElementById("email").value;
document.getElementById("summaryInvoiceNumber").innerText = document.getElementById("invoiceNumber").value;
document.getElementById("summaryInvoiceDate").innerText = document.getElementById("invoiceDate").value;
document.getElementById("summaryDueDate").innerText = document.getElementById("dueDate").value;
document.getElementById("summaryClient").innerText = document.getElementById("clientName").value;
}
  function saveInvoiceInfo() {
    const data = {
      businessName: document.getElementById("businessName").value,
      kvk: document.getElementById("kvk").value,
      iban: document.getElementById("iban").value,
      email: document.getElementById("email").value,
      clientName: document.getElementById("clientName").value,
      invoiceNumber: document.getElementById("invoiceNumber").value || "INV-" + new Date().getFullYear() + "-001",
      invoiceDate: document.getElementById("invoiceDate").value || new Date().toISOString().split("T")[0],
      dueDate: document.getElementById("dueDate").value || new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split("T")[0],
      status: document.getElementById("status").value
    };

    // Save to localStorage
    localStorage.setItem("currentInvoiceInfo", JSON.stringify(data));

    // Update summary block (Step 3)
    document.getElementById("summaryBusinessName").innerText = data.businessName;
    document.getElementById("summaryKVK").innerText = data.kvk;
    document.getElementById("summaryIBAN").innerText = data.iban;
    document.getElementById("summaryEmail").innerText = data.email;
    document.getElementById("summaryClient").innerText = data.clientName;
    document.getElementById("summaryInvoiceNumber").innerText = data.invoiceNumber;
    document.getElementById("summaryInvoiceDate").innerText = data.invoiceDate;
    document.getElementById("summaryDueDate").innerText = data.dueDate;
    document.getElementById("summaryStatus").innerText = data.status;

    alert("‚úÖ Invoice info saved!");
  }
    
    async function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // –î–∞–Ω—ñ
  const businessName = document.getElementById("businessName").value;
  const kvk = document.getElementById("kvk").value;
  const iban = document.getElementById("iban").value;
  const email = document.getElementById("email").value;
  const invoiceNumber = document.getElementById("invoiceNumber").value;
  const invoiceDate = document.getElementById("invoiceDate").value;
  const dueDate = document.getElementById("dueDate").value;
  const clientName = document.getElementById("clientName").value;

  const rows = document.querySelectorAll("#itemsBody tr");

  // –ü–æ—á–∞—Ç–æ–∫ PDF
  doc.setFontSize(16);
  doc.text("üßæ INVOICE", 20, 20);

  doc.setFontSize(10);
  doc.text(`Business: ${businessName}`, 20, 30);
  doc.text(`KvK: ${kvk} | IBAN: ${iban}`, 20, 36);
  doc.text(`Email: ${email}`, 20, 42);
  doc.text(`Invoice #: ${invoiceNumber}`, 140, 30);
  doc.text(`Date: ${invoiceDate}`, 140, 36);
  doc.text(`Due: ${dueDate}`, 140, 42);
  doc.line(20, 46, 190, 46);

  doc.text(`Bill To: ${clientName}`, 20, 54);
  doc.text("Description | Qty | Price | VAT% | Total", 20, 64);
  doc.line(20, 66, 190, 66);

  let y = 72;
  let grandTotal = 0;

  rows.forEach(row => {
    const desc = row.querySelector(".desc").value;
    const qty = parseFloat(row.querySelector(".qty").value) || 0;
    const price = parseFloat(row.querySelector(".price").value) || 0;
    const vat = parseFloat(row.querySelector(".vat").value) || 0;

    const subtotal = qty * price;
    const vatAmount = subtotal * vat / 100;
    const total = subtotal + vatAmount;
    grandTotal += total;

    doc.text(`${desc} | ${qty} | ‚Ç¨${price.toFixed(2)} | ${vat}% | ‚Ç¨${total.toFixed(2)}`, 20, y);
    y += 8;
  });

  doc.line(20, y, 190, y);
  y += 10;
  doc.setFontSize(12);
  doc.text(`Total: ‚Ç¨ ${grandTotal.toFixed(2)}`, 20, y);

  // Footer
  doc.setFontSize(9);
  doc.setTextColor(150);
  doc.text("SmartWerk Invoice Generator ‚Ä¢ www.smartwerk.nl", 20, 285);

  // Save
  doc.save(`SmartWerk_Invoice_${invoiceNumber}.pdf`);
}
    function saveInvoiceToStorage() {
  const invoice = {
    id: Date.now(),
    businessName: document.getElementById("businessName").value,
    kvk: document.getElementById("kvk").value,
    iban: document.getElementById("iban").value,
    email: document.getElementById("email").value,
    client: document.getElementById("clientName").value,
    invoiceNumber: document.getElementById("invoiceNumber").value,
    invoiceDate: document.getElementById("invoiceDate").value,
    dueDate: document.getElementById("dueDate").value,
    total: document.getElementById("invoiceTotalAmount").innerText
  };

  let saved = JSON.parse(localStorage.getItem("invoices")) || [];
  saved.push(invoice);
  localStorage.setItem("invoices", JSON.stringify(saved));
  showSavedInvoices();
}

// –ü–æ–∫–∞–∑ —É—Å—ñ—Ö –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —ñ–Ω–≤–æ–π—Å—ñ–≤
function showSavedInvoices() {
  const list = document.getElementById("invoiceList");
  list.innerHTML = "";

  const saved = JSON.parse(localStorage.getItem("invoices")) || [];

  saved.forEach((inv) => {
    const li = document.createElement("li");
    li.innerHTML = `
      <b>${inv.invoiceNumber}</b> ‚Äî ${inv.client} ‚Äî ‚Ç¨${inv.total}
      <button onclick="loadInvoice(${inv.id})">Edit</button>
      <button onclick="deleteInvoice(${inv.id})">Delete</button>
    `;
    list.appendChild(li);
  });
}

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ–Ω–≤–æ–π—Å—É –Ω–∞–∑–∞–¥ —É —Ñ–æ—Ä–º—É
function loadInvoice(id) {
  const saved = JSON.parse(localStorage.getItem("invoices")) || [];
  const invoice = saved.find(i => i.id === id);
  if (!invoice) return;

  document.getElementById("businessName").value = invoice.businessName;
  document.getElementById("kvk").value = invoice.kvk;
  document.getElementById("iban").value = invoice.iban;
  document.getElementById("email").value = invoice.email;
  document.getElementById("clientName").value = invoice.client;
  document.getElementById("invoiceNumber").value = invoice.invoiceNumber;
  document.getElementById("invoiceDate").value = invoice.invoiceDate;
  document.getElementById("dueDate").value = invoice.dueDate;

  updateTotals();
}

// –í–∏–¥–∞–ª–µ–Ω–Ω—è —ñ–Ω–≤–æ–π—Å—É
function deleteInvoice(id) {
  let saved = JSON.parse(localStorage.getItem("invoices")) || [];
  saved = saved.filter(i => i.id !== id);
  localStorage.setItem("invoices", JSON.stringify(saved));
  showSavedInvoices();
}

// –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
document.addEventListener("DOMContentLoaded", showSavedInvoices);
      function addItemRow() {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td><input type="text" class="desc" placeholder="Service Description"></td>
      <td><input type="number" class="qty" value="1" min="0"></td>
      <td><input type="number" class="price" value="0" min="0" step="0.01"></td>
      <td><input type="number" class="vat" value="21" min="0" step="0.01"></td>
      <td class="item-total">0.00</td>
      <td><button onclick="this.parentElement.parentElement.remove(); updateTotals();">‚ùå</button></td>
    `;
    document.getElementById('itemsBody').appendChild(row);
    updateTotals();

    const inputs = row.querySelectorAll('input');
    inputs.forEach(input => input.addEventListener('input', updateTotals));
  }
    // === SmartWerk Invoice Logic v3.0 ===

// Array to store invoices
let invoices = [];

// Function to save invoice
function saveInvoice() {
  const businessName = document.getElementById("businessName").value;
  const kvk = document.getElementById("kvk").value;
  const iban = document.getElementById("iban").value;
  const email = document.getElementById("email").value;
  const clientName = document.getElementById("clientName").value;
  const invoiceNumber = document.getElementById("invoiceNumber").value;
  const invoiceDate = document.getElementById("invoiceDate").value;
  const dueDate = document.getElementById("dueDate").value;
  const status = document.getElementById("status").value;
  
  const rows = document.querySelectorAll("#itemsBody tr");
  const items = [];

  rows.forEach(row => {
    const desc = row.querySelector(".desc").value;
    const qty = parseFloat(row.querySelector(".qty").value) || 0;
    const price = parseFloat(row.querySelector(".price").value) || 0;
    const vat = parseFloat(row.querySelector(".vat").value) || 0;
    const total = (qty * price) + ((qty * price) * (vat / 100));

    items.push({ desc, qty, price, vat, total });
  });

  const invoice = {
    businessName, kvk, iban, email, clientName,
    invoiceNumber, invoiceDate, dueDate, status, items
  };

  // Save to localStorage
  invoices.push(invoice);
  localStorage.setItem("invoices", JSON.stringify(invoices));
  updateInvoiceList();
  updateSummary(invoice);
}

// Update summary block
function updateSummary(invoice) {
  document.getElementById("summaryBusinessName").innerText = invoice.businessName;
  document.getElementById("summaryKVK").innerText = invoice.kvk;
  document.getElementById("summaryIBAN").innerText = invoice.iban;
  document.getElementById("summaryEmail").innerText = invoice.email;
  document.getElementById("summaryClient").innerText = invoice.clientName;
  document.getElementById("summaryInvoiceNumber").innerText = invoice.invoiceNumber;
  document.getElementById("summaryInvoiceDate").innerText = invoice.invoiceDate;
  document.getElementById("summaryDueDate").innerText = invoice.dueDate;
  document.getElementById("summaryStatus").innerText = invoice.status;

  // Total
  const total = invoice.items.reduce((sum, item) => sum + item.total, 0);
  document.getElementById("invoiceTotalAmount").innerText = total.toFixed(2);
}

// Load saved invoices
function updateInvoiceList() {
  const list = document.getElementById("invoiceList");
  list.innerHTML = "";
  invoices.forEach((inv, index) => {
    const li = document.createElement("li");
    li.innerHTML = `<strong>${inv.invoiceNumber}</strong> - ${inv.clientName} 
      <button onclick="editInvoice(${index})">‚úèÔ∏è</button> 
      <button onclick="deleteInvoice(${index})">‚ùå</button>`;
    list.appendChild(li);
  });
}

// Edit invoice
function editInvoice(index) {
  const inv = invoices[index];
  document.getElementById("businessName").value = inv.businessName;
  document.getElementById("kvk").value = inv.kvk;
  document.getElementById("iban").value = inv.iban;
  document.getElementById("email").value = inv.email;
  document.getElementById("clientName").value = inv.clientName;
  document.getElementById("invoiceNumber").value = inv.invoiceNumber;
  document.getElementById("invoiceDate").value = inv.invoiceDate;
  document.getElementById("dueDate").value = inv.dueDate;
  document.getElementById("status").value = inv.status;

  // Clear and re-populate rows
  const tbody = document.getElementById("itemsBody");
  tbody.innerHTML = "";
  inv.items.forEach(item => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><input type="text" class="desc" value="${item.desc}"></td>
      <td><input type="number" class="qty" value="${item.qty}" min="1"></td>
      <td><input type="number" class="price" value="${item.price}" step="0.01"></td>
      <td><input type="number" class="vat" value="${item.vat}" step="1"></td>
      <td class="item-total">${item.total.toFixed(2)}</td>
      <td><button onclick="this.parentElement.parentElement.remove(); updateTotals();">‚ùå</button></td>
    `;
    tbody.appendChild(row);
  });
  updateSummary(inv);
}

// Delete invoice
function deleteInvoice(index) {
  invoices.splice(index, 1);
  localStorage.setItem("invoices", JSON.stringify(invoices));
  updateInvoiceList();
}

// Load from localStorage on page load
window.onload = () => {
  const saved = JSON.parse(localStorage.getItem("invoices")) || [];
  invoices = saved;
  updateInvoiceList();
};
    
  </script>
</body>
</html>
