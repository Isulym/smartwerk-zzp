<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartWerk — Dashboard</title>
  <link rel="stylesheet" href="style-dashboard.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">🚀 SmartWerk</div>
      <div class="plan-box" id="planBox">Plan: <span id="planName">FREE</span> <div class="progress"><div id="planProgress"></div></div></div>
      <nav class="menu">
        <div class="accordion">
          <button class="accordion-btn">💰 Invoices</button>
          <div class="accordion-panel">
            <a href="invoice.html">📄 Create Invoice</a>
            <a href="invoices-list.html">📋 Saved Invoices</a>
          </div>

          <button class="accordion-btn">📑 Quotes</button>
          <div class="accordion-panel">
            <a href="quote-offer.html">📄 Create Quote</a>
            <a href="quote-offer-list.html">📋 Saved Quotes</a>
          </div>

          <button class="accordion-btn">📃 Contracts</button>
          <div class="accordion-panel">
            <a href="contract.html">📄 Create Contract</a>
            <a href="contract-list.html">📋 Saved Contracts</a>
          </div>

          <button class="accordion-btn">📬 Reminders</button>
          <div class="accordion-panel">
            <a href="payment-reminder.html">💸 Create Reminder</a>
            <a href="payment-reminder-list.html">📋 Saved Reminders</a>
          </div>

          <button class="accordion-btn">📂 Templates</button>
          <div class="accordion-panel">
            <a href="email-gemeente.html">📩 Email to Gemeente</a>
            <a href="cv.html">📄 CV / Portfolio</a>
            <a href="expense.csv">🧮 Expense CSV</a>
          </div>

          <button class="accordion-btn">📊 Analytics</button>
          <div class="accordion-panel">
            <a href="my-bookkeeper.html">🏆 My Bookkeeper</a>
            <a href="summary.html">📊 Summary</a>
            <a href="roi-estimator.html">🧮 ROI Estimator</a>
            <a href="tax-calculator.html">🧮 Tax Calculator</a>
          </div>

          <button class="accordion-btn">⚙️ Settings</button>
          <div class="accordion-panel">
            <a href="profile.html">👤 Profile</a>
          </div>
        </div>
      </nav>
      <button id="logoutBtn" class="logout">🚪 Logout</button>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="topbar">
        <h1 id="welcomeText">Welcome 👋</h1>
      </header>

      <!-- Quick Actions -->
      <section class="quick-actions">
        <button onclick="location.href='invoice.html'">➕ Invoice</button>
        <button onclick="location.href='quote-offer.html'">➕ Quote</button>
        <button onclick="location.href='contract.html'">➕ Contract</button>
        <button onclick="location.href='payment-reminder.html'">➕ Reminder</button>
      </section>

      <!-- KPI Cards -->
      <section class="kpi">
        <div class="card"><h3>Revenue</h3><p id="kpiRevenue">€0</p></div>
        <div class="card"><h3>Unpaid</h3><p id="kpiUnpaid">€0</p></div>
        <div class="card"><h3>Invoices This Month</h3><p id="kpiInvoices">0</p></div>
        <div class="card"><h3>Quotes Accepted %</h3><p id="kpiQuotes">0%</p></div>
        <div class="card"><h3>New Clients</h3><p id="kpiClients">0</p></div>
        <div class="card"><h3>Reminders Sent</h3><p id="kpiReminders">0</p></div>
      </section>

      <!-- Charts -->
      <section class="charts">
        <canvas id="revenueChart"></canvas>
        <canvas id="invoiceStatusChart"></canvas>
      </section>

      <!-- Smart Suggestions -->
      <section class="suggestions">
        <h2>💡 Smart Suggestions</h2>
        <ul id="suggestionList">
          <li>No suggestions yet.</li>
        </ul>
      </section>

      <!-- Recent Activity -->
      <section class="recent-activity">
        <h2>🕑 Recent Activity</h2>
        <ul id="activityList">
          <li>No recent activity.</li>
        </ul>
      </section>
    </main>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAp397Ax_jaMI85vOXicOi61g64HvvA_Kg",
      authDomain: "smartwerk8520.firebaseapp.com",
      projectId: "smartwerk8520",
      appId: "1:607670981972:web:c07103c981c86860d724c1",
    };
    const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    /* Accordion Sidebar */
    document.querySelectorAll(".accordion-btn").forEach(btn=>{
      btn.addEventListener("click",()=>{
        btn.classList.toggle("active");
        const panel=btn.nextElementSibling;
        panel.style.display = panel.style.display==="block" ? "none" : "block";
      });
    });

    /* Firebase User */
    onAuthStateChanged(auth, async(user)=>{
      if(!user){ location.href="login.html"; return; }
      const snap = await getDoc(doc(db,"users",user.uid));
      if(snap.exists()){
        const p=snap.data();
        document.getElementById("welcomeText").innerText=`Welcome, ${p.fullName||"User"} 👋`;

        // Plan
        const plan=p.plan||"FREE";
        document.getElementById("planName").innerText=plan;
        if(plan==="FREE"){
          const used=(p.usage||0);
          const limit=25;
          document.getElementById("planProgress").style.width=(used/limit*100)+"%";
        }else{
          document.getElementById("planProgress").style.width="100%";
        }
      }
    });

    /* Charts */
    const ctx1=document.getElementById("revenueChart");
    new Chart(ctx1,{type:"line",data:{labels:["Jan","Feb","Mar"],datasets:[{label:"Revenue",data:[500,1000,750],borderColor:"#3b82f6"}]}});
    const ctx2=document.getElementById("invoiceStatusChart");
    new Chart(ctx2,{type:"doughnut",data:{labels:["Paid","Unpaid","Draft"],datasets:[{data:[5,3,2],backgroundColor:["#22c55e","#ef4444","#64748b"]}]}});
    
    /* Logout */
    document.getElementById("logoutBtn").addEventListener("click",()=>signOut(auth));
  </script>
</body>
</html>
