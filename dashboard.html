<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartWerk â€” Dashboard</title>
  <link rel="stylesheet" href="style-dashboard.css"/>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">ğŸš€ SmartWerk</div>
    <nav>
      <h3>ğŸ’° Invoices</h3>
      <a href="invoice.html">ğŸ“„ Create Invoice</a>
      <a href="invoices-list.html">ğŸ“‹ Saved Invoices</a>

      <h3>ğŸ“‘ Quotes</h3>
      <a href="quote-offer.html">ğŸ“„ Create Quote</a>
      <a href="quote-offer-list.html">ğŸ“‹ Saved Quotes</a>

      <h3>ğŸ“ƒ Contracts</h3>
      <a href="contract.html">ğŸ“„ Create Contract</a>
      <a href="contract-list.html">ğŸ“‹ Saved Contracts</a>

      <h3>ğŸ“¬ Reminders</h3>
      <a href="payment-reminder.html">ğŸ’¸ Create Reminder</a>
      <a href="payment-reminder-list.html">ğŸ“‹ Saved Reminders</a>

      <h3>ğŸ“‚ Templates</h3>
      <a href="email-gemeente.html">ğŸ“© Email to Gemeente</a>
      <a href="cv.html">ğŸ“„ CV / Portfolio</a>

      <h3>ğŸ¤– AI Tools</h3>
      <a href="ai-assistant.html">ğŸ¤– AI Assistant (PRO)</a>

      <h3>ğŸ“Š Analytics</h3>
      <a href="my-bookkeeper.html">ğŸ† My Bookkeeper</a>
      <a href="summary.html">ğŸ“Š Summary</a>
      <a href="roi-estimator.html">ğŸ§® ROI Estimator</a>
      <a href="tax-calculator.html">ğŸ§® Tax Calculator</a>
      <a href="expense-csv.html">ğŸ§® Expense CSV</a>

      <h3>âš™ï¸ Settings</h3>
      <a href="profile.html">ğŸ‘¤ Profile</a>
    </nav>
    <button id="logoutBtn" class="logout">ğŸšª Logout</button>
  </aside>

  <!-- Main content -->
  <main class="content">
    <header class="topbar">
      <h1>SmartWerk â€” Dashboard</h1>
      <div id="planBadge" class="badge">FREE</div>
    </header>

    <!-- Profile Info -->
    <section class="card">
      <h2>ğŸ‘¤ Profile</h2>
      <p><strong>Name:</strong> <span id="pName">â€”</span></p>
      <p><strong>Email:</strong> <span id="pEmail">â€”</span></p>
      <p><strong>Address:</strong> <span id="pAddress">â€”</span></p>
      <p><strong>KvK:</strong> <span id="pKvK">â€”</span></p>
      <p><strong>IBAN:</strong> <span id="pIban">â€”</span></p>
      <p><strong>Phone:</strong> <span id="pPhone">â€”</span></p>
      <p><strong>Plan:</strong> <span id="pPlan">Free</span></p>
      <button onclick="location.href='profile.html'">Edit Profile</button>
      <button id="upgradeBtn" class="pro">Upgrade to PRO</button>
    </section>

    <!-- Plan & Limits -->
    <section class="card">
      <h2>ğŸ“Š Plan & Limits</h2>
      <p>Invoices created: <span id="invoiceCount">0</span></p>
      <p>Limit: <span id="invoiceLimit">3</span></p>
      <p>Status: <span id="planStatus">OK</span></p>
    </section>

    <!-- Notices -->
    <section class="card">
      <h2>ğŸ”” Notices</h2>
      <div id="notices">No new notifications.</div>
    </section>
  </main>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAp397Ax_jaMI85vOXicOi61g64HvvA_Kg",
      authDomain: "smartwerk8520.firebaseapp.com",
      projectId: "smartwerk8520",
      appId: "1:607670981972:web:c07103c981c86860d724c1",
    };
    const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    const $ = id => document.getElementById(id);

    async function loadProfile(uid){
      const snap = await getDoc(doc(db,"users",uid));
      if(!snap.exists()) return;
      const p = snap.data();

      $("pName").innerText = p.fullName || "â€”";
      $("pEmail").innerText = p.email || "â€”";
      $("pAddress").innerText = p.address || "â€”";
      $("pKvK").innerText = p.kvk || "â€”";
      $("pIban").innerText = p.iban || "â€”";
      $("pPhone").innerText = p.phone || "â€”";

      const plan = p.plan || "Free";
      $("pPlan").innerText = plan;
      $("planBadge").innerText = plan.toUpperCase();
      $("planBadge").className = "badge " + (plan==="Pro"?"pro":"free");

      $("invoiceLimit").innerText = (plan==="Pro") ? "Unlimited" : "25 / month";
    }

    async function loadInvoiceCount(uid){
      const snap = await getDocs(collection(db,"users",uid,"invoices"));
      $("invoiceCount").innerText = snap.size;
      const limit = $("invoiceLimit").innerText;
      if(limit!=="Unlimited" && snap.size >= 25){
        $("planStatus").innerText = "Limit Reached âŒ";
      } else {
        $("planStatus").innerText = "OK âœ…";
      }
    }

    onAuthStateChanged(auth, async(user)=>{
      if(!user){ location.href="login.html"; return; }
      await loadProfile(user.uid);
      await loadInvoiceCount(user.uid);
    });

    $("logoutBtn").onclick = ()=>signOut(auth);
    $("upgradeBtn").onclick = ()=>alert("Upgrade flow via Stripe will be added.");
  </script>
</body>
</html>
