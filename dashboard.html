<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartWerk â€” Dashboard</title>
  <link rel="stylesheet" href="style-dashboard.css"/>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo">âš¡ SmartWerk</div>
    <div class="plan-box">
      <p id="planName">FREE</p>
      <div class="progress">
        <div id="planProgress"></div>
      </div>
      <small id="planLimit">3 / 25 documents</small>
      <button id="upgradeBtn">ğŸš€ Upgrade</button>
    </div>
    <nav class="menu">
      <h4>ğŸ’° Invoices</h4>
      <a href="invoice.html">ğŸ“„ Create Invoice</a>
      <a href="invoices-list.html">ğŸ“‹ Saved Invoices</a>

      <h4>ğŸ“‘ Quotes</h4>
      <a href="quote-offer.html">ğŸ“„ Create Quote</a>
      <a href="quote-offer-list.html">ğŸ“‹ Saved Quotes</a>

      <h4>ğŸ“ƒ Contracts</h4>
      <a href="contract.html">ğŸ“„ Create Contract</a>
      <a href="contract-list.html">ğŸ“‹ Saved Contracts</a>

      <h4>ğŸ“¬ Reminders</h4>
      <a href="payment-reminder.html">ğŸ’¸ Create Reminder</a>
      <a href="payment-reminder-list.html">ğŸ“‹ Saved Reminders</a>

      <h4>ğŸ“‚ Templates</h4>
      <a href="email-gemeente.html">ğŸ“© Email to Gemeente</a>
      <a href="cv.html">ğŸ“„ CV / Portfolio</a>
      <a href="expense.csv">ğŸ§® Expense CSV</a>

      <h4>ğŸ“Š Analytics</h4>
      <a href="my-bookkeeper.html">ğŸ† My Bookkeeper</a>
      <a href="summary.html">ğŸ“Š Summary</a>
      <a href="roi-estimator.html">ğŸ“ˆ ROI Estimator</a>
      <a href="tax-calculator.html">ğŸ§® Tax Calculator</a>

      <h4>âš™ï¸ Settings</h4>
      <a href="profile.html">ğŸ‘¤ Profile</a>
    </nav>
    <button id="logoutBtn" class="logout">ğŸšª Logout</button>
  </aside>

  <!-- Main Content -->
  <main class="main">
    <header class="welcome">
      <h1>ğŸ‘‹ Welcome, <span id="userName">User</span></h1>
      <p>Your personal SmartWerk dashboard</p>
    </header>

    <!-- KPIs -->
    <section class="kpi-grid">
      <div class="kpi-card">ğŸ’° <p>Income</p><h2 id="kpiIncome">â‚¬0</h2></div>
      <div class="kpi-card">ğŸ’¸ <p>Expenses</p><h2 id="kpiExpenses">â‚¬0</h2></div>
      <div class="kpi-card">ğŸ“Š <p>Profit</p><h2 id="kpiProfit">â‚¬0</h2></div>
      <div class="kpi-card">ğŸ§¾ <p>VAT</p><h2 id="kpiVAT">â‚¬0</h2></div>
    </section>

    <!-- Chart -->
    <section class="chart-box">
      <canvas id="financeChart"></canvas>
    </section>

    <!-- Tools Grid -->
    <section>
      <h2>ğŸš€ Tools</h2>
      <div class="tools-grid">
        <div class="tool-card">
          <h3>ğŸ“„ Invoice</h3>
          <p>Create and manage invoices</p>
          <a href="invoice.html" class="btn">Create</a>
          <a href="invoices-list.html" class="btn">Saved</a>
        </div>
        <div class="tool-card">
          <h3>ğŸ“‘ Quote</h3>
          <p>Send professional quotes</p>
          <a href="quote-offer.html" class="btn">Create</a>
          <a href="quote-offer-list.html" class="btn">Saved</a>
        </div>
        <div class="tool-card">
          <h3>ğŸ“ƒ Contract</h3>
          <p>Manage freelance contracts</p>
          <a href="contract.html" class="btn">Create</a>
          <a href="contract-list.html" class="btn">Saved</a>
        </div>
        <div class="tool-card">
          <h3>ğŸ’¸ Reminder</h3>
          <p>Send payment reminders</p>
          <a href="payment-reminder.html" class="btn">Create</a>
          <a href="payment-reminder-list.html" class="btn">Saved</a>
        </div>
        <div class="tool-card">
          <h3>ğŸ“© Email</h3>
          <p>Write to Gemeente</p>
          <a href="email-gemeente.html" class="btn">Open</a>
        </div>
        <div class="tool-card">
          <h3>ğŸ“„ CV</h3>
          <p>Create a portfolio</p>
          <a href="cv.html" class="btn">Open</a>
        </div>
        <div class="tool-card">
          <h3>ğŸ“Š Bookkeeper</h3>
          <p>Track your business</p>
          <a href="my-bookkeeper.html" class="btn">Open</a>
        </div>
        <div class="tool-card">
          <h3>ğŸ§® Tax</h3>
          <p>Calculate your taxes</p>
          <a href="tax-calculator.html" class="btn">Open</a>
        </div>
      </div>
    </section>
  </main>

  <!-- Firebase + Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="module">
    import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAp397Ax_jaMI85vOXicOi61g64HvvA_Kg",
      authDomain: "smartwerk8520.firebaseapp.com",
      projectId: "smartwerk8520",
      appId: "1:607670981972:web:c07103c981c86860d724c1",
    };

    const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    const $ = id => document.getElementById(id);

    onAuthStateChanged(auth, async (user)=>{
      if(!user){ location.href="login.html"; return; }

      // Load profile
      const snap = await getDoc(doc(db,"users",user.uid));
      if(snap.exists()){
        const p = snap.data();
        $("userName").innerText = p.fullName || "User";

        // Show plan
        const plan = p.plan || "FREE";
        $("planName").innerText = plan;
        const used = p.usedDocs || 0;
        const limit = plan==="FREE" ? 25 : "âˆ";
        $("planLimit").innerText = plan==="FREE" ? `${used} / ${limit} documents` : "Unlimited PRO";
        $("planProgress").style.width = plan==="FREE" ? `${Math.min(100, (used/25)*100)}%` : "100%";
      }

      // Example KPIs
      $("kpiIncome").innerText="â‚¬5,000";
      $("kpiExpenses").innerText="â‚¬2,000";
      $("kpiProfit").innerText="â‚¬3,000";
      $("kpiVAT").innerText="â‚¬800";

      // Chart
      new Chart($("financeChart"), {
        type:"line",
        data:{
          labels:["Jan","Feb","Mar","Apr","May","Jun"],
          datasets:[{
            label:"Income",
            data:[2000,2500,3000,4000,3500,5000],
            borderColor:"#3b82f6",
            fill:false
          },{
            label:"Expenses",
            data:[800,1000,1200,1500,1400,2000],
            borderColor:"#ef4444",
            fill:false
          }]
        }
      });
    });

    $("logoutBtn").onclick=()=>signOut(auth);
  </script>
</body>
</html>
