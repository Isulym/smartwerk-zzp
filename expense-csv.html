<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartWerk ‚Äî Expense Tracker</title>
  <link rel="stylesheet" href="style-expense-csv.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>üíº SmartWerk Expense Tracker</h1>

   <form id="expenseForm" class="expense-form">
  <h2>üí∏ New Expense Entry</h2>

  <!-- 1. Expense ID -->
  <div class="form-group">
    <label for="expenseId">Expense ID</label>
    <input type="text" id="expenseId" readonly placeholder="EXP-2025-001">
  </div>

  <!-- 2. Expense Type -->
  <div class="form-group">
    <label for="expenseType">Expense Type</label>
    <select id="expenseType">
      <option>One-time</option>
      <option>Recurring Monthly</option>
      <option>Subscription</option>
      <option>Other</option>
    </select>
  </div>

  <!-- 3. Invoice Attached -->
  <div class="form-group">
    <label for="invoiceAttached">Invoice Attached?</label>
    <select id="invoiceAttached">
      <option value="Yes">Yes</option>
      <option value="No">No</option>
    </select>
  </div>

  <!-- 4. Product/Service -->
  <div class="form-group">
    <label for="description">Product / Service Description</label>
    <input type="text" id="description" placeholder="e.g., Adobe Creative Cloud Subscription">
  </div>

  <!-- 5. Payment Date -->
  <div class="form-group">
    <label for="paymentDate">Payment Date</label>
    <input type="date" id="paymentDate">
  </div>

  <!-- 6. Smart Category Suggestion -->
  <div class="form-group">
    <label for="category">Smart Category (AI)</label>
    <input type="text" id="category" placeholder="e.g., Software, Marketing, Travel">
    <button type="button" id="suggestCategory">üß† AI Suggest</button>
  </div>

  <!-- 7. Payment Status -->
  <div class="form-group">
    <label for="paymentStatus">Payment Status</label>
    <select id="paymentStatus">
      <option>Paid</option>
      <option>Unpaid</option>
      <option>Scheduled</option>
      <option>Failed</option>
    </select>
  </div>

  <!-- 8. Reminder / Due Date -->
  <div class="form-group">
    <label for="dueDate">Reminder / Due Date</label>
    <input type="date" id="dueDate">
  </div>

  <!-- 9. Amount & VAT -->
  <div class="form-group">
    <label for="amount">Amount (‚Ç¨)</label>
    <input type="number" id="amount" step="0.01">
  </div>

  <div class="form-group">
    <label for="vatRate">VAT Rate</label>
    <select id="vatRate">
      <option value="0">0%</option>
      <option value="9">9%</option>
      <option value="21">21%</option>
    </select>
  </div>

  <div class="form-group">
    <label for="vatAmount">VAT Amount (‚Ç¨)</label>
    <input type="number" id="vatAmount" readonly>
  </div>

  <div class="form-group">
    <label for="totalAmount">Total Amount (‚Ç¨)</label>
    <input type="number" id="totalAmount" readonly>
  </div>

  <!-- 10. Country / Location -->
  <div class="form-group">
    <label for="country">Country / Location</label>
    <input type="text" id="country" placeholder="e.g., Netherlands">
  </div>

  <!-- 11. Internal Notes -->
  <div class="form-group">
    <label for="notes">Internal Notes (Optional)</label>
    <textarea id="notes" rows="2" placeholder="Only visible to you"></textarea>
  </div>

  <!-- 12. Buttons -->
  <div class="form-actions">
    <button type="button" id="saveExpense">üíæ Save Expense</button>
    <button type="button" id="exportCSV">üìÑ Export CSV</button>
    <button type="button" id="sendReminder">üì§ Send Reminder</button>
    <button type="button" id="printExpense">üñ®Ô∏è Print</button>
  </div>
</form>

<!-- 13. Expense Table Placeholder -->
<section id="expenseTableSection" style="margin-top:40px;">
  <h3>üìä Saved Expenses</h3>
  <div id="expenseTable"></div>
</section>

    <!-- 14. Expense Chart Section -->
<section id="expenseChartSection" style="margin-top: 50px;">
  <h3>üìà Expense Overview Chart</h3>
  <canvas id="expenseChart" width="100%" height="60"></canvas>
</section>

 <script>
document.addEventListener("DOMContentLoaded", function () {
  const amountInput = document.getElementById("amount");
  const vatRateSelect = document.getElementById("vatRate");
  const vatAmountInput = document.getElementById("vatAmount");
  const totalAmountInput = document.getElementById("totalAmount");
  const saveBtn = document.getElementById("saveExpense");
  const exportCSVBtn = document.getElementById("exportCSV");
  const printBtn = document.getElementById("printExpense");
  const tableContainer = document.getElementById("expenseTable");
  const expenseIdField = document.getElementById("expenseId");

  // VAT –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä
  function calculateVAT() {
    const amount = parseFloat(amountInput.value) || 0;
    const vatRate = parseFloat(vatRateSelect.value) || 0;
    const vatAmount = (amount * vatRate) / 100;
    const total = amount + vatAmount;
    vatAmountInput.value = vatAmount.toFixed(2);
    totalAmountInput.value = total.toFixed(2);
  }
  amountInput.addEventListener("input", calculateVAT);
  vatRateSelect.addEventListener("change", calculateVAT);

  function generateExpenseID() {
    const count = JSON.parse(localStorage.getItem("expenses") || "[]").length + 1;
    return `EXP-2025-${String(count).padStart(3, "0")}`;
  }

  function getFormData() {
    return {
      id: expenseIdField.value,
      type: document.getElementById("expenseType").value,
      attached: document.getElementById("invoiceAttached").value,
      description: document.getElementById("description").value,
      paymentDate: document.getElementById("paymentDate").value,
      category: document.getElementById("category").value,
      status: document.getElementById("paymentStatus").value,
      dueDate: document.getElementById("dueDate").value,
      amount: amountInput.value,
      vatRate: vatRateSelect.value,
      vatAmount: vatAmountInput.value,
      total: totalAmountInput.value,
      country: document.getElementById("country").value,
      notes: document.getElementById("notes").value
    };
  }

  function saveExpense() {
    const data = getFormData();
    let expenses = JSON.parse(localStorage.getItem("expenses") || "[]");
    expenses.push(data);
    localStorage.setItem("expenses", JSON.stringify(expenses));
    alert("‚úÖ Expense saved!");
    renderExpenses();
  }

  function renderExpenses() {
    let expenses = JSON.parse(localStorage.getItem("expenses") || "[]");
    if (expenses.length === 0) {
      tableContainer.innerHTML = "<p>No expenses found.</p>";
      return;
    }

    let html = '<table><thead><tr><th>ID</th><th>Type</th><th>Amount</th><th>Status</th><th>Due</th></tr></thead><tbody>';
    expenses.forEach(e => {
      let badge = "";
      if (e.status === "Paid") badge = '<span style="color:green;">Paid</span>';
      else if (e.status === "Unpaid") badge = '<span style="color:red;">Unpaid</span>';
      else badge = `<span>${e.status}</span>`;
      html += `<tr><td>${e.id}</td><td>${e.type}</td><td>‚Ç¨${e.total}</td><td>${badge}</td><td>${e.dueDate}</td></tr>`;
    });
    html += "</tbody></table>";
    tableContainer.innerHTML = html;
  }

  function exportToCSV() {
    const expenses = JSON.parse(localStorage.getItem("expenses") || "[]");
    if (expenses.length === 0) return alert("Nothing to export!");

    const csv = [
      ["ID", "Type", "Attached", "Description", "PaymentDate", "Category", "Status", "DueDate", "Amount", "VATRate", "VATAmount", "Total", "Country", "Notes"]
    ];
    expenses.forEach(e => {
      csv.push([
        e.id, e.type, e.attached, e.description, e.paymentDate, e.category,
        e.status, e.dueDate, e.amount, e.vatRate, e.vatAmount, e.total, e.country, e.notes
      ]);
    });

    const blob = new Blob([csv.map(r => r.join(",")).join("\n")], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "smartwerk-expenses.csv";
    a.click();
    URL.revokeObjectURL(url);
  }

  function printExpenses() {
    window.print();
  }

  // AI Category Suggestion
  document.getElementById("suggestCategory").addEventListener("click", () => {
    const desc = document.getElementById("description").value.toLowerCase();
    let suggestion = "Other";
    if (desc.includes("flight") || desc.includes("hotel")) suggestion = "Travel";
    else if (desc.includes("ads") || desc.includes("facebook") || desc.includes("google")) suggestion = "Marketing";
    else if (desc.includes("software") || desc.includes("subscription")) suggestion = "Software";
    document.getElementById("category").value = suggestion;
  });

  // Chart section
  const existingChart = document.getElementById("expenseChart");
  if (!existingChart) {
    const chartSection = document.createElement("section");
    chartSection.innerHTML = `
      <h3>üìà Expense Category Breakdown</h3>
      <canvas id="expenseChart" width="300" height="300"></canvas>
    `;
    document.getElementById("expenseTableSection").appendChild(chartSection);
  }

  const expenses = JSON.parse(localStorage.getItem("expenses") || []);
  const categoryTotals = {};
  expenses.forEach((exp) => {
    const category = exp.category || "Uncategorized";
    const amount = parseFloat(exp.amount) || 0;
    categoryTotals[category] = (categoryTotals[category] || 0) + amount;
  });

  const ctx = document.getElementById("expenseChart").getContext("2d");
  new Chart(ctx, {
    type: "pie",
    data: {
      labels: Object.keys(categoryTotals),
      datasets: [{
        label: "Expenses by Category",
        data: Object.values(categoryTotals),
        backgroundColor: ["#4e79a7", "#f28e2b", "#e15759", "#76b7b2", "#59a14f", "#edc949", "#af7aa1", "#ff9da7", "#9c755f", "#bab0ac"]
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: "bottom" },
        title: {
          display: true,
          text: "üìä Expense Breakdown by Category"
        }
      }
    }
  });

  // INIT
  renderExpenses();
  expenseIdField.value = generateExpenseID();
  calculateVAT();
});
</script>
</body>
</html>
