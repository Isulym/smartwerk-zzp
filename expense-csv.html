<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartWerk — Expense Tracker</title>
  <link rel="stylesheet" href="style-expense-csv.css" />
</head>
<body>
  <div class="container">
    <h1>💼 SmartWerk Expense Tracker</h1>

   <form id="expenseForm" class="expense-form">
  <h2>💸 New Expense Entry</h2>

  <!-- 1. Expense ID -->
  <div class="form-group">
    <label for="expenseId">Expense ID</label>
    <input type="text" id="expenseId" readonly placeholder="EXP-2025-001">
  </div>

  <!-- 2. Expense Type -->
  <div class="form-group">
    <label for="expenseType">Expense Type</label>
    <select id="expenseType">
      <option>One-time</option>
      <option>Recurring Monthly</option>
      <option>Subscription</option>
      <option>Other</option>
    </select>
  </div>

  <!-- 3. Invoice Attached -->
  <div class="form-group">
    <label for="invoiceAttached">Invoice Attached?</label>
    <select id="invoiceAttached">
      <option value="Yes">Yes</option>
      <option value="No">No</option>
    </select>
  </div>

  <!-- 4. Product/Service -->
  <div class="form-group">
    <label for="description">Product / Service Description</label>
    <input type="text" id="description" placeholder="e.g., Adobe Creative Cloud Subscription">
  </div>

  <!-- 5. Payment Date -->
  <div class="form-group">
    <label for="paymentDate">Payment Date</label>
    <input type="date" id="paymentDate">
  </div>

  <!-- 6. Smart Category Suggestion -->
  <div class="form-group">
    <label for="category">Smart Category (AI)</label>
    <input type="text" id="category" placeholder="e.g., Software, Marketing, Travel">
    <button type="button" id="suggestCategory">🧠 AI Suggest</button>
  </div>

  <!-- 7. Payment Status -->
  <div class="form-group">
    <label for="paymentStatus">Payment Status</label>
    <select id="paymentStatus">
      <option>Paid</option>
      <option>Unpaid</option>
      <option>Scheduled</option>
      <option>Failed</option>
    </select>
  </div>

  <!-- 8. Reminder / Due Date -->
  <div class="form-group">
    <label for="dueDate">Reminder / Due Date</label>
    <input type="date" id="dueDate">
  </div>

  <!-- 9. Amount & VAT -->
  <div class="form-group">
    <label for="amount">Amount (€)</label>
    <input type="number" id="amount" step="0.01">
  </div>

  <div class="form-group">
    <label for="vatRate">VAT Rate</label>
    <select id="vatRate">
      <option value="0">0%</option>
      <option value="9">9%</option>
      <option value="21">21%</option>
    </select>
  </div>

  <div class="form-group">
    <label for="vatAmount">VAT Amount (€)</label>
    <input type="number" id="vatAmount" readonly>
  </div>

  <div class="form-group">
    <label for="totalAmount">Total Amount (€)</label>
    <input type="number" id="totalAmount" readonly>
  </div>

  <!-- 10. Country / Location -->
  <div class="form-group">
    <label for="country">Country / Location</label>
    <input type="text" id="country" placeholder="e.g., Netherlands">
  </div>

  <!-- 11. Internal Notes -->
  <div class="form-group">
    <label for="notes">Internal Notes (Optional)</label>
    <textarea id="notes" rows="2" placeholder="Only visible to you"></textarea>
  </div>

  <!-- 12. Buttons -->
  <div class="form-actions">
    <button type="button" id="saveExpense">💾 Save Expense</button>
    <button type="button" id="exportCSV">📄 Export CSV</button>
    <button type="button" id="sendReminder">📤 Send Reminder</button>
    <button type="button" id="printExpense">🖨️ Print</button>
  </div>
</form>

<!-- 13. Expense Table Placeholder -->
<section id="expenseTableSection" style="margin-top:40px;">
  <h3>📊 Saved Expenses</h3>
  <div id="expenseTable"></div>
</section>

  <script>
    // JavaScript буде додано окремо
    function setToday() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById("date").value = today;
    }

    
     document.addEventListener("DOMContentLoaded", () => {
  const amountField = document.getElementById("amount");
  const vatField = document.getElementById("vat");
  const totalField = document.getElementById("total");
  const form = document.getElementById("expense-form");

  function updateTotal() {
    const amount = parseFloat(amountField.value) || 0;
    const vatPercent = parseFloat(vatField.value) || 0;
    const total = amount + (amount * vatPercent / 100);
    totalField.value = total.toFixed(2);
  }

  amountField.addEventListener("input", updateTotal);
  vatField.addEventListener("change", updateTotal);

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const expense = {
      date: get("date"),
      invoiceNumber: get("invoiceNumber"),
      description: get("description"),
      category: get("category"),
      projectClient: get("projectClient"),
      amount: get("amount"),
      vat: get("vat"),
      total: totalField.value,
      paymentMethod: get("paymentMethod"),
      currency: get("currency"),
      supplier: get("supplier"),
      supplierContact: get("supplierContact"),
      supplierAddress: get("supplierAddress"),
      linkedInvoice: get("linkedInvoice"),
      tags: get("tags"),
      recurring: document.getElementById("recurring").checked,
      note: get("note")
    };
    saveExpense(expense);
    alert("✅ Expense saved locally!");
    form.reset();
    updateTotal();
  });

  function get(id) {
    return document.getElementById(id).value.trim();
  }

  function saveExpense(data) {
    const expenses = JSON.parse(localStorage.getItem("expenses") || "[]");
    expenses.push(data);
    localStorage.setItem("expenses", JSON.stringify(expenses));
  }

  window.exportCSV = function () {
    const expenses = JSON.parse(localStorage.getItem("expenses") || "[]");
    if (!expenses.length) return alert("❗ No expenses to export!");
    const headers = Object.keys(expenses[0]);
    const rows = expenses.map(obj => headers.map(h => `"${(obj[h] || "").toString().replace(/"/g, '""')}"`).join(","));
    const csvContent = [headers.join(","), ...rows].join("\n");
    const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "expenses.csv";
    link.click();
  };

  window.exportPDF = function () {
    const expenses = JSON.parse(localStorage.getItem("expenses") || "[]");
    if (!expenses.length) return alert("❗ No expenses to export!");
    const doc = new jspdf.jsPDF();
    doc.setFontSize(16);
    doc.text("SmartWerk — Expenses", 14, 20);
    doc.setFontSize(12);
    const headers = Object.keys(expenses[0]);
    const rows = expenses.map(obj => headers.map(h => obj[h] || ""));
    doc.autoTable({
      head: [headers],
      body: rows,
      startY: 30,
      styles: { fontSize: 8 },
    });
    doc.save("expenses.pdf");
  };
});
  </script>
</body>
</html>
