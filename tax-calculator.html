<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SmartWerk Tax Calculator v11.3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; background: #f5f5f5; margin: 0; padding: 20px; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; }
    h1, h2 { color: #333; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 10px; }
    .result { background: #e0ffe0; padding: 15px; border-radius: 8px; margin-top: 20px; }
    .tooltip { font-size: 0.9em; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <h1>SmartWerk Tax Calculator v11.3</h1>

    <label>Hours worked:</label>
    <input id="hours" type="number" oninput="autoCalc()">

    <label>Hourly rate (‚Ç¨):</label>
    <input id="rate" type="number" oninput="autoCalc()">

    <label>Extra Benefits (‚Ç¨):</label>
    <input id="benefits" type="number" oninput="autoCalc()">

    <label>Vehicle expenses (‚Ç¨):</label>
    <input id="vehicle" type="number" oninput="autoCalc()">
    <label>Office expenses (‚Ç¨):</label>
    <input id="office" type="number" oninput="autoCalc()">
    <label>Internet (‚Ç¨):</label>
    <input id="internet" type="number" oninput="autoCalc()">
    <label>Marketing (‚Ç¨):</label>
    <input id="marketing" type="number" oninput="autoCalc()">
    <label>Other expenses (‚Ç¨):</label>
    <input id="other" type="number" oninput="autoCalc()">

    <label>KvK Registered?</label>
    <select id="kvk" onchange="autoCalc()">
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>

    <label>Worked 1,225+ hours?</label>
    <select id="zzp" onchange="autoCalc()">
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>

    <label>Use KOR?</label>
    <select id="kor" onchange="autoCalc()">
      <option value="no">No</option>
      <option value="yes">Yes</option>
    </select>

    <div class="result" id="result">Fill in your details...</div>

    <br>
    <button onclick="window.print()">üìÑ Export as PDF</button>
    <button onclick="window.open('ai-assistant.html')">ü§ñ Ask SmartWerk AI</button>
  </div>

  <script>
    function autoCalc() {
      const hours = +document.getElementById("hours").value || 0;
      const rate = +document.getElementById("rate").value || 0;
      const benefits = +document.getElementById("benefits").value || 0;

      const vehicle = +document.getElementById("vehicle").value || 0;
      const office = +document.getElementById("office").value || 0;
      const internet = +document.getElementById("internet").value || 0;
      const marketing = +document.getElementById("marketing").value || 0;
      const other = +document.getElementById("other").value || 0;

      const isKvK = document.getElementById("kvk").value === "yes";
      const isZZP = document.getElementById("zzp").value === "yes";
      const useKOR = document.getElementById("kor").value === "yes";

      const income = hours * rate;
      const expenses = vehicle + office + internet + marketing + other;
      const grossProfit = income + benefits - expenses;

      let deductions = 0;
      if (isKvK && isZZP) {
        deductions += 5030 + 2123; // zelfstandigenaftrek + startersaftrek
      }

      let taxable = Math.max(0, grossProfit - deductions);
      const mkbVrijstelling = taxable * 0.127;
      const finalTaxable = taxable - mkbVrijstelling;

      // Income tax (progressive)
      let incomeTax = 0;
      if (finalTaxable <= 200000) {
        incomeTax = finalTaxable * 0.19;
      } else {
        incomeTax = 200000 * 0.19 + (finalTaxable - 200000) * 0.258;
      }

      // Tariff cap
      const capped = Math.min(incomeTax, finalTaxable * 0.3748);

      // ZVW
      const zvw = grossProfit * 0.0532;

      // KOR logic (simple placeholder: removes BTW if yes)
      const btwReduction = useKOR ? finalTaxable * 0.21 : 0;

      const totalTax = capped + zvw - btwReduction;

      document.getElementById("result").innerHTML = `
        üíº <b>Gross Income:</b> ‚Ç¨${income.toFixed(2)}<br>
        üí∏ <b>Expenses:</b> ‚Ç¨${expenses.toFixed(2)}<br>
        üí∞ <b>Profit:</b> ‚Ç¨${grossProfit.toFixed(2)}<br>
        üõ°Ô∏è <b>Deductions (ZZP/Startersaftrek):</b> ‚Ç¨${deductions.toFixed(2)}<br>
        üßæ <b>MKB Exemption:</b> ‚Ç¨${mkbVrijstelling.toFixed(2)}<br>
        üí≥ <b>Taxable Income:</b> ‚Ç¨${finalTaxable.toFixed(2)}<br>
        üíº <b>Income Tax (capped):</b> ‚Ç¨${capped.toFixed(2)}<br>
        üíä <b>ZVW (5.32%):</b> ‚Ç¨${zvw.toFixed(2)}<br>
        üßæ <b>KOR Reduction:</b> -‚Ç¨${btwReduction.toFixed(2)}<br><br>
        ‚úÖ <b>Total Estimated Tax:</b> ‚Ç¨${totalTax.toFixed(2)}<br>
        üéâ <b>You saved:</b> ‚Ç¨${(deductions + mkbVrijstelling + btwReduction).toFixed(2)}
      `;
    }

    window.onload = autoCalc;
  </script>
</body>
</html>
