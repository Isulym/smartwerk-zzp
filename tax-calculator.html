<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartWerk Tax Calculator 1</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      background: #f9f9f9;
    }
    h2, h3 {
      color: #333;
    }
    section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.05);
    }
    input, select {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
    }
    .button-group {
      margin-top: 15px;
    }
    .button-group button {
      margin-right: 10px;
      padding: 10px 15px;
    }
    .summary {
      background: #eafbe5;
    }
    .highlight-positive {
      color: green;
      font-weight: bold;
    }
    .highlight-negative {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>SmartWerk Tax Calculator</h2>

  <div class="section">
    <h3>Step 1: Your Data</h3>
    <label>Company Name:</label><input type="text" id="companyName"/>
    <label>Email / Phone:</label><input type="text" id="contactInfo"/>
    <label>Period:</label>
    <select id="period">
      <option value="Q1">January – March (Q1)</option>
      <option value="Q2">April – June (Q2)</option>
      <option value="Q3">July – September (Q3)</option>
      <option value="Q4">October – December (Q4)</option>
    </select>
    <label>Hours Worked:</label>
    <input type="number" id="hoursWorked" />
    <label>Hourly Rate (EUR):</label>
    <input type="number" id="hourlyRate" />
    <label>Total Income (auto):</label><input type="number" id="income" readonly/>
  </div>

  <div class="section">
    <h3>Step 2: Expenses</h3>
    <label>Vehicle Expenses:</label><input type="number" id="vehicle"/>
    <label>Office Expenses:</label><input type="number" id="office"/>
    <label>Internet Expenses:</label><input type="number" id="internet"/>
    <label>Marketing Expenses:</label><input type="number" id="marketing"/>
    <label>Other Expenses:</label><input type="number" id="other"/>
    <label>Extra Benefits (EUR):</label><input type="number" id="extraBenefits"/>
  </div>

  <div class="section">
    <h3>Step 3: Tax Options</h3>
    <label>KvK Registered?</label>
    <select id="kvk">
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
    <label>Worked 1,225+ hours?</label>
    <select id="zzpHours">
      <option value="yes">Yes</option>
      <option value="no">No</option>
    </select>
    <label>BTW Rate:</label>
    <select id="btw">
      <option value="21">21%</option>
      <option value="9">9%</option>
      <option value="0">0%</option>
    </select>
    <label>Use KOR?</label>
    <select id="kor">
      <option value="no">No</option>
      <option value="yes">Yes</option>
    </select>
  </div>

  <div class="section summary">
    <h3>Step 4: Result</h3>
    <div id="result">
      <p><strong>Gross Income:</strong> <span id="grossIncome"></span></p>
      <p><strong>Total Expenses:</strong> <span id="totalExpenses"></span></p>
      <p><strong>Taxable Profit:</strong> <span id="taxableProfit"></span></p>
      <p><strong>ZZP Deductions:</strong> <span id="zzpDeductions"></span></p>
      <p><strong>MKB Exemption (12.7%):</strong> <span id="mkbVrijstelling"></span></p>
      <p><strong>Final Taxable Income:</strong> <span id="finalTaxable"></span></p>
      <p><strong>Income Tax:</strong> <span id="incomeTax"></span></p>
      <p><strong>ZVW (5.32%):</strong> <span id="zvwAmount"></span></p>
      <p><strong>BTW Amount:</strong> <span id="btwAmount"></span></p>
      <p><strong>Total Estimated Tax:</strong> <span id="totalTax"></span></p>
    </div>
  </div>

  <div class="button-group">
    <button onclick="calculateTax()">🧮 Calculate Tax</button>
  </div>

  <script>
    function autoCalcIncome() {
      const h = +document.getElementById("hoursWorked").value || 0;
      const r = +document.getElementById("hourlyRate").value || 0;
      document.getElementById("income").value = (h * r).toFixed(2);
      calculateTax();
    }

    function calculateTax() {
  const income = +document.getElementById("income").value || 0;
  const vehicle = +document.getElementById("vehicle").value || 0;
  const office = +document.getElementById("office").value || 0;
  const internet = +document.getElementById("internet").value || 0;
  const marketing = +document.getElementById("marketing").value || 0;
  const other = +document.getElementById("other").value || 0;
  const extraBenefits = +document.getElementById("extraBenefits").value || 0;

  const kvk = document.getElementById("kvk").value === "yes";
  const zzp = document.getElementById("zzpHours").value === "yes";
  const kor = document.getElementById("kor").value === "yes";
  const btwRate = +document.getElementById("btw").value;

  const totalExpenses = vehicle + office + internet + marketing + other;
  const profit = income - totalExpenses + extraBenefits;

  // Пільги
  let zzpDeductions = 0;
  if (kvk && zzp) {
    zzpDeductions = 5030 + 2123; // Zelfstandigenaftrek + Startersaftrek
  }
let taxableBeforeMKB = Math.max(0, profit - zzpDeductions);
let mkbVrijstelling = zzpDeductions > 0 ? taxableBeforeMKB * 0.127 : 0;
      
  // Tariff cap: максимум 37.48% від доходу
  const maxDeductible = profit * 0.3748;
  const cappedZZP = Math.min(zzpDeductions, maxDeductible);
  const cappedMKB = Math.min(mkbVrijstelling, Math.max(0, maxDeductible - cappedZZP));
  const totalSaved = cappedZZP + cappedMKB;

  let finalTaxable = Math.max(0, profit - totalSaved);

  // Income Tax
  let incomeTax = 0;
  if (finalTaxable > 200000) {
    incomeTax = 200000 * 0.19 + (finalTaxable - 200000) * 0.258;
  } else {
    incomeTax = finalTaxable * 0.19;
  }

  // ZVW
  const zvw = profit * 0.0532;

  // BTW
  const btwAmount = kor ? 0 : profit * (btwRate / 100);

  // Total Tax
  const totalTax = incomeTax + zvw;

  // Вивід у DOM
  document.getElementById("grossIncome").textContent = income.toFixed(2);
  document.getElementById("totalExpenses").textContent = totalExpenses.toFixed(2);
  document.getElementById("taxableProfit").textContent = profit.toFixed(2);
  document.getElementById("zzpDeductions").textContent = zzpDeductions.toFixed(2);
  document.getElementById("mkbVrijstelling").textContent = mkbVrijstelling.toFixed(2);
  document.getElementById("finalTaxable").textContent = finalTaxable.toFixed(2);
  document.getElementById("incomeTax").textContent = incomeTax.toFixed(2);
  document.getElementById("zvwAmount").textContent = zvw.toFixed(2);
  document.getElementById("btwAmount").textContent = btwAmount.toFixed(2);
  document.getElementById("totalTax").textContent = totalTax.toFixed(2);

  // Статуси пільг
  document.getElementById("zzp-status").textContent = (kvk && zzp) ? "eligible ✅" : "not eligible ❌";
  document.getElementById("starter-status").textContent = (kvk && zzp) ? "eligible ✅" : "not eligible ❌";
  document.getElementById("mkb-status").textContent = mkbVrijstelling > 0 ? "applied ✅" : "not eligible ❌";
  document.getElementById("kor-status").textContent = kor ? "applied ✅" : "not used ❌";
}
    window.onload = function () {
      document.getElementById("hoursWorked").addEventListener("input", autoCalcIncome);
      document.getElementById("hourlyRate").addEventListener("input", autoCalcIncome);

      const selects = document.querySelectorAll("select");
      selects.forEach(sel => sel.addEventListener("change", calculateTax));

      const inputs = document.querySelectorAll("input");
      inputs.forEach(inp => inp.addEventListener("input", calculateTax));
    };
  </script>
</body>
</html>
