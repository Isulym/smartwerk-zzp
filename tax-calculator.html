<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartWerk Tax Calculator 1</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      background: #f9f9f9;
    }
    h2, h3 {
      color: #333;
    }
    section {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.05);
    }
    input, select {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
    }
    .button-group {
      margin-top: 15px;
    }
    .button-group button {
      margin-right: 10px;
      padding: 10px 15px;
    }
    .summary {
      background: #eafbe5;
    }
    .highlight-positive {
      color: green;
      font-weight: bold;
    }
    .highlight-negative {
      color: red;
      font-weight: bold;
    }
  </style>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <h2>SmartWerk Tax Calculator</h2>

  <div class="section">
    <h3>Step 1: Your Data</h3>
    <label>Company Name:</label><input type="text" id="companyName"/>
    <label>Email / Phone:</label><input type="text" id="contactInfo"/>
    <label>Period:</label>
    <select id="period">
      <option value="Q1">January – March (Q1)</option>
      <option value="Q2">April – June (Q2)</option>
      <option value="Q3">July – September (Q3)</option>
      <option value="Q4">October – December (Q4)</option>
    </select>
    <label>Hours Worked:</label>
    <input type="number" id="hoursWorked" />
    <label>Hourly Rate (EUR):</label>
    <input type="number" id="hourlyRate" />
    <label>Total Income (auto):</label><input type="number" id="income" readonly/>
    <label>KvK Number:</label>
<input type="text" id="kvkNumber" />
<label>VAT Number:</label>
<input type="text" id="vatNumber" />
<label>IBAN:</label>
<input type="text" id="iban" />
<label>Contact Person:</label>
<input type="text" id="contactPerson" />
<label for="reportingNotes">Reporting Notes (optional – add any comments or explanations):</label>
<textarea id="reportingNotes" rows="2" placeholder="E.g. This report includes one-time setup costs, or pending invoices..."></textarea>
  </div>

<div class="section">
  <h3>Step 2: Business Expenses</h3>

  <label>
    🚗 Transport & Vehicle Costs:
    <span title="Car, fuel, public transport, bike lease, or other travel costs related to your business">ℹ️</span>
  </label>
  <input type="number" id="vehicle" />

  <label>
    🏢 Workspace & Rent Costs:
    <span title="Home office rent, coworking space, energy, heating, workspace-related costs">ℹ️</span>
  </label>
  <input type="number" id="office" />

  <label>
    🌐 Internet & Communication:
    <span title="Mobile, Wi-Fi, VoIP, domain registration, business calls, etc.">ℹ️</span>
  </label>
  <input type="number" id="internet" />

  <label>
    📣 Marketing & Advertising:
    <span title="Website, social media ads, flyers, design, campaigns, logo creation, etc.">ℹ️</span>
  </label>
  <input type="number" id="marketing" />

  <label>
    🎁 Business Gifts & Representation:
    <span title="Client gifts, networking meals, drinks, business events, etc.">ℹ️</span>
  </label>
  <input type="number" id="other" />

  <label>
    📚 Study, Insurance & Miscellaneous:
    <span title="Online courses, insurance, banking fees, accountant, administration tools, and more">ℹ️</span>
  </label>
  <input type="number" id="extraBenefits" />
</div>
 <div class="section">
  <h3>Step 3: Tax Options</h3>

  <label>
    KvK Registered?
    <span title="Are you officially registered in the Dutch Chamber of Commerce (KvK)? Required for most deductions.">ℹ️</span>
  </label>
  <select id="kvk">
    <option value="yes">Yes</option>
    <option value="no">No</option>
  </select>

  <label>
    Worked 1,225+ hours?
    <span title="Did you work at least 1,225 hours on your business this year? Required for ZZP deductions.">ℹ️</span>
  </label>
 <select id="zzpHours">
  <option value="yes">Yes</option>
  <option value="no">No</option>
</select>

  <label>
    BTW Rate:
    <span title="Select the VAT rate that applies to your services: 21% (standard), 9% (reduced), or 0% (exempt).">ℹ️</span>
  </label>
  <select id="btwRate">
    <option value="21">21%</option>
    <option value="9">9%</option>
    <option value="0">0%</option>
  </select>

  <label>
    Use KOR?
    <span title="Are you using the Small Business Scheme (KOR)? This exempts you from charging VAT.">ℹ️</span>
  </label>
  <select id="kor">
    <option value="no">No</option>
    <option value="yes">Yes</option>
  </select>
</div>
  <div class="section summary">
    <h3>Step 4: Result</h3>
    <div id="result">
      <p><strong>Gross Income:</strong> <span id="grossIncome"></span></p>
      <p><strong>Total Expenses:</strong> <span id="totalExpenses"></span></p>
      <p><strong>Taxable Profit:</strong> <span id="taxableProfit"></span></p>
      <p><strong>ZZP Deductions:</strong> <span id="zzpDeductions"></span></p>
      <p><strong>MKB Exemption (12.7%):</strong> <span id="mkbVrijstelling"></span></p>
      <p><strong>Final Taxable Income:</strong> <span id="finalTaxable"></span></p>
      <p><strong>Income Tax:</strong> <span id="incomeTax"></span></p>
      <p><strong>ZVW (5.32%):</strong> <span id="zvwAmount"></span></p>
      <p><strong>BTW Amount:</strong> <span id="btwAmount"></span></p>
      <p><strong>Total Estimated Tax:</strong> <span id="totalTax"></span></p>
   <div id="reportingNotesWrapper" style="display: none;">
  <p><strong>Reporting Notes:</strong> <span id="reportingNotesOutput"></span></p>
</div>
    </div>
  </div>

 <div class="button-group">
  <button onclick="calculateTax()">🧮 Calculate Tax</button>
  <button onclick="exportPDF()">📄 Export as PDF</button>
</div>
  <script>
    function autoCalcIncome() {
      const h = +document.getElementById("hoursWorked").value || 0;
      const r = +document.getElementById("hourlyRate").value || 0;
      document.getElementById("income").value = (h * r).toFixed(2);
      calculateTax();
    }

    function calculateTax() {
  const income = parseFloat(document.getElementById("income").value) || 0;
const vehicle = parseFloat(document.getElementById("vehicle").value) || 0;
const office = parseFloat(document.getElementById("office").value) || 0;
const internet = parseFloat(document.getElementById("internet").value) || 0;
const marketing = parseFloat(document.getElementById("marketing").value) || 0;
const other = parseFloat(document.getElementById("other").value) || 0;
const extraBenefits = parseFloat(document.getElementById("extraBenefits").value) || 0;
      
  const kvk = document.getElementById("kvk").value === "yes";
  const zzp = document.getElementById("zzpHours").value === "yes";
  const kor = document.getElementById("kor").value === "yes";
  const btwRate = +document.getElementById("btwRate").value;

  const totalExpenses = vehicle + office + internet + marketing + other + extraBenefits;
  const profit = income - totalExpenses;
  // Пільги
  let zzpDeductions = 0;
  if (kvk && zzp) {
    zzpDeductions = 5030 + 2123; // Zelfstandigenaftrek + Startersaftrek
  }
let taxableBeforeMKB = Math.max(0, profit - zzpDeductions);
let baseForMKB = Math.round(taxableBeforeMKB * 100) / 100;
let mkbVrijstelling = (kvk && zzp) ? baseForMKB * 0.127 : 0;
      
  // Tariff cap: максимум 37.48% від доходу
  const maxDeductible = profit * 0.3748;
  const cappedZZP = Math.min(zzpDeductions, maxDeductible);
  const cappedMKB = Math.min(mkbVrijstelling, Math.max(0, maxDeductible - cappedZZP));
  const totalSaved = cappedZZP + cappedMKB;

  let finalTaxable = Math.max(0, profit - totalSaved);

  // Income Tax
  let incomeTax = 0;
  if (finalTaxable > 200000) {
    incomeTax = 200000 * 0.19 + (finalTaxable - 200000) * 0.258;
  } else {
    incomeTax = finalTaxable * 0.19;
  }
      incomeTax = Math.round(incomeTax * 100) / 100;

  // ZVW
  const zvw = Math.round(finalTaxable * 0.0532 * 100) / 100;
  // BTW
 const btwAmount = kor ? 0 : Math.round(profit * (btwRate / 100) * 100) / 100; // Total Tax
 const totalTax = Math.round((incomeTax + zvw + btwAmount) * 100) / 100;

  // Вивід у DOM
  document.getElementById("grossIncome").textContent = income.toFixed(2);
  document.getElementById("totalExpenses").textContent = totalExpenses.toFixed(2);
  document.getElementById("taxableProfit").textContent = profit.toFixed(2);
  document.getElementById("zzpDeductions").textContent = zzpDeductions.toFixed(2);
  document.getElementById("mkbVrijstelling").textContent = mkbVrijstelling.toFixed(2);
  document.getElementById("finalTaxable").textContent = finalTaxable.toFixed(2);
  document.getElementById("incomeTax").textContent = incomeTax.toFixed(2);
  document.getElementById("zvwAmount").textContent = zvw.toFixed(2);
  document.getElementById("btwAmount").textContent = btwAmount.toFixed(2);
  document.getElementById("totalTax").textContent = totalTax.toFixed(2);
 const reportingNotes = document.getElementById("reportingNotes").value;
const notesOutput = document.getElementById("reportingNotesOutput");
const notesWrapper = document.getElementById("reportingNotesWrapper");

if (reportingNotes.trim() !== "") {
    notesOutput.textContent = reportingNotes;
    notesWrapper.style.display = "block";
} else {
    notesWrapper.style.display = "none";
}

  // Статуси пільг
  document.getElementById("zzp-status").textContent = (kvk && zzp) ? "eligible ✅" : "not eligible ❌";
  document.getElementById("starter-status").textContent = (kvk && zzp) ? "eligible ✅" : "not eligible ❌";
  document.getElementById("mkb-status").textContent = mkbVrijstelling > 0 ? "applied ✅" : "not eligible ❌";
  document.getElementById("kor-status").textContent = kor ? "applied ✅" : "not used ❌";
}
    window.onload = function () {
      document.getElementById("hoursWorked").addEventListener("input", autoCalcIncome);
      document.getElementById("hourlyRate").addEventListener("input", autoCalcIncome);

      const selects = document.querySelectorAll("select");
      selects.forEach(sel => sel.addEventListener("change", calculateTax));

      const inputs = document.querySelectorAll("input");
      inputs.forEach(inp => inp.addEventListener("input", calculateTax));
    };
    
   function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // Відступ зверху
  let y = 10;

  // Заголовок
  doc.setFontSize(14);
  doc.text("SmartWerk Tax Report", 15, y); 
  y += 10;

  // Дані
  const companyName = document.getElementById("companyName").value;
  const emailPhone = document.getElementById("email").value;
  const period = document.getElementById("period").value;
  const hours = document.getElementById("hoursWorked").value;
  const hourlyRate = document.getElementById("hourlyRate").value;
  const income = document.getElementById("income").value;
  const kvk = document.getElementById("kvkNumber").value;
  const vat = document.getElementById("vatNumber").value;
  const iban = document.getElementById("iban").value;
  const contact = document.getElementById("contactPerson").value;
  const notes = document.getElementById("reportingNotes").value;

  // Результати
  const grossIncome = document.getElementById("grossIncome").textContent;
  const totalExpenses = document.getElementById("totalExpenses").textContent;
  const taxableProfit = document.getElementById("taxableProfit").textContent;
  const zzpDeductions = document.getElementById("zzpDeductions").textContent;
  const mkbVrijstelling = document.getElementById("mkbVrijstelling").textContent;
  const finalTaxable = document.getElementById("finalTaxable").textContent;
  const incomeTax = document.getElementById("incomeTax").textContent;
  const zvwAmount = document.getElementById("zvwAmount").textContent;
  const btwAmount = document.getElementById("btwAmount").textContent;
  const totalTax = document.getElementById("totalTax").textContent;

  // Контактна інформація
  doc.setFontSize(11);
  doc.text(`Company: ${companyName}`, 15, y += 6);
  doc.text(`Email / Phone: ${emailPhone}`, 15, y += 6);
  doc.text(`Period: ${period}`, 15, y += 6);
  doc.text(`Hours Worked: ${hours}`, 15, y += 6);
  doc.text(`Hourly Rate: €${hourlyRate}`, 15, y += 6);
  doc.text(`Total Income: €${income}`, 15, y += 6);
  doc.text(`KvK Number: ${kvk}`, 15, y += 6);
  doc.text(`VAT Number: ${vat}`, 15, y += 6);
  doc.text(`IBAN: ${iban}`, 15, y += 6);
  doc.text(`Contact Person: ${contact}`, 15, y += 10);

  // Блок підсумку
  doc.setFontSize(12);
  doc.text("Calculation Summary:", 15, y += 8);

  doc.setFontSize(11);
  doc.text(`Gross Income: €${grossIncome}`, 15, y += 6);
  doc.text(`Total Expenses: €${totalExpenses}`, 15, y += 6);
  doc.text(`Taxable Profit: €${taxableProfit}`, 15, y += 6);
  doc.text(`ZZP Deductions: €${zzpDeductions}`, 15, y += 6);
  doc.text(`MKB Exemption: €${mkbVrijstelling}`, 15, y += 6);
  doc.text(`Final Taxable Income: €${finalTaxable}`, 15, y += 6);
  doc.text(`Income Tax: €${incomeTax}`, 15, y += 6);
  doc.text(`ZVW (5.32%): €${zvwAmount}`, 15, y += 6);
  doc.text(`BTW Amount: €${btwAmount}`, 15, y += 6);

  doc.setFont(undefined, 'bold');
  doc.text(`Total Estimated Tax: €${totalTax}`, 15, y += 10);
  doc.setFont(undefined, 'normal');

  // Коментарі
  if (notes && notes.trim() !== "") {
    doc.setFontSize(12);
    doc.text("Reporting Notes:", 15, y += 8);
    doc.setFontSize(11);
    doc.text(doc.splitTextToSize(notes, 180), 15, y += 6);
  }

  // Збереження PDF
  doc.save("SmartWerk_Tax_Report.pdf");
}
    
  </script>
</body>
</html>
