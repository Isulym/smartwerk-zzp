<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SmartWerk Tax Calculator v10</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    input, select {
      width: 300px;
      margin-bottom: 10px;
      padding: 8px;
    }
    .button-group button {
      margin-right: 10px;
      padding: 10px 15px;
    }
    #result {
      margin-top: 20px;
      padding: 20px;
      background: #e0ffe0;
      border-radius: 6px;
      font-size: 16px;
    }
  </style>
</head>
<body>

<h2>SmartWerk Tax Calculator v10</h2>

<h3>Step 1: Your Info</h3>
<input type="text" id="company" placeholder="Company Name"><br>
<input type="email" id="email" placeholder="Email / Phone"><br>
<select id="period">
  <option>January â€“ March (Q1)</option>
  <option>April â€“ June (Q2)</option>
  <option>July â€“ September (Q3)</option>
  <option>October â€“ December (Q4)</option>
</select><br>
<input type="number" id="hoursWorked" placeholder="Hours Worked"><br>
<input type="number" id="hourlyRate" placeholder="Hourly Rate (EUR)"><br>
<input type="number" id="income" placeholder="Total Income (auto)" readonly><br>

<h3>Step 2: Expenses</h3>
<label>Vehicle Expenses:</label><br><input id="vehicle" type="number"><br>
<label>Office Expenses:</label><br><input id="office" type="number"><br>
<label>Internet Expenses:</label><br><input id="internet" type="number"><br>
<label>Marketing Expenses:</label><br><input id="marketing" type="number"><br>
<label>Other Expenses:</label><br><input id="other" type="number"><br>
<label>Extra Benefits (EUR):</label><br><input id="extra" type="number"><br>

<h3>Step 3: Tax Options</h3>
<label>KvK Registered?</label><br>
<select id="KvK">
  <option value="yes">Yes</option>
  <option value="no">No</option>
</select><br>
<label>Worked 1,225+ hours?</label><br>
<select id="zzpHours">
  <option value="yes">Yes</option>
  <option value="no">No</option>
</select><br>
<label>BTW Rate:</label><br>
<select id="btwRate">
  <option value="21">21%</option>
  <option value="9">9%</option>
  <option value="0">0%</option>
</select><br>
<label>Use KOR?</label><br>
<select id="KOR">
  <option value="no">No</option>
  <option value="yes">Yes</option>
</select><br><br>

<div class="button-group">
  <button onclick="calculateTax()">Calculate Tax</button>
  <button onclick="exportPDF()">Export as PDF</button>
  <button onclick="alert('Sending to accountant...')">Send to Accountant</button>
  <button onclick="window.open('ai-assistant.html')">Ask SmartWerk AI</button>
</div>

<div id="result"></div>

<script>
function autoCalcIncome() {
  const h = +document.getElementById("hoursWorked").value || 0;
  const r = +document.getElementById("hourlyRate").value || 0;
  document.getElementById("income").value = h * r;
  calculateTax(); // trigger automatically
}

function calculateTax() {
  const income = +document.getElementById("income").value || 0;
  const expenses = ["vehicle", "office", "internet", "marketing", "other"]
    .map(id => +document.getElementById(id).value || 0)
    .reduce((a, b) => a + b, 0);
  const extra = +document.getElementById("extraBenefits").value || 0;
  const kvk = document.getElementById("kvk").value === "yes";
  const zzp = document.getElementById("zzpHours").value === "yes";
  const kor = document.getElementById("kor").value === "yes";
  const btwRate = +document.getElementById("btwRate").value || 0;

  let profit = income - expenses + extra;

  let aftrek = 0;
  if (kvk && zzp) aftrek += 5030 + 2123;
  let taxable = Math.max(0, profit - aftrek);

  let winstvrij = taxable * 0.127;
  let cappedBase = taxable - winstvrij;

  let incomeTax = 0;
  if (cappedBase <= 200000) {
    incomeTax = cappedBase * 0.19;
  } else {
    incomeTax = 200000 * 0.19 + (cappedBase - 200000) * 0.258;
  }

  // ÐžÐ±Ð¼ÐµÐ¶ÐµÐ½Ð½Ñ Ð¿Ñ–Ð»ÑŒÐ³ (deduction cap)
  const maxRate = 0.3748;
  const cappedAftrek = Math.min(aftrek, taxable) * maxRate;

  const zvw = profit * 0.0532;
  let totalTax = incomeTax + zvw;

  // Apply KOR (ÑÐ¿Ñ€Ð¾Ñ‰ÐµÐ½Ð¸Ð¹ Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚)
  let btwAmount = kor ? 0 : profit * (btwRate / 100);

  document.getElementById("result").innerHTML = `
    ðŸ’¼ <b>Taxable profit:</b> â‚¬${taxable.toFixed(2)}<br>
    ðŸ’¶ <b>Income tax:</b> â‚¬${incomeTax.toFixed(2)}<br>
    ðŸ§¾ <b>ZVW (5.32%):</b> â‚¬${zvw.toFixed(2)}<br>
    ðŸ§® <b>BTW:</b> â‚¬${btwAmount.toFixed(2)} (${btwRate}%)<br>
    âœ… <b>Deduction savings:</b> â‚¬${(aftrek + winstvrij).toFixed(2)}<br>
    ðŸŸ¢ <b>Total Estimated Tax:</b> â‚¬${totalTax.toFixed(2)}
  `;
}

function exportPDF() {
  alert("PDF export coming soon...");
}
</script>

</body>
</html>
