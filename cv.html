<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>📄 SmartWerk CV / Portfolio</title>
  <link rel="stylesheet" href="style-cv.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="cv-container" id="cvContainer">
    <header class="cv-header">
      <div class="cv-intro">
        <h1 id="fullNamePreview">Your Name</h1>
        <p id="titlePreview">Professional Title</p>
        <p id="contactsPreview">Email · Phone · Website</p>
      </div>
    </header>

    <div class="edit-fields">
      <input type="text" id="fullName" placeholder="Your Name" />
      <input type="text" id="title" placeholder="Your Title" />
      <input type="text" id="contacts" placeholder="Email, Phone, Website" />
    </div>

    <section class="cv-block" draggable="true">
      <h2 contenteditable="true">🧠 Summary</h2>
      <p contenteditable="true">Brief introduction about yourself.</p>
    </section>

    <section class="cv-block" draggable="true">
      <h2 contenteditable="true">🛠️ Skills</h2>
      <ul contenteditable="true">
        <li>JavaScript</li>
        <li>HTML/CSS</li>
        <li>Figma</li>
      </ul>
    </section>

    <section class="cv-block" draggable="true">
      <h2 contenteditable="true">💼 Work Experience</h2>
      <p contenteditable="true">Role, company, and what you did.</p>
    </section>

    <section class="cv-block" draggable="true">
      <h2 contenteditable="true">🎓 Education</h2>
      <p contenteditable="true">Degree, university, year</p>
    </section>

    <section class="cv-block" draggable="true">
      <h2 contenteditable="true">📂 Projects</h2>
      <p contenteditable="true">Describe key projects or portfolio items</p>
    </section>

    <section class="cv-block" draggable="true">
      <h2 contenteditable="true">🏅 Achievements</h2>
      <ul contenteditable="true">
        <li>Award 1</li>
        <li>Certification 2</li>
      </ul>
    </section>

    <section class="cv-block" draggable="true">
      <h2 contenteditable="true">💬 Testimonials</h2>
      <blockquote contenteditable="true">"Feedback from client or employer."</blockquote>
    </section>

    <div class="cv-buttons">
      <button id="btnExportPDF">📄 Export PDF</button>
      <button id="btnSaveCV">💾 Save</button>
      <button id="btnLoadCV">📂 Load</button>
      <button id="btnClearCV">🗑️ Clear</button>
    </div>

    <footer class="cv-footer">
      <p>🔗 smartwerk.nl/portfolio/your-name</p>
    </footer>
  </div>

<script>
// ⏬ SmartWerk CV Drag-and-Drop with Auto Save
let dragged;
const container = document.getElementById("cvContainer");
const blocks = container.querySelectorAll(".cv-block");

blocks.forEach((block) => {
  block.addEventListener("dragstart", (e) => {
    dragged = block;
    block.classList.add("dragging");
  });

  block.addEventListener("dragend", (e) => {
    dragged = null;
    block.classList.remove("dragging");
    saveOrder();
  });

  block.addEventListener("dragover", (e) => {
    e.preventDefault();
    const draggingOver = e.target.closest(".cv-block");
    if (draggingOver && draggingOver !== dragged) {
      const rect = draggingOver.getBoundingClientRect();
      const next = (e.clientY - rect.top) > rect.height / 2;
      draggingOver.parentNode.insertBefore(dragged, next ? draggingOver.nextSibling : draggingOver);
    }
  });
});

function saveOrder() {
  const blocks = Array.from(document.querySelectorAll(".cv-block"));
  const order = blocks.map(b => b.innerHTML);
  localStorage.setItem("cvOrder", JSON.stringify(order));
}

function restoreOrder() {
  const saved = JSON.parse(localStorage.getItem("cvOrder") || "null");
  if (!saved) return;
  const container = document.getElementById("cvContainer");
  const staticBlocks = container.querySelectorAll("header, .edit-fields, .cv-buttons, footer");
  const dynamic = saved.map(html => {
    const s = document.createElement("section");
    s.className = "cv-block";
    s.setAttribute("draggable", "true");
    s.innerHTML = html;
    return s;
  });
  staticBlocks.forEach(e => e.remove());
  container.innerHTML = "";
  dynamic.forEach(s => container.appendChild(s));
  staticBlocks.forEach(e => container.appendChild(e));
}

restoreOrder();

// 🧠 Save / Load editable content
function saveContent() {
  const content = {
    name: document.getElementById("fullName").value,
    title: document.getElementById("title").value,
    contacts: document.getElementById("contacts").value,
  };
  localStorage.setItem("cvContent", JSON.stringify(content));
}

function loadContent() {
  const saved = JSON.parse(localStorage.getItem("cvContent") || "null");
  if (!saved) return;
  document.getElementById("fullName").value = saved.name;
  document.getElementById("title").value = saved.title;
  document.getElementById("contacts").value = saved.contacts;
  document.getElementById("fullNamePreview").innerText = saved.name;
  document.getElementById("titlePreview").innerText = saved.title;
  document.getElementById("contactsPreview").innerText = saved.contacts;
}

loadContent();

["fullName", "title", "contacts"].forEach(id => {
  const el = document.getElementById(id);
  el.addEventListener("input", () => {
    document.getElementById(id + "Preview").innerText = el.value;
    saveContent();
  });
});

// 📄 Export PDF
const { jsPDF } = window.jspdf;
document.getElementById("btnExportPDF").addEventListener("click", () => {
  const doc = new jsPDF();
  let y = 20;
  doc.setFontSize(18);
  doc.text("SmartWerk CV / Portfolio", 20, y);
  y += 10;
  const blocks = document.querySelectorAll(".cv-block");
  blocks.forEach((block) => {
    const title = block.querySelector("h2");
    const text = block.innerText;
    if (title) {
      doc.setFontSize(14);
      doc.setFont(undefined, "bold");
      doc.text(title.innerText, 20, y);
      y += 6;
    }
    doc.setFont(undefined, "normal");
    const lines = doc.splitTextToSize(text, 170);
    doc.text(lines, 20, y);
    y += lines.length * 6 + 4;
  });
  doc.save("smartwerk-cv.pdf");
});

// 💾 Save + Load + Clear Buttons
document.getElementById("btnSaveCV").addEventListener("click", () => {
  saveOrder();
  saveContent();
  alert("✅ Saved successfully!");
});

document.getElementById("btnLoadCV").addEventListener("click", () => {
  restoreOrder();
  loadContent();
});

document.getElementById("btnClearCV").addEventListener("click", () => {
  localStorage.removeItem("cvOrder");
  localStorage.removeItem("cvContent");
  location.reload();
});
</script>
</body>
</html>
