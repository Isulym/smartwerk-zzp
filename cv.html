<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“„ SmartWerk CV / Portfolio</title>
  <link rel="stylesheet" href="style-cv.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div class="topbar">
  <nav>
    <a href="dashboard.html" class="btn">â† Back to Dashboard</a>
    <a href="templates.html" class="btn">â† Back to Templates</a>
  </nav>
</div>
  
  <div class="cv-container" id="cvContainer">
   <header class="cv-header">
  <div class="cv-intro">
    <h1 id="businessNamePreview">Your Name</h1>
    <p id="titlePreview">Professional Title</p>
    <p id="contactsPreview">Email Â· Phone Â· Website</p>
  </div>
</header>

<section class="cv-header cv-personal-info">
  <h2>Personal Information</h2>
  <div class="personal-info-custom">
    <div class="form-row">
      <div class="form-group">
        <label for="businessName">Full Name</label>
        <input type="text" id="businessName" placeholder="Your Name">
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="your@email.com">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="title">Professional Title</label>
        <input type="text" id="title" placeholder="e.g., Web Developer">
      </div>
      <div class="form-group">
        <label for="phone">Phone</label>
        <input type="text" id="phone" placeholder="+31 000000000">
      </div>
    </div>

    <div class="form-row single">
      <div class="form-group full-width">
        <label for="website">Website</label>
        <input type="url" id="website" placeholder="smartwerk.nl">
      </div>
    </div>
  </div>
</section>
    
  <div class="cv-section-columns">
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Summary</h2>
    <p>Brief introduction about yourself.</p>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Skills</h2>
    <ul><li>JavaScript</li><li>HTML/CSS</li><li>Figma</li></ul>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Work Experience</h2>
    <p>Role, company, and what you did.</p>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Education</h2>
    <p>Degree, university, year</p>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Projects</h2>
    <p>Describe key projects or portfolio items</p>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Achievements</h2>
    <ul><li>Award 1</li><li>Certification 2</li></ul>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Testimonials</h2>
    <blockquote>"Feedback from client or employer."</blockquote>
  </section>

  <section class="cv-block" draggable="true">
  <h2>Business Proposal</h2>
  <div id="proposalContent" contenteditable="true">
    <p><strong>Brand Name:</strong> Your Brand Name</p>
    <p><strong>Services / Products:</strong> Describe your key offerings</p>
    <p><strong>Target Audience:</strong> Who you're aiming to serve</p>
    <p><strong>Mission & Vision:</strong> Your goal and purpose</p>
    <p><strong>Call to Action:</strong> What you want potential clients/partners to do</p>
    <p><strong>Contact Information:</strong> Website, Email, Phone</p>
  </div>
</section>
    
</div>
    <label style="font-size: 13px;">
  <input type="checkbox" id="noBranding" />
  Export without branding (PRO)
</label>

    <div class="cv-buttons">
      <button id="btnExportPDF">ğŸ“„ Export PDF</button>
      <button id="btnSaveCV">ğŸ’¾ Save</button>
      <button id="btnLoadCV">ğŸ“‚ Load</button>
      <button id="btnClearCV">ğŸ—‘ï¸ Clear</button>
    </div>

<section class="cv-block ai-assist">
  <h3>ğŸ§  AI Suggestion for Business Proposal</h3>
  <blockquote id="proposalExample" style="font-size:14px; background:#1c1f2b; border-left:4px solid #3b79ff; padding:10px; color:#ccc;">
    <p><strong>Brand Name:</strong> GreenTech Solutions</p>
    <p><strong>Services / Products:</strong> Eco-friendly software for sustainable businesses</p>
    <p><strong>Target Audience:</strong> Startups, NGOs, and companies focused on green technology</p>
    <p><strong>Mission & Vision:</strong> Empower sustainable digital transformation</p>
    <p><strong>Call to Action:</strong> Let's build the future â€” contact us today!</p>
    <p><strong>Contact Information:</strong> greentech@example.com Â· greentech.io</p>
  </blockquote>
  <button onclick="insertProposalExample()" class="btn small">ğŸ§  Use Example</button>
</section>
    

    <footer class="cv-footer">
      <p>ğŸ”— smartwerk.nl/portfolio/your-name</p>
    </footer>
  </div>
<!-- ğŸš€ Firebase Ñ–Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ñ–Ñ + autofill + Firestore save -->
<script type="module">
import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { 
  getFirestore, doc, getDoc, setDoc, addDoc, collection, serverTimestamp 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAp397Ax_jaMI85vOXicOi61g64HvvA_Kg",
  authDomain: "smartwerk8520.firebaseapp.com",
  projectId: "smartwerk8520",
  appId: "1:607670981972:web:c07103c981c86860d724c1",
};

const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const $ = (id) => document.getElementById(id);

/* ğŸ§© Auto-fill Ñ–Ğ· profile.html */
async function autofillFromProfile(uid){
  try{
    const ref = doc(db, "users", uid, "settings", "profile");
    const snap = await getDoc(ref);
    if(snap.exists()){
      const p = snap.data();
      if($("businessName") && p.businessName) $("businessName").value = p.businessName;
      if($("email") && p.businessEmail) $("email").value = p.businessEmail;
      if($("phone") && p.businessPhone) $("phone").value = p.businessPhone;
      console.log("âœ… CV auto-filled from profile");
    } else {
      console.warn("âš ï¸ No profile data found for CV autofill");
    }
  }catch(e){ console.warn("Profile load error:", e); }
}

/* ğŸ’¾ Firestore Save */
async function saveCVFirestore(){
  const user = auth.currentUser;
  if(!user){ alert("Please log in again"); return; }

  const data = {
    businessName: $("businessName")?.value || "",
    title: $("title")?.value || "",
    email: $("email")?.value || "",
    phone: $("phone")?.value || "",
    website: $("website")?.value || "",
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  };

  try{
    await setDoc(doc(db,"users",user.uid,"cv","data"), data);
    await addDoc(collection(db,"users",user.uid,"events"), {
      type:"CV Saved", message:"CV updated", createdAt:serverTimestamp()
    });
    alert("âœ… CV saved to Firestore");
  }catch(e){ console.error("Firestore error:", e); alert("âš ï¸ Firestore error: "+e.message); }
}

/* ğŸ” Auto-init */
onAuthStateChanged(auth, async (user)=>{
  if(!user){ return; }
  await autofillFromProfile(user.uid);
  const saveBtn = document.getElementById("btnSaveCV");
  if(saveBtn){
    saveBtn.addEventListener("click",(e)=>{
      e.preventDefault();
      saveCVFirestore();
    });
  }
});
</script>

  
<script>
document.addEventListener("DOMContentLoaded", () => {
  const fields = ["businessName", "title", "email", "phone", "website"];
  const previewMap = {
    businessName: "businessNamePreview",
    title: "titlePreview",
    email: null,
    phone: null,
    website: null,
  };

  // ğŸ”„ Live Preview
  fields.forEach((id) => {
    const input = document.getElementById(id);
    if (!input) return;
    input.addEventListener("input", () => {
      const previewId = previewMap[id];
      if (previewId) {
        const previewEl = document.getElementById(previewId);
        if (previewEl) previewEl.innerText = input.value || "â€”";
      }
      updateContactsPreview();
      saveToLocalStorage();
    });
  });

  function updateContactsPreview() {
    const email = document.getElementById("email")?.value || "";
    const phone = document.getElementById("phone")?.value || "";
    const website = document.getElementById("website")?.value || "";
    const contactText = [email, phone, website].filter(Boolean).join(" Â· ");
    document.getElementById("contactsPreview").innerText = contactText || "â€”";
  }

  function saveToLocalStorage() {
    const data = {};
    fields.forEach((id) => {
      const el = document.getElementById(id);
      if (el) data[id] = el.value;
    });
    localStorage.setItem("cvData", JSON.stringify(data));
  }

  function loadFromLocalStorage() {
    const data = JSON.parse(localStorage.getItem("cvData") || "{}");
    fields.forEach((id) => {
      const el = document.getElementById(id);
      if (el && data[id]) el.value = data[id];
    });
    updateContactsPreview();
    fields.forEach((id) => {
      const previewId = previewMap[id];
      if (previewId && data[id]) {
        const previewElement = document.getElementById(previewId);
        if (previewElement) previewElement.innerText = data[id];
      }
    });
  }

  // ğŸ’¾ ĞšĞ½Ğ¾Ğ¿ĞºĞ¸ Save / Load / Clear
  document.getElementById("btnSaveCV")?.addEventListener("click", saveToLocalStorage);
  document.getElementById("btnLoadCV")?.addEventListener("click", loadFromLocalStorage);
  document.getElementById("btnClearCV")?.addEventListener("click", () => {
    fields.forEach((id) => {
      const el = document.getElementById(id);
      if (el) el.value = "";
    });
    updateContactsPreview();
    saveToLocalStorage();
  });



  // ğŸ§© Ğ¡Ğ¾Ñ€Ñ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ±Ğ»Ğ¾ĞºÑ–Ğ²
  function saveBlockOrder() {
    const order = Array.from(document.querySelectorAll(".cv-block")).map(b => b.innerHTML);
    localStorage.setItem("cvBlockOrder", JSON.stringify(order));
  }

  function restoreBlockOrder() {
    const saved = JSON.parse(localStorage.getItem("cvBlockOrder") || "null");
    if (!saved) return;
    const parent = document.getElementById("cvContainer");
    const staticElements = Array.from(parent.children).filter(e => !e.classList.contains("cv-block"));
    const newBlocks = saved.map(html => {
      const s = document.createElement("section");
      s.className = "cv-block";
      s.setAttribute("draggable", "true");
      s.innerHTML = html;
      return s;
    });
    parent.innerHTML = "";
    staticElements.forEach(e => parent.appendChild(e));
    newBlocks.forEach(b => parent.appendChild(b));
  }

  restoreBlockOrder();
  loadFromLocalStorage();


// âºï¸ Ğ—Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸ Ñ‚ĞµĞºÑÑ‚ Business Proposal Ñƒ localStorage
function saveProposalContent() {
  const content = document.getElementById("proposalContent")?.innerHTML;
  if (content) localStorage.setItem("cvProposalContent", content);
}

function loadProposalContent() {
  const saved = localStorage.getItem("cvProposalContent");
  if (saved) {
    const el = document.getElementById("proposalContent");
    if (el) el.innerHTML = saved;
  }
}

// ğŸ”„ Ğ’Ğ¸ĞºĞ»Ğ¸Ğº Ğ·Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ Ğ¿Ñ–Ğ´ Ñ‡Ğ°Ñ Ğ·Ğ¼Ñ–Ğ½
const proposalBox = document.getElementById("proposalContent");
if (proposalBox) {
  proposalBox.addEventListener("input", saveProposalContent);
}

// ğŸŸ¢ Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ğ¸ Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ñ‚Ñ–
loadProposalContent();
  });

  function insertProposalExample() {
  const example = document.getElementById("proposalExample").innerHTML;
  const proposalSection = Array.from(document.querySelectorAll(".cv-block"))
    .find(b => b.querySelector("h2")?.innerText === "Business Proposal");
  if (proposalSection) {
    proposalSection.innerHTML = `<h2>Business Proposal</h2>` + example;
  }
}
  

  // ğŸ“„ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ñ–Ñ WOWâ€‘PDF
  document.getElementById("btnExportPDF")?.addEventListener("click", () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF("p", "mm", "a4");
    const isPRO = document.getElementById("noBranding")?.checked; // PRO-Ñ‡ĞµĞºĞ±Ğ¾ĞºÑ

    const name = document.getElementById("businessName")?.value || "Your Name";
    const title = document.getElementById("title")?.value || "";
    const email = document.getElementById("email")?.value || "";
    const phone = document.getElementById("phone")?.value || "";
    const website = document.getElementById("website")?.value || "";

    let y = 20;

    // ğŸ”¹ ĞĞ±ĞºĞ»Ğ°Ğ´Ğ¸Ğ½ĞºĞ°
    doc.setFontSize(22).setFont("helvetica", "bold").text(name, 20, y);
    y += 8;
    if (title) doc.setFontSize(14).setFont("helvetica", "normal").text(title, 20, y), y += 8;
    doc.setFontSize(11);
    if (email) doc.text(`${email}`, 20, y), y += 6;
    if (phone) doc.text(`${phone}`, 20, y), y += 6;
    if (website) doc.text(`${website}`, 20, y), y += 10;

    if (!isPRO) {
      doc.setDrawColor(0, 122, 255).line(20, y, 190, y); // SmartWerk accent line
      y += 8;
    }

    // ğŸ§  Ğ”Ğ²Ğ¾ĞºĞ¾Ğ»Ğ¾Ğ½Ğ½Ğ¸Ğ¹ Ğ¼Ğ°ĞºĞµÑ‚
    const leftBlocks = ["Summary", "Skills", "Languages"];
    const rightBlocks = ["Work Experience", "Projects", "Education", "Achievements", "Testimonials"];

    const allBlocks = document.querySelectorAll(".cv-block");
    const leftContent = [], rightContent = [];

    allBlocks.forEach((block) => {
      const heading = block.querySelector("h2")?.innerText.trim();
      if (!heading) return;
      const contents = Array.from(block.querySelectorAll("p, ul, blockquote, li"))
        .map(el => el.innerText.trim()).filter(Boolean).join("\n");
      if (!contents) return;
      const section = { heading, text: contents };
      if (leftBlocks.includes(heading)) leftContent.push(section);
      else rightContent.push(section);
    });

    const columnY = { left: y, right: y };
    const renderColumn = (data, x) => {
      data.forEach(({ heading, text }) => {
        if (columnY[x] > 270) { doc.addPage(); columnY[x] = 20; }
        doc.setFontSize(13).setFont("helvetica", "bold").text(heading, x === "left" ? 20 : 110, columnY[x]);
        columnY[x] += 6;
        doc.setFont("helvetica", "normal").setFontSize(11);
        const lines = doc.splitTextToSize(text, 80);
        doc.text(lines, x === "left" ? 20 : 110, columnY[x]);
        columnY[x] += lines.length * 6 + 4;
      });
    };

    renderColumn(leftContent, "left");
    renderColumn(rightContent, "right");

    // ğŸ”» Ğ¤ÑƒÑ‚ĞµÑ€
    if (!isPRO) {
      doc.setFontSize(9).setTextColor(150);
      doc.text("SmartWerk Â· smartwerk.nl Â· CV powered by SmartWerk", 20, 290);
    }

    doc.save("smartwerk-cv.pdf");
  });
  
  
</script>
</body>
</html>
