<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>📄 SmartWerk CV / Portfolio</title>
  <link rel="stylesheet" href="style-cv.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="cv-container" id="cvContainer">
   <header class="cv-header">
  <div class="cv-intro">
    <h1 id="fullNamePreview">Your Name</h1>
    <p id="titlePreview">Professional Title</p>
    <p id="contactsPreview">Email · Phone · Website</p>
  </div>
</header>

<section class="cv-header cv-personal-info">
  <h2>Personal Information</h2>
  <div class="personal-info-custom">
    <div class="form-row">
      <div class="form-group">
        <label for="fullName">Full Name</label>
        <input type="text" id="fullName" placeholder="Your Name">
      </div>
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="your@email.com">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="title">Professional Title</label>
        <input type="text" id="title" placeholder="e.g., Web Developer">
      </div>
      <div class="form-group">
        <label for="phone">Phone</label>
        <input type="text" id="phone" placeholder="+31 000000000">
      </div>
    </div>

    <div class="form-row single">
      <div class="form-group full-width">
        <label for="website">Website</label>
        <input type="url" id="website" placeholder="smartwerk.nl">
      </div>
    </div>
  </div>
</section>
    
  <div class="cv-section-columns">
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Summary</h2>
    <p>Brief introduction about yourself.</p>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Skills</h2>
    <ul><li>JavaScript</li><li>HTML/CSS</li><li>Figma</li></ul>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Work Experience</h2>
    <p>Role, company, and what you did.</p>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Education</h2>
    <p>Degree, university, year</p>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Projects</h2>
    <p>Describe key projects or portfolio items</p>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Achievements</h2>
    <ul><li>Award 1</li><li>Certification 2</li></ul>
  </section>
  <section class="cv-block" draggable="true" contenteditable="true">
    <h2> Testimonials</h2>
    <blockquote>"Feedback from client or employer."</blockquote>
  </section>

    <section class="cv-block" draggable="true">
  <h2>Business Proposal</h2>
  <p><strong>Brand Name:</strong> Your Brand Name</p>
  <p><strong>Services / Products:</strong> Describe your key offerings</p>
  <p><strong>Target Audience:</strong> Who you're aiming to serve</p>
  <p><strong>Mission & Vision:</strong> Your goal and purpose</p>
  <p><strong>Call to Action:</strong> What you want potential clients/partners to do</p>
  <p><strong>Contact Information:</strong> Website, Email, Phone</p>
</section>
    
</div>

    <div class="cv-buttons">
      <button id="btnExportPDF">📄 Export PDF</button>
      <button id="btnSaveCV">💾 Save</button>
      <button id="btnLoadCV">📂 Load</button>
      <button id="btnClearCV">🗑️ Clear</button>
    </div>

    <footer class="cv-footer">
      <p>🔗 smartwerk.nl/portfolio/your-name</p>
    </footer>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const fields = ["fullName", "title", "email", "phone", "website"];
  const previewMap = {
    fullName: "fullNamePreview",
    title: "titlePreview",
    email: null,
    phone: null,
    website: null,
  };

  // Live Preview & Save
  fields.forEach((id) => {
    const input = document.getElementById(id);
    if (!input) {
      console.warn(`⚠️ Element with ID "${id}" not found.`);
      return;
    }
    input.addEventListener("input", () => {
      const previewId = previewMap[id];
      if (previewId) {
        const previewElement = document.getElementById(previewId);
        if (previewElement) {
          previewElement.innerText = input.value || "—";
        }
      }
      updateContactsPreview();
      saveToLocalStorage();
    });
  });

  function updateContactsPreview() {
    const email = document.getElementById("email")?.value || "";
    const phone = document.getElementById("phone")?.value || "";
    const website = document.getElementById("website")?.value || "";
    const contactText = [email, phone, website].filter(Boolean).join(" · ");
    document.getElementById("contactsPreview").innerText = contactText || "—";
  }

  function saveToLocalStorage() {
    const data = {};
    fields.forEach((id) => {
      const el = document.getElementById(id);
      if (el) data[id] = el.value;
    });
    localStorage.setItem("cvData", JSON.stringify(data));
  }

  function loadFromLocalStorage() {
    const data = JSON.parse(localStorage.getItem("cvData") || "{}");
    fields.forEach((id) => {
      const el = document.getElementById(id);
      if (el && data[id]) el.value = data[id];
    });
    updateContactsPreview();
    fields.forEach((id) => {
      const previewId = previewMap[id];
      if (previewId && data[id]) {
        const previewElement = document.getElementById(previewId);
        if (previewElement) {
          previewElement.innerText = data[id];
        }
      }
    });
  }

  document.getElementById("btnSaveCV")?.addEventListener("click", saveToLocalStorage);
  document.getElementById("btnLoadCV")?.addEventListener("click", loadFromLocalStorage);
  document.getElementById("btnClearCV")?.addEventListener("click", () => {
    fields.forEach((id) => {
      const el = document.getElementById(id);
      if (el) el.value = "";
    });
    updateContactsPreview();
    saveToLocalStorage();
  });

  function generateSmartWerkPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p", "mm", "a4");
  let y = 20;

  // 📄 Обкладинка
  const fullName = document.getElementById("fullName")?.value || "Your Name";
  const title = document.getElementById("title")?.value || "";
  const email = document.getElementById("email")?.value || "";
  const phone = document.getElementById("phone")?.value || "";
  const website = document.getElementById("website")?.value || "";

  doc.setTextColor(59, 121, 255); // Accent color
  doc.setFontSize(26);
  doc.setFont("helvetica", "bold");
  doc.text(fullName, 20, y); y += 10;

  doc.setTextColor(33);
  if (title) {
    doc.setFontSize(14);
    doc.setFont("helvetica", "italic");
    doc.text(title, 20, y); y += 8;
  }

  doc.setFontSize(11);
  const contacts = [email, phone, website].filter(Boolean).join(" · ");
  if (contacts) {
    doc.setFont("helvetica", "normal");
    doc.setTextColor(100);
    doc.text(contacts, 20, y); y += 12;
  }

  doc.setDrawColor(230);
  doc.line(20, y, 190, y); y += 10;

  // 🔄 Отримуємо блоки
  const allBlocks = document.querySelectorAll(".cv-block");
  const left = [];
  const right = [];

  allBlocks.forEach((block) => {
    const h2 = block.querySelector("h2")?.innerText.toLowerCase() || "";
    if (["summary", "skills", "languages"].includes(h2)) left.push(block);
    else right.push(block);
  });

  function renderBlocks(blocks, xStart, yStart) {
    let yPos = yStart;
    blocks.forEach((block) => {
      const heading = block.querySelector("h2")?.innerText || "";
      const contentEl = block.querySelector("p, ul, blockquote");
      const content = contentEl?.innerText || "";

      if (!heading || !content.trim()) return;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(13);
      doc.setTextColor(33);
      doc.text(heading, xStart, yPos);
      yPos += 6;

      doc.setFont("helvetica", "normal");
      doc.setFontSize(11);
      doc.setTextColor(50);
      const lines = doc.splitTextToSize(content, 80);
      doc.text(lines, xStart, yPos);
      yPos += lines.length * 5 + 4;
    });
    return yPos;
  }

  const yLeft = renderBlocks(left, 20, y);
  const yRight = renderBlocks(right, 110, y);

  y = Math.max(yLeft, yRight) + 10;

  // 🔻 Footer
  doc.setDrawColor(240);
  doc.line(20, 285, 190, 285);
  doc.setFontSize(10);
  doc.setTextColor(180);
  doc.text("Generated via SmartWerk CV Builder · smartwerk.nl", 20, 292);

  // 💾 Зберегти
  doc.save("smartwerk-cv.pdf");
}

// ⬇ Заміни стару кнопку:
document.getElementById("btnExportPDF").addEventListener("click", generateSmartWerkPDF);
  function saveBlockOrder() {
    const order = Array.from(document.querySelectorAll(".cv-block")).map(b => b.innerHTML);
    localStorage.setItem("cvBlockOrder", JSON.stringify(order));
  }

  function restoreBlockOrder() {
    const saved = JSON.parse(localStorage.getItem("cvBlockOrder") || "null");
    if (!saved) return;
    const parent = document.getElementById("cvContainer");
    const staticElements = Array.from(parent.children).filter(e => !e.classList.contains("cv-block"));
    const newBlocks = saved.map(html => {
      const s = document.createElement("section");
      s.className = "cv-block";
      s.setAttribute("draggable", "true");
      s.innerHTML = html;
      return s;
    });
    parent.innerHTML = "";
    staticElements.forEach(e => parent.appendChild(e));
    newBlocks.forEach(b => parent.appendChild(b));
  }

  restoreBlockOrder();
  loadFromLocalStorage();
});
</script>
</body>
</html>
