<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartWerk ‚Äî Quote / Offer</title>
  <link rel="stylesheet" href="quote-offer.css" />
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <a class="brand" href="templates.html">üìÑ SmartWerk Quote / Offer</a>
      <nav class="right">
        <a href="dashboard.html" class="btn">‚Üê Back to Dashboard</a>
      </nav>
    </header>

    <section class="intro">
      <h1>üìÑ Create a Quote / Offer <span class="info-icon" title="A quote is a professional offer sent to your client before an invoice. It shows what you plan to do and how much it will cost.">‚ÑπÔ∏è</span></h1>
      <p class="muted">
        This tool helps you create a professional quote (proposal) before sending an invoice.
        Use it to outline services, pricing, and terms ‚Äî then export as PDF and send to your client.
      </p>
      <p class="quote-valid">üóìÔ∏è Valid until: <span id="validUntil"></span></p>
    </section>

    <form id="quoteForm">
      <div class="form-section">
        <h2>üßæ Business Info</h2>
        <input type="text" id="businessName" placeholder="Your Business Name" required />
        <input type="text" id="businessKvK" placeholder="KvK Number (optional)" />
        <input type="text" id="businessVAT" placeholder="VAT Number (optional)" />
        <input type="text" id="businessIBAN" placeholder="IBAN (optional)" />
      </div>

      <div class="form-section">
        <h2>üë§ Client Info</h2>
        <input type="text" id="clientName" placeholder="Client Name" required />
        <input type="text" id="clientEmail" placeholder="Client Email" />
      </div>

      <div class="form-section">
        <h2>üìã Services</h2>
        <table id="servicesTable">
          <thead>
            <tr><th>Description</th><th>Qty</th><th>Price</th><th>Total</th><th></th></tr>
          </thead>
          <tbody id="itemsContainer">
            <!-- Dynamic rows -->
          </tbody>
        </table>
        <button type="button" id="addItemBtn" class="btn ghost">+ Add Item</button>
      </div>

      <div class="form-section">
        <h2>üßÆ Summary</h2>
        <p>Subtotal: ‚Ç¨<span id="subtotal">0.00</span></p>
        <p>VAT (21%): ‚Ç¨<span id="vat">0.00</span></p>
        <p><strong>Total: ‚Ç¨<span id="total">0.00</span></strong></p>
      </div>

      <div class="form-section">
        <h2>üìù Note to Client</h2>
        <textarea id="clientNote" placeholder="This quote is valid for 14 days... (optional)"></textarea>
      </div>

      <div class="form-section">
        <h2>‚úçÔ∏è Signature</h2>
        <input type="text" id="signatureName" placeholder="Your Name" required />
        <p>Quote Status:
          <select id="quoteStatus">
            <option value="draft">Draft</option>
            <option value="sent">Sent</option>
            <option value="accepted">Accepted</option>
          </select>
        </p>
      </div>

      <div class="actions">
        <button type="submit" class="btn primary">Save</button>
        <button type="button" class="btn" id="generatePDFBtn">Export as PDF</button>
        <button type="button" class="btn ghost" id="aiDraftBtn">AI Draft</button>
      </div>
    </form>

    <footer class="foot-note">
      <p class="muted">Generated with SmartWerk ‚Äî smartwerk.nl</p>
    </footer>
  </div>

  <script type="module" src="quote-offer.js"></script>
  <script>
    const validUntil = new Date();
    validUntil.setDate(validUntil.getDate() + 14);
    document.getElementById("validUntil").textContent = validUntil.toLocaleDateString();

    // quote-offer.js

const addRowBtn = document.getElementById("addRowBtn");
const servicesTableBody = document.querySelector("#servicesTable tbody");
const totalPriceEl = document.getElementById("totalPrice");
const noteToClientEl = document.getElementById("noteToClient");
const statusEl = document.getElementById("quoteStatus");

function createRow(description = "", qty = 1, price = 0) {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td><input type="text" class="desc" value="${description}" /></td>
    <td><input type="number" class="qty" value="${qty}" min="1" /></td>
    <td><input type="number" class="price" value="${price}" step="0.01" /></td>
    <td class="rowTotal">0</td>
    <td><button class="remove-btn">√ó</button></td>
  `;

  row.querySelector(".remove-btn").addEventListener("click", () => row.remove());
  row.querySelectorAll("input").forEach(input => input.addEventListener("input", calculateTotal));
  return row;
}

function calculateTotal() {
  let total = 0;
  document.querySelectorAll("#servicesTable tbody tr").forEach(row => {
    const qty = parseFloat(row.querySelector(".qty").value) || 0;
    const price = parseFloat(row.querySelector(".price").value) || 0;
    const rowTotal = qty * price;
    row.querySelector(".rowTotal").textContent = rowTotal.toFixed(2);
    total += rowTotal;
  });
  totalPriceEl.textContent = total.toFixed(2);
}

function generateAIDraft() {
  const examples = [
    ["Website design", 1, 800],
    ["SEO optimization", 1, 200],
    ["Final delivery & testing", 1, 100]
  ];
  servicesTableBody.innerHTML = "";
  examples.forEach(([desc, qty, price]) => {
    servicesTableBody.appendChild(createRow(desc, qty, price));
  });
  calculateTotal();
}

addRowBtn.addEventListener("click", () => {
  servicesTableBody.appendChild(createRow());
});

document.getElementById("aiDraftBtn").addEventListener("click", generateAIDraft);

// Auto set Valid Until
const validUntil = new Date();
validUntil.setDate(validUntil.getDate() + 14);
document.getElementById("validUntil").textContent = validUntil.toLocaleDateString();

// Export as PDF
function exportQuotePDF() {
  alert("üìÑ PDF export coming soon!"); // –∑–∞–º—ñ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É –ª–æ–≥—ñ–∫—É
}
document.getElementById("generatePDFBtn").addEventListener("click", exportQuotePDF);

// Save to localStorage (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
function saveQuote() {
  const quote = {
    status: statusEl.value,
    services: [],
    note: noteToClientEl.value,
    validUntil: validUntil.toISOString()
  };
  document.querySelectorAll("#servicesTable tbody tr").forEach(row => {
    quote.services.push({
      desc: row.querySelector(".desc").value,
      qty: row.querySelector(".qty").value,
      price: row.querySelector(".price").value
    });
  });
  localStorage.setItem("smartQuote", JSON.stringify(quote));
  alert("‚úÖ Quote saved!");
}
document.getElementById("saveBtn").addEventListener("click", saveQuote);

// Init
servicesTableBody.appendChild(createRow());
calculateTotal();

    // quote-offer-pdf.js

import jsPDF from "https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js";
import autoTable from "https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.23/dist/jspdf.plugin.autotable.min.js";

window.exportQuotePDF = function () {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const clientName = document.getElementById("clientName")?.value || "Client";
  const note = document.getElementById("noteToClient")?.value || "";
  const status = document.getElementById("quoteStatus")?.value || "Draft";
  const validUntil = document.getElementById("validUntil")?.textContent || "";

  const rows = [];
  document.querySelectorAll("#servicesTable tbody tr").forEach((row) => {
    const desc = row.querySelector(".desc").value;
    const qty = row.querySelector(".qty").value;
    const price = row.querySelector(".price").value;
    const total = (parseFloat(qty) * parseFloat(price)).toFixed(2);
    rows.push([desc, qty, price, total]);
  });

  const totalQuote = document.getElementById("totalPrice")?.textContent || "0.00";

  // Header
  doc.setFontSize(18);
  doc.text("üìÑ Quote / Offer", 14, 20);
  doc.setFontSize(12);
  doc.text(`Status: ${status}`, 14, 28);
  doc.text(`Valid until: ${validUntil}`, 14, 34);

  // Services Table
  autoTable(doc, {
    head: [["Description", "Qty", "Price", "Total"]],
    body: rows,
    startY: 42,
  });

  // Totals
  doc.setFontSize(12);
  doc.text(`Total: ‚Ç¨ ${totalQuote}`, 14, doc.lastAutoTable.finalY + 10);

  // Note
  if (note) {
    doc.setFontSize(11);
    doc.text("Note to client:", 14, doc.lastAutoTable.finalY + 20);
    doc.text(note, 14, doc.lastAutoTable.finalY + 28);
  }

  // Footer
  doc.setFontSize(10);
  doc.setTextColor(150);
  doc.text("Generated with SmartWerk Quote Tool", 14, 290);

  // Save
  doc.save(`Quote-${clientName}.pdf`);
};
  </script>
  <script type="module" src="quote-offer-pdf.js"></script>
</body>
</html>
