<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartWerk ‚Äî Quote / Offer</title>
  <link rel="stylesheet" href="style-quote-offer.css" />
<script>  import jsPDF from "https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"; </script>
 <script> import autoTable from "https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.23/dist/jspdf.plugin.autotable.min.js"; </script>
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <a class="brand" href="templates.html">üìÑ SmartWerk Quote / Offer</a>
      <nav class="right">
        <a href="dashboard.html" class="btn">‚Üê Back to Dashboard</a>
      </nav>
    </header>

    <section class="intro">
      <h1>üìÑ Create a Quote / Offer 
        <span class="info-icon" title="A quote is a professional offer sent before an invoice.">‚ÑπÔ∏è</span>
      </h1>
      <p class="muted">Use this tool to create a professional offer for your client before sending an invoice.</p>
      <p class="quote-valid">üóìÔ∏è Valid until: <span id="validUntil"></span></p>
    </section>

    <form id="quoteForm">
      <div class="form-section">
        <h2>üßæ Business Info</h2>
        <input type="text" id="businessName" placeholder="Your Business Name" required />
        <input type="text" id="businessKvK" placeholder="KvK Number (optional)" />
        <input type="text" id="businessVAT" placeholder="VAT Number (optional)" />
        <input type="text" id="businessIBAN" placeholder="IBAN (optional)" />
        <input type="text" id="businessPhone" placeholder="Phone (optional)" />
        <input type="text" id="businessAddress" placeholder="Address (optional)" />
      </div>

      <div class="form-section">
        <h2>üë§ Client Info</h2>
        <input type="text" id="clientName" placeholder="Client Name" required />
        <input type="text" id="clientEmail" placeholder="Client Email (optional)" />
        <input type="text" id="clientPhone" placeholder="Client Phone (optional)" />
        <input type="text" id="clientAddress" placeholder="Client Address (optional)" />
      </div>

      <div class="form-section">
        <h2>üìã Services</h2>
        <table id="servicesTable">
          <thead>
            <tr><th>Description</th><th>Qty</th><th>Price</th><th>Total</th><th></th></tr>
          </thead>
          <tbody id="itemsContainer">
            <!-- Items will be injected here -->
          </tbody>
        </table>
        <button type="button" id="addItemBtn" class="btn ghost">+ Add Item</button>
      </div>

      <div class="form-section">
        <h2>üßÆ Summary</h2>
        <p>Subtotal: <strong><span id="subtotal">‚Ç¨0.00</span></strong></p>
        <p>VAT (21%): <strong><span id="vat">‚Ç¨0.00</span></strong></p>
        <p><strong>Total: <span id="total">‚Ç¨0.00</span></strong></p>
        <p>Currency: 
          <select id="currency">
            <option value="EUR">EUR (‚Ç¨)</option>
            <option value="USD">USD ($)</option>
            <option value="GBP">GBP (¬£)</option>
          </select>
        </p>
      </div>

      <div class="form-section">
        <h2>üìù Quote Settings</h2>
        <input type="text" id="quoteNumber" placeholder="Quote Number (e.g. QUOTE-2025-001)" />
        <select id="quoteStatus">
          <option value="draft">Draft</option>
          <option value="sent">Sent</option>
          <option value="accepted">Accepted</option>
        </select>
        <span id="statusBadge" class="status-badge draft">‚óè Draft</span>
      </div>

      <div class="form-section">
        <h2>üìù Note to Client</h2>
        <textarea id="clientNote" placeholder="This quote is valid for 14 days... (optional)"></textarea>
      </div>

      <div class="form-section">
        <h2>‚úçÔ∏è Signatures</h2>
        <input type="text" id="signatureName" placeholder="Your Name / Signature" required />
        <input type="text" id="clientSignature" placeholder="Client Name / Signature (optional)" />
        <p>Signature Date: <span id="signatureDate"></span></p>
      </div>

      <div class="actions">
        <button type="submit" class="btn primary">üíæ Save</button>
        <button type="button" class="btn" id="previewBtn">üëÅ Preview</button>
        <button type="button" class="btn" id="generatePDFBtn">üìÑ Export PDF</button>
        <button type="button" class="btn ghost" id="aiDraftBtn">‚ö° AI Draft</button>
      </div>
    </form>

    <footer class="foot-note">
      <p class="muted">Generated with SmartWerk ‚Äî smartwerk.nl</p>
    </footer>
  </div>

  <script>
  // ‚úÖ quote-offer.js ‚Äî –ø–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ SmartWerk Quote / Offer

document.addEventListener("DOMContentLoaded", () => {
  // === –ï–ª–µ–º–µ–Ω—Ç–∏ ===
  const form = document.getElementById("quoteForm");
  const addItemBtn = document.getElementById("addItemBtn");
  const itemsContainer = document.getElementById("itemsContainer");
  const subtotalEl = document.getElementById("subtotal");
  const vatEl = document.getElementById("vat");
  const totalEl = document.getElementById("total");
  const quoteNumber = document.getElementById("quoteNumber");
  const quoteStatus = document.getElementById("quoteStatus");
  const statusBadge = document.getElementById("statusBadge");
  const signatureName = document.getElementById("signatureName");
  const currencySelect = document.getElementById("currency");

  // === Init ===
  setValidUntil();
  autoGenerateQuoteNumber();
  updateStatusColor();
  restoreSavedState();
  addItem();
  calculateTotals();

  // === Events ===
  addItemBtn.addEventListener("click", () => {
    addItem();
    calculateTotals();
  });

  quoteStatus.addEventListener("change", () => {
    updateStatusColor();
    lockSignature();
  });

  currencySelect.addEventListener("change", calculateTotals);

  document.getElementById("aiDraftBtn")?.addEventListener("click", () => {
    const examples = [
      ["Design Website", 1, 750],
      ["SEO Optimization", 1, 200],
      ["Hosting Setup", 1, 100]
    ];
    itemsContainer.innerHTML = "";
    examples.forEach(([desc, qty, price]) => addItem(desc, qty, price));
    calculateTotals();
  });

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    saveQuoteToLocalStorage();
    alert("‚úÖ Quote saved successfully!");
  });

  // === Functions ===
  function setValidUntil() {
    const validDate = new Date();
    validDate.setDate(validDate.getDate() + 14);
    document.getElementById("validUntil").textContent = validDate.toLocaleDateString();
  }

  function autoGenerateQuoteNumber() {
    if (quoteNumber.value.trim()) return;
    const year = new Date().getFullYear();
    let counter = parseInt(localStorage.getItem("quoteCounter") || "1");
    quoteNumber.value = `QUOTE-${year}-${String(counter).padStart(3, "0")}`;
    localStorage.setItem("quoteCounter", counter + 1);
  }

  function updateStatusColor() {
    const val = quoteStatus.value;
    statusBadge.textContent = `‚óè ${val.charAt(0).toUpperCase() + val.slice(1)}`;
    statusBadge.className = "status-badge " + val;
  }

  function lockSignature() {
    const locked = ["sent", "accepted"].includes(quoteStatus.value);
    signatureName.disabled = locked;
  }

  function addItem(desc = "", qty = 1, price = 0.0) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input type="text" class="desc" value="${desc}" /></td>
      <td><input type="number" class="qty" value="${qty}" min="1" /></td>
      <td><input type="number" class="price" value="${price}" step="0.01" /></td>
      <td class="rowTotal">0.00</td>
      <td><button type="button" class="remove-btn">√ó</button></td>
    `;

    tr.querySelectorAll("input").forEach(input => input.addEventListener("input", calculateTotals));
    tr.querySelector(".remove-btn").addEventListener("click", () => {
      tr.remove();
      calculateTotals();
    });

    itemsContainer.appendChild(tr);
  }

  function calculateTotals() {
    const currency = currencySelect.value;
    let subtotal = 0;

    document.querySelectorAll("#itemsContainer tr").forEach(row => {
      const qty = parseFloat(row.querySelector(".qty").value) || 0;
      const price = parseFloat(row.querySelector(".price").value) || 0;
      const total = qty * price;
      row.querySelector(".rowTotal").textContent = formatCurrency(total, currency);
      subtotal += total;
    });

    const vat = subtotal * 0.21;
    const grandTotal = subtotal + vat;

    subtotalEl.textContent = formatCurrency(subtotal, currency);
    vatEl.textContent = formatCurrency(vat, currency);
    totalEl.textContent = formatCurrency(grandTotal, currency);
  }

  function formatCurrency(amount, currency) {
    return new Intl.NumberFormat("en", {
      style: "currency",
      currency: currency
    }).format(amount);
  }

  function saveQuoteToLocalStorage() {
    const quote = {
      quoteNumber: quoteNumber.value,
      businessName: document.getElementById("businessName").value,
      businessKvK: document.getElementById("businessKvK").value,
      businessVAT: document.getElementById("businessVAT").value,
      businessIBAN: document.getElementById("businessIBAN").value,
      businessPhone: document.getElementById("businessPhone").value,
      businessAddress: document.getElementById("businessAddress").value,
      clientName: document.getElementById("clientName").value,
      clientEmail: document.getElementById("clientEmail").value,
      clientPhone: document.getElementById("clientPhone").value,
      clientAddress: document.getElementById("clientAddress").value,
      currency: currencySelect.value,
      validUntil: document.getElementById("validUntil").textContent,
      quoteStatus: quoteStatus.value,
      note: document.getElementById("clientNote").value,
      signatureName: signatureName.value,
      clientSignature: document.getElementById("clientSignature").value,
      signatureDate: document.getElementById("signatureDate").textContent,
      total: totalEl.textContent,
      items: []
    };

    document.querySelectorAll("#itemsContainer tr").forEach(row => {
      quote.items.push({
        desc: row.querySelector(".desc").value,
        qty: row.querySelector(".qty").value,
        price: row.querySelector(".price").value
      });
    });

    const saved = JSON.parse(localStorage.getItem("savedQuotes") || "[]");
    saved.push(quote);
    localStorage.setItem("savedQuotes", JSON.stringify(saved));
  }

  function restoreSavedState() {
    // –ú–æ–∂–Ω–∞ –¥–æ–ø–æ–≤–Ω–∏—Ç–∏ –ª–æ–≥—ñ–∫–æ—é, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ —á–µ—Ä–Ω–µ—Ç–∫–æ–≤–æ–≥–æ —ñ–Ω–≤–æ–π—Å—É
  }
});

    // quote-offer-pdf.js


window.exportQuotePDF = function () {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // === Config ===
  const proUser = confirm("üõ°Ô∏è Export without SmartWerk branding? (PRO only)");
  const marginLeft = 14;
  let y = 20;

  // === Header ===
  doc.setFontSize(20).setTextColor(40).text("üìÑ Quote / Offer", marginLeft, y);
  y += 10;

  const status = document.getElementById("quoteStatus").value;
  const validUntil = document.getElementById("validUntil").textContent;
  const clientName = document.getElementById("clientName").value || "Client";
  const clientEmail = document.getElementById("clientEmail").value;

  doc.setFontSize(11);
  doc.text(`Status: ${status}`, marginLeft, y); y += 6;
  doc.text(`Valid Until: ${validUntil}`, marginLeft, y); y += 6;
  doc.text(`Client: ${clientName}`, marginLeft, y); y += 6;
  if (clientEmail) { doc.text(`Email: ${clientEmail}`, marginLeft, y); y += 6; }

  // === Table ===
  const rows = [];
  document.querySelectorAll("#itemsContainer tr").forEach((row) => {
    const desc = row.querySelector(".desc")?.value || "";
    const qty = row.querySelector(".qty")?.value || "0";
    const price = row.querySelector(".price")?.value || "0.00";
    const total = (parseFloat(qty) * parseFloat(price)).toFixed(2);
    rows.push([desc, qty, `‚Ç¨ ${price}`, `‚Ç¨ ${total}`]);
  });

  autoTable(doc, {
    head: [["Description", "Qty", "Price", "Total"]],
    body: rows,
    startY: y + 4,
    styles: { fontSize: 10 },
    theme: "grid",
    headStyles: { fillColor: [0, 122, 255] },
  });

  // === Totals & Notes ===
  const total = document.getElementById("total")?.textContent || "0.00";
  const note = document.getElementById("clientNote")?.value || "";
  let endY = doc.lastAutoTable.finalY + 10;

  doc.setFontSize(12).text(`üí∞ Total: ‚Ç¨ ${total}`, marginLeft, endY);
  endY += 8;

  if (note) {
    doc.setFontSize(11).text("Note to client:", marginLeft, endY);
    endY += 6;
    const noteLines = doc.splitTextToSize(note, 180);
    doc.setFontSize(10).text(noteLines, marginLeft, endY);
    endY += noteLines.length * 5 + 4;
  }

  // === Signatures ===
  const signer = document.getElementById("signatureName")?.value || "";
  const clientSig = document.getElementById("clientSignature")?.value || "";
  const date = document.getElementById("signatureDate")?.textContent || "";

  endY += 10;
  doc.setFontSize(11).text("‚úçÔ∏è Signatures:", marginLeft, endY); endY += 6;
  doc.setFontSize(10);
  doc.text(`Business: ${signer}`, marginLeft, endY); endY += 5;
  doc.text(`Client: ${clientSig}`, marginLeft, endY); endY += 5;
  doc.text(`Date: ${date}`, marginLeft, endY); endY += 5;

  // === Branding / Footer ===
  if (!proUser) {
    doc.setFontSize(10);
    doc.setTextColor(160);
    doc.line(marginLeft, 285, 200, 285);
    doc.text("Generated by SmartWerk ‚Ä¢ smartwerk.nl", marginLeft, 291);
  }

  // === Save File ===
  const fileName = `Quote-${clientName.replace(/\s+/g, "_")}.pdf`;
  doc.save(fileName);
};
</script>
 
 
</body>
</html>
