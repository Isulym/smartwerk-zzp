<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartWerk — Quote / Offer</title>
  <link rel="stylesheet" href="style-quote-offer.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <a class="brand" href="templates.html">📄 SmartWerk Quote / Offer</a>
      <nav class="right">
        <a href="dashboard.html" class="btn">← Back to Dashboard</a>
      </nav>
    </header>

    <section class="intro">
      <h1>📄 Create a Quote / Offer 
        <span class="info-icon" title="A quote is a professional offer sent before an invoice.">ℹ️</span>
      </h1>
      <p class="muted">Use this tool to create a professional offer for your client before sending an invoice.</p>
      <p class="quote-valid">🗓️ Valid until: <span id="validUntil"></span></p>
    </section>

    <form id="quoteForm">
      <div class="form-section">
        <h2>🧾 Business Info</h2>
        <input type="text" id="businessName" placeholder="Your Business Name" required />
        <input type="text" id="businessKvK" placeholder="KvK Number (optional)" />
        <input type="text" id="businessVAT" placeholder="VAT Number (optional)" />
        <input type="text" id="businessIBAN" placeholder="IBAN (optional)" />
        <input type="text" id="businessPhone" placeholder="Phone (optional)" />
        <input type="text" id="businessAddress" placeholder="Address (optional)" />
      </div>

      <div class="form-section">
        <h2>👤 Client Info</h2>
        <input type="text" id="clientName" placeholder="Client Name" required />
        <input type="text" id="clientEmail" placeholder="Client Email (optional)" />
        <input type="text" id="clientPhone" placeholder="Client Phone (optional)" />
        <input type="text" id="clientAddress" placeholder="Client Address (optional)" />
      </div>

      <div class="form-section">
        <h2>📋 Services</h2>
        <table id="servicesTable">
          <thead>
            <tr><th>Description</th><th>Qty</th><th>Price</th><th>Total</th><th></th></tr>
          </thead>
          <tbody id="itemsContainer">
            <!-- Items will be injected here -->
          </tbody>
        </table>
        <button type="button" id="addItemBtn" class="btn ghost">+ Add Item</button>
      </div>

      <div class="form-section">
        <h2>🧮 Summary</h2>
        <p>Subtotal: <strong><span id="subtotal">€0.00</span></strong></p>
        <p>VAT (21%): <strong><span id="vat">€0.00</span></strong></p>
        <p><strong>Total: <span id="total">€0.00</span></strong></p>
        <p>Currency: 
          <select id="currency">
            <option value="EUR">EUR (€)</option>
            <option value="USD">USD ($)</option>
            <option value="GBP">GBP (£)</option>
          </select>
        </p>
      </div>

      <div class="form-section">
        <h2>📝 Quote Settings</h2>
        <input type="text" id="quoteNumber" placeholder="Quote Number (e.g. QUOTE-2025-001)" />
        <select id="quoteStatus">
          <option value="draft">Draft</option>
          <option value="sent">Sent</option>
          <option value="accepted">Accepted</option>
        </select>
        <span id="statusBadge" class="status-badge draft">● Draft</span>
      </div>

      <div class="form-section">
        <h2>📝 Note to Client</h2>
        <textarea id="clientNote" placeholder="This quote is valid for 14 days... (optional)"></textarea>
      </div>

      <div class="form-section">
        <h2>✍️ Signatures</h2>
        <input type="text" id="signatureName" placeholder="Your Name / Signature" required />
        <input type="text" id="clientSignature" placeholder="Client Name / Signature (optional)" />
        <p>Signature Date: <span id="signatureDate"></span></p>
      </div>

      <div class="actions">
        <button type="submit" class="btn primary">💾 Save</button>
        <button type="button" class="btn" id="previewBtn">👁 Preview</button>
       <button id="exportQuotePDF" class="btn">📄 Export PDF</button>
        <button type="button" class="btn ghost" id="aiDraftBtn">⚡ AI Draft</button>
      </div>
    </form>

    <footer class="foot-note">
      <p class="muted">Generated with SmartWerk — smartwerk.nl</p>
    </footer>
  </div>

  <section id="savedQuotesSection" class="form-section">
  <h2>📁 Saved Quotes</h2>
  <table id="savedQuotesTable">
    <thead>
      <tr>
        <th>Quote No</th>
        <th>Client</th>
        <th>Date</th>
        <th>Status</th>
        <th>Total</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="savedQuotesBody">
      <!-- Dynamically filled -->
    </tbody>
  </table>
</section>

  <script>
  // ✅ quote-offer.js — повна логіка SmartWerk Quote / Offer

document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("quoteForm");
  const addItemBtn = document.getElementById("addItemBtn");
  const itemsContainer = document.getElementById("itemsContainer");
  const subtotalEl = document.getElementById("subtotal");
  const vatEl = document.getElementById("vat");
  const totalEl = document.getElementById("total");
  const quoteNumber = document.getElementById("quoteNumber");
  const quoteStatus = document.getElementById("quoteStatus");
  const statusBadge = document.getElementById("statusBadge");
  const signatureName = document.getElementById("signatureName");
  const currencySelect = document.getElementById("currency");

  autoGenerateQuoteNumber();
  updateStatusColor();
  lockSignature();
  loadSavedQuotes();

  addItemBtn.addEventListener("click", () => {
    addItem();
    calculateTotals();
  });

  quoteStatus.addEventListener("change", () => {
    updateStatusColor();
    lockSignature();
  });

  currencySelect.addEventListener("change", calculateTotals);

  document.getElementById("aiDraftBtn")?.addEventListener("click", () => {
    itemsContainer.innerHTML = "";
    [
      ["Design Website", 1, 750],
      ["SEO Optimization", 1, 200],
      ["Hosting Setup", 1, 100]
    ].forEach(([desc, qty, price]) => addItem(desc, qty, price));
    calculateTotals();
  });

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    saveQuoteToLocalStorage();
    alert("✅ Quote saved successfully!");
    loadSavedQuotes();
  });

  function autoGenerateQuoteNumber() {
    if (quoteNumber.value.trim()) return;
    const year = new Date().getFullYear();
    let counter = parseInt(localStorage.getItem("quoteCounter") || "1");
    quoteNumber.value = `QUOTE-${year}-${String(counter).padStart(3, "0")}`;
    localStorage.setItem("quoteCounter", counter + 1);
  }

  function updateStatusColor() {
    const val = quoteStatus.value;
    statusBadge.textContent = `● ${val.charAt(0).toUpperCase() + val.slice(1)}`;
    statusBadge.className = "status-badge " + val;
  }

  function lockSignature() {
    const locked = ["sent", "accepted"].includes(quoteStatus.value);
    signatureName.disabled = locked;
  }

  function addItem(desc = "", qty = 1, price = 0.0) {
    qty = parseFloat(qty) || 1;
    price = parseFloat(price) || 0.0;
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><input type="text" class="desc" value="${desc}" /></td>
      <td><input type="number" class="qty" value="${qty}" min="1" /></td>
      <td><input type="number" class="price" value="${price}" step="0.01" /></td>
      <td class="rowTotal">0.00</td>
      <td><button type="button" class="remove-btn">×</button></td>
    `;
    tr.querySelectorAll("input").forEach(input => input.addEventListener("input", calculateTotals));
    tr.querySelector(".remove-btn").addEventListener("click", () => {
      tr.remove();
      calculateTotals();
    });
    itemsContainer.appendChild(tr);
    calculateTotals();
  }

  function calculateTotals() {
    const currency = currencySelect.value;
    let subtotal = 0;
    document.querySelectorAll("#itemsContainer tr").forEach(row => {
      const qty = parseFloat(row.querySelector(".qty").value) || 0;
      const price = parseFloat(row.querySelector(".price").value) || 0;
      const total = qty * price;
      row.querySelector(".rowTotal").textContent = formatCurrency(total, currency);
      subtotal += total;
    });
    const vat = subtotal * 0.21;
    const grandTotal = subtotal + vat;
    subtotalEl.textContent = formatCurrency(subtotal, currency);
    vatEl.textContent = formatCurrency(vat, currency);
    totalEl.textContent = formatCurrency(grandTotal, currency);
  }

  function formatCurrency(amount, currency) {
    return new Intl.NumberFormat("en", {
      style: "currency",
      currency: currency
    }).format(amount);
  }

  function saveQuoteToLocalStorage() {
    const quote = {
      quoteNumber: quoteNumber.value,
      businessName: document.getElementById("businessName").value,
      businessKvK: document.getElementById("businessKvK").value,
      businessVAT: document.getElementById("businessVAT").value,
      businessIBAN: document.getElementById("businessIBAN").value,
      businessPhone: document.getElementById("businessPhone").value,
      businessAddress: document.getElementById("businessAddress").value,
      clientName: document.getElementById("clientName").value,
      clientEmail: document.getElementById("clientEmail").value,
      clientPhone: document.getElementById("clientPhone").value,
      clientAddress: document.getElementById("clientAddress").value,
      currency: currencySelect.value,
      validUntil: document.getElementById("validUntil").textContent,
      quoteStatus: quoteStatus.value,
      note: document.getElementById("clientNote").value,
      signatureName: signatureName.value,
      clientSignature: document.getElementById("clientSignature").value,
      signatureDate: new Date().toLocaleDateString(),
      total: totalEl.textContent,
      items: []
    };
    document.querySelectorAll("#itemsContainer tr").forEach(row => {
      quote.items.push({
        desc: row.querySelector(".desc").value,
        qty: row.querySelector(".qty").value,
        price: row.querySelector(".price").value
      });
    });
    const saved = JSON.parse(localStorage.getItem("savedQuotes") || "[]");
    saved.push(quote);
    localStorage.setItem("savedQuotes", JSON.stringify(saved));
  }

  window.editQuote = function(index) {
    const saved = JSON.parse(localStorage.getItem("savedQuotes") || "[]");
    const quote = saved[index];
    if (!quote) return;
    document.getElementById("businessName").value = quote.businessName;
    document.getElementById("businessKvK").value = quote.businessKvK;
    document.getElementById("businessVAT").value = quote.businessVAT;
    document.getElementById("businessIBAN").value = quote.businessIBAN;
    document.getElementById("businessPhone").value = quote.businessPhone;
    document.getElementById("businessAddress").value = quote.businessAddress;
    document.getElementById("clientName").value = quote.clientName;
    document.getElementById("clientEmail").value = quote.clientEmail;
    document.getElementById("clientPhone").value = quote.clientPhone;
    document.getElementById("clientAddress").value = quote.clientAddress;
    document.getElementById("quoteNumber").value = quote.quoteNumber;
    document.getElementById("quoteStatus").value = quote.quoteStatus;
    document.getElementById("clientNote").value = quote.note;
    document.getElementById("signatureName").value = quote.signatureName;
    document.getElementById("clientSignature").value = quote.clientSignature;
    document.getElementById("signatureDate").textContent = quote.signatureDate;
    document.getElementById("currency").value = quote.currency;
    document.getElementById("validUntil").textContent = quote.validUntil;

    updateStatusColor();
    lockSignature();

    itemsContainer.innerHTML = "";
    quote.items.forEach(item => {
      addItem(item.desc, item.qty, item.price);
    });

    calculateTotals();
    window.scrollTo({ top: 0, behavior: "smooth" });
  };

  window.deleteQuote = function(index) {
    if (!confirm("❌ Are you sure you want to delete this quote?")) return;
    const saved = JSON.parse(localStorage.getItem("savedQuotes") || "[]");
    saved.splice(index, 1);
    localStorage.setItem("savedQuotes", JSON.stringify(saved));
    loadSavedQuotes();
  };

  function loadSavedQuotes() {
    const saved = JSON.parse(localStorage.getItem("savedQuotes") || "[]");
    const tbody = document.getElementById("savedQuotesBody");
    if (!tbody) return;
    tbody.innerHTML = "";
    saved.forEach((quote, index) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${quote.quoteNumber}</td>
        <td>${quote.clientName}</td>
        <td>${quote.validUntil}</td>
        <td>${quote.quoteStatus}</td>
        <td>${quote.total}</td>
        <td>
          <button class="btn small" onclick="viewQuote(${index})">🔍 View</button>
          <button class="btn small" onclick="editQuote(${index})">✏️ Edit</button>
          <button class="btn small danger" onclick="deleteQuote(${index})">🗑️ Delete</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  window.viewQuote = function(index) {
    const saved = JSON.parse(localStorage.getItem("savedQuotes") || "[]");
    const quote = saved[index];
    alert(`Quote for ${quote.clientName}\nTotal: ${quote.total}\nStatus: ${quote.quoteStatus}`);
  };
});

    // === Export PDF кнопка ===
document.getElementById('exportQuotePDF').addEventListener('click', exportQuotePDF);

function exportQuotePDF() {
  const {
    jsPDF
  } = window.jspdf;
  const doc = new jsPDF();

  const businessName = document.getElementById('businessName').value;
  const businessAddress = document.getElementById('businessAddress').value;
  const businessKvK = document.getElementById('businessKvK').value;
  const businessVAT = document.getElementById('businessVAT').value;
  const businessIBAN = document.getElementById('businessIBAN').value;
  const businessPhone = document.getElementById('businessPhone').value;

  const clientName = document.getElementById('clientName').value;
  const clientEmail = document.getElementById('clientEmail').value;
  const clientPhone = document.getElementById('clientPhone').value;
  const clientAddress = document.getElementById('clientAddress').value;

  const quoteNumber = document.getElementById('quoteNumber').value;
  const validUntil = document.getElementById('validUntil').innerText;
  const currency = document.getElementById('currency').value;

  const items = [...document.querySelectorAll('#itemsContainer tr')].map(row => {
    const cells = row.querySelectorAll('td input');
    return {
      description: cells[0].value,
      qty: cells[1].value,
      price: cells[2].value,
      total: (parseFloat(cells[1].value) * parseFloat(cells[2].value)).toFixed(2)
    };
  });

  const subtotal = document.getElementById('subtotal').innerText;
  const vat = document.getElementById('vat').innerText;
  const total = document.getElementById('total').innerText;

  const note = document.getElementById('clientNote').value;
  const signatureName = document.getElementById('signatureName').value;
  const clientSignature = document.getElementById('clientSignature').value;
  const signatureDate = document.getElementById('signatureDate').innerText;

  // FROM / TO layout
  doc.setFontSize(11);
  doc.text('From:', 15, 20);
  doc.text(`${businessName}`, 15, 26);
  if (businessAddress) doc.text(`Address: ${businessAddress}`, 15, 32);
  if (businessKvK) doc.text(`KVK: ${businessKvK}`, 15, 38);
  if (businessVAT) doc.text(`VAT: ${businessVAT}`, 15, 44);
  if (businessIBAN) doc.text(`IBAN: ${businessIBAN}`, 15, 50);
  if (businessPhone) doc.text(`Phone: ${businessPhone}`, 15, 56);

  doc.text('To:', 140, 20);
  doc.text(clientName, 140, 26);
  if (clientAddress) doc.text(clientAddress, 140, 32);
  if (clientEmail) doc.text(`Email: ${clientEmail}`, 140, 38);
  if (clientPhone) doc.text(`Phone: ${clientPhone}`, 140, 44);

  doc.setFontSize(12);
  doc.text(`Quote No: ${quoteNumber}`, 15, 70);
  doc.text(`Valid Until: ${validUntil}`, 15, 78);

  // Table
  const tableData = items.map(item => [
    item.description,
    `${currencySymbol(currency)} ${item.qty}`,
    `${currencySymbol(currency)} ${item.price}`,
    `${currencySymbol(currency)} ${item.total}`
  ]);

  doc.autoTable({
    startY: 85,
    head: [['Description', 'Qty', 'Price', 'Total']],
    body: tableData,
    theme: 'grid',
    headStyles: {
      fillColor: [63, 123, 255]
    }
  });

  const finalY = doc.lastAutoTable.finalY + 10;

  // Summary
  doc.setFontSize(11);
  doc.text(`Subtotal: ${subtotal}`, 15, finalY);
  doc.text(`VAT (21%): ${vat}`, 15, finalY + 6);
  doc.text(`Total: ${total}`, 15, finalY + 12);
  doc.text(`Currency: ${currency}`, 15, finalY + 18);

  // Note
  if (note) {
    doc.setFont(undefined, 'bold');
    doc.text('Note to Client:', 15, finalY + 30);
    doc.setFont(undefined, 'normal');
    doc.text(note, 15, finalY + 36);
  }

  // Signatures
  doc.setFont(undefined, 'bold');
  doc.text('Signatures:', 15, finalY + 48);
  doc.setFont(undefined, 'normal');

  doc.text(`Business: ${signatureName}`, 15, finalY + 55);
  doc.text(`Client: ${clientSignature}`, 15, finalY + 61);
  doc.text(`Date: ${signatureDate}`, 15, finalY + 67);

  // Signature lines
  doc.line(15, finalY + 65, 80, finalY + 65); // Business line
  doc.line(100, finalY + 65, 185, finalY + 65); // Client line

  // Branding (можна вимкнути в PRO)
  const brandingEnabled = true; // змінюй на false для PRO
  if (brandingEnabled) {
    doc.setFontSize(9);
    doc.setTextColor(150);
    doc.text('Generated with SmartWerk — smartwerk.nl', 15, 285);
  }

  // Save
  doc.save(`Quote-${quoteNumber}.pdf`);
}

function currencySymbol(code) {
  switch (code) {
    case 'EUR':
      return '€';
    case 'USD':
      return '$';
    case 'GBP':
      return '£';
    default:
      return '';
  }
}

    
 </script>
 
</body>
</html>
