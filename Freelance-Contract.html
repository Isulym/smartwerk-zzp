<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Freelance Contract ‚Äî SmartWerk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style-contract.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>üìÉ Freelance Contract</h1>

    <div class="button-group">
      <button id="fillAI" class="btn">‚ö° AI Fill</button>
      <button id="saveContractBtn" class="btn">üíæ Save Contract</button>
      <button id="viewContractsBtn" class="btn">üìÇ View Saved Contracts</button>
      <button id="exportPdfBtn" class="btn">üìÑ Export PDF</button>
    </div>

    <form id="contractForm">
      <h2>Business Info</h2>
      <textarea id="businessInfo" required></textarea>

      <h2>Client Info</h2>
      <textarea id="clientInfo" required></textarea>

      <h2>Project</h2>
      <textarea id="projectTitle" placeholder="Project title" required></textarea>
      <textarea id="projectDescription" placeholder="Describe the project" required></textarea>

      <h2>Payment Terms</h2>
      <textarea id="paymentTerms" required></textarea>

      <h2>Legal</h2>
      <textarea id="legalTerms" required></textarea>

      <h2>Signatures</h2>
      <input type="text" id="businessSignature" placeholder="Business Name & Date" required />
      <input type="text" id="clientSignature" placeholder="Client Name & Date" required />
    </form>

    <div id="savedContracts" style="display:none;">
      <h2>üìÇ Saved Contracts</h2>
      <table>
        <thead>
          <tr>
            <th>Contract No</th>
            <th>Client</th>
            <th>Project</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="savedContractsBody"></tbody>
      </table>
    </div>
  </div>

  <script src="freelance-contract.js"></script>
</body>
</html>

// === DOM Loaded ===
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("fillAI").addEventListener("click", fillContractAI);
  document.getElementById("saveContractBtn").addEventListener("click", saveContract);
  document.getElementById("viewContractsBtn").addEventListener("click", loadSavedContracts);
  document.getElementById("exportPdfBtn").addEventListener("click", exportContractPDF);

  if (!localStorage.getItem("contractCounter")) {
    localStorage.setItem("contractCounter", "1");
  }
});

// === AI Fill ===
function fillContractAI() {
  document.getElementById("businessInfo").value = "SmartWerk B.V.\nKvK: 12345678\nVAT: NL123456789B01\nIBAN: NL12BANK3456789012";
  document.getElementById("clientInfo").value = "Client Company\nClient Address\nKvK: 87654321";
  document.getElementById("projectTitle").value = "Website Development";
  document.getElementById("projectDescription").value = "Developing a modern responsive website with dashboard and user login.";
  document.getElementById("paymentTerms").value = "50% upfront, 50% upon completion.\nTotal: ‚Ç¨2,500\nPayment within 14 days.";
  document.getElementById("legalTerms").value = "Dutch law applies. Disputes handled in Amsterdam court.";
  document.getElementById("businessSignature").value = "SmartWerk ‚Ä¢ 07.09.2025";
  document.getElementById("clientSignature").value = "Client Co ‚Ä¢ 07.09.2025";
}

// === Save Contract ===
function saveContract() {
  const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
  const counter = parseInt(localStorage.getItem("contractCounter"), 10);

  const contract = {
    contractNumber: "CT-" + String(counter).padStart(3, "0"),
    clientName: document.getElementById("clientInfo").value.split("\n")[0] || "Client",
    projectTitle: document.getElementById("projectTitle").value || "-",
    date: new Date().toLocaleDateString(),
    data: {
      businessInfo: document.getElementById("businessInfo").value,
      clientInfo: document.getElementById("clientInfo").value,
      projectTitle: document.getElementById("projectTitle").value,
      projectDescription: document.getElementById("projectDescription").value,
      paymentTerms: document.getElementById("paymentTerms").value,
      legalTerms: document.getElementById("legalTerms").value,
      businessSignature: document.getElementById("businessSignature").value,
      clientSignature: document.getElementById("clientSignature").value,
    }
  };

  saved.push(contract);
  localStorage.setItem("savedContracts", JSON.stringify(saved));
  localStorage.setItem("contractCounter", counter + 1);

  alert("‚úÖ Contract saved!");
}

// === View Saved Contracts ===
function loadSavedContracts() {
  const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
  const tbody = document.getElementById("savedContractsBody");
  const container = document.getElementById("savedContracts");
  if (!tbody || !container) return;

  container.style.display = "block";
  tbody.innerHTML = "";

  saved.forEach((contract, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${contract.contractNumber}</td>
      <td>${contract.clientName}</td>
      <td>${contract.projectTitle}</td>
      <td>${contract.date}</td>
      <td>
        <button class="btn small" onclick="viewContract(${index})">üëÅ View</button>
        <button class="btn small danger" onclick="deleteContract(${index})">üóë Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// === View Contract ===
function viewContract(index) {
  const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
  const data = saved[index]?.data;
  if (!data) return;

  document.getElementById("businessInfo").value = data.businessInfo;
  document.getElementById("clientInfo").value = data.clientInfo;
  document.getElementById("projectTitle").value = data.projectTitle;
  document.getElementById("projectDescription").value = data.projectDescription;
  document.getElementById("paymentTerms").value = data.paymentTerms;
  document.getElementById("legalTerms").value = data.legalTerms;
  document.getElementById("businessSignature").value = data.businessSignature;
  document.getElementById("clientSignature").value = data.clientSignature;

  alert("‚úÖ Contract loaded!");
}

// === Delete Contract ===
function deleteContract(index) {
  const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
  if (confirm("Are you sure you want to delete this contract?")) {
    saved.splice(index, 1);
    localStorage.setItem("savedContracts", JSON.stringify(saved));
    loadSavedContracts();
  }
}

// === Export PDF ===
function exportContractPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const data = {
    businessInfo: document.getElementById("businessInfo").value,
    clientInfo: document.getElementById("clientInfo").value,
    projectTitle: document.getElementById("projectTitle").value,
    projectDescription: document.getElementById("projectDescription").value,
    paymentTerms: document.getElementById("paymentTerms").value,
    legalTerms: document.getElementById("legalTerms").value,
    businessSignature: document.getElementById("businessSignature").value,
    clientSignature: document.getElementById("clientSignature").value,
  };

  let y = 10;
  doc.setFontSize(16);
  doc.text("Freelance Contract", 105, y, null, null, "center");

  y += 10;
  doc.setFontSize(10);
  doc.text("From:", 15, y); doc.text(data.businessInfo, 30, y);
  y += 20;
  doc.text("To:", 15, y); doc.text(data.clientInfo, 30, y);
  y += 20;
  doc.text("Project:", 15, y); doc.text(data.projectTitle, 30, y);
  y += 10; doc.text(data.projectDescription, 30, y);
  y += 20;
  doc.text("Payment Terms:", 15, y); doc.text(data.paymentTerms, 30, y);
  y += 20;
  doc.text("Legal Terms:", 15, y); doc.text(data.legalTerms, 30, y);
  y += 30;
  doc.text("Signatures:", 15, y);
  y += 10;
  doc.text("Business:", 15, y); doc.text(data.businessSignature, 50, y);
  y += 10;
  doc.text("Client:", 15, y); doc.text(data.clientSignature, 50, y);

  // PRO toggle
  const isPro = localStorage.getItem("proUser") === "true";
  if (!isPro) {
    doc.setFontSize(8);
    doc.setTextColor(120);
    doc.text("Generated with SmartWerk ‚Äî smartwerk.nl", 15, 285);
  }

  doc.save(`Contract-${data.projectTitle || "SmartWerk"}.pdf`);
}
</body>
</html>
