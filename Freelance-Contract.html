<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>📃 Freelance Contract - SmartWerk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style-Freelance-Contract.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <header class="topbar">
    <nav class="left">
      <a href="dashboard.html" class="btn">← Back to Dashboard</a>
      <a href="templates.html" class="btn">← Back to Templates</a>
    </nav>
  </header>

  <h1>📃 Create Freelance Contract</h1>
  <p class="small-note">Fill in the contract details, generate PDF/DOCX, save locally or use AI to help you.</p>

  <div class="section"><h2>Business Info</h2>
    <input id="businessName" placeholder="Your Business Name" />
    <input id="businessKvK" placeholder="KvK Number (optional)" />
    <input id="businessVAT" placeholder="VAT Number (optional)" />
    <input id="businessIBAN" placeholder="IBAN (optional)" />
  </div>

  <div class="section"><h2>Client Info</h2>
    <input id="clientName" placeholder="Client Name" />
    <input id="clientAddress" placeholder="Client Address (optional)" />
  </div>

  <div class="section"><h2>Project</h2>
    <textarea id="projectDescription" placeholder="Describe the project scope..."></textarea>
    <textarea id="timeline" placeholder="Timeline / Milestones (optional)"></textarea>
  </div>

  <div class="section"><h2>Payment Terms</h2>
    <input id="rate" placeholder="Total Rate / Hourly Rate" />
    <textarea id="paymentTerms" placeholder="E.g. 50% upfront, 50% after delivery (optional)"></textarea>
  </div>

  <div class="section"><h2>Legal</h2>
    <textarea id="terminationClause" placeholder="Termination terms, cancellation period, etc."></textarea>
    <textarea id="jurisdiction" placeholder="This contract is governed by the laws of the Netherlands."></textarea>
  </div>

  <div class="section"><h2>Signature</h2>
    <input id="signatureName" placeholder="Your Name" />
    <input type="date" id="contractDate" />
  </div>

  <div class="btn-group">
    <button onclick="fillAI()">⚡ AI Fill</button>
    <button onclick="saveContract()">💾 Save Contract</button>
    <button onclick="viewSavedContracts()">📂 View Saved Contracts</button>
    <button type="button" id="exportPdfBtn" class="btn">📄 Export PDF</button>
  </div>

  <div class="section">
    <h2>Preview</h2>
    <div id="contractPreview">Contract will appear here...</div>
  </div>

  <div class="section" id="savedSection" style="display:none;">
    <h2>📁 Saved Contracts</h2>
    <table>
      <thead>
        <tr><th>Client</th><th>Project</th><th>Date</th><th>Actions</th></tr>
      </thead>
      <tbody id="savedContractsBody"></tbody>
    </table>
  </div>

  <script>
    function generateContractText() {
      const today = new Date().toLocaleDateString();
      return `
FREELANCE CONTRACT

Date: ${document.getElementById('contractDate').value || today}
Business: ${businessName.value}
KvK: ${businessKvK.value}
VAT: ${businessVAT.value}
IBAN: ${businessIBAN.value}

Client: ${clientName.value}
Address: ${clientAddress.value}

Project:
${projectDescription.value}

Timeline:
${timeline.value}

Payment Terms:
${rate.value}
${paymentTerms.value}

Legal:
${terminationClause.value}
${jurisdiction.value}

Signature: ${signatureName.value}
      `.trim();
    }

    function updatePreview() {
      document.getElementById('contractPreview').textContent = generateContractText();
    }

    document.querySelectorAll("input, textarea").forEach(f => f.addEventListener("input", updatePreview));

    function fillAI() {
      businessName.value = "SmartWerk Solutions";
      businessKvK.value = "12345678";
      businessVAT.value = "NL001234567B01";
      businessIBAN.value = "NL91ABNA0417164300";
      clientName.value = "Creative Agency BV";
      clientAddress.value = "Keizersgracht 123, Amsterdam";
      projectDescription.value = "Develop a custom invoicing tool with real-time tax calculation.";
      timeline.value = "Week 1: Planning, Week 2–3: Development, Week 4: Testing";
      rate.value = "€2,000 fixed";
      paymentTerms.value = "50% upfront, 50% upon delivery.";
      terminationClause.value = "Each party can terminate with 14 days' notice.";
      jurisdiction.value = "Dutch law applies.";
      signatureName.value = "John Freelancer";
      contractDate.value = new Date().toISOString().split("T")[0];
      updatePreview();
    }

    function saveContract() {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      const contract = {
        client: clientName.value,
        project: projectDescription.value.slice(0, 30),
        date: contractDate.value || new Date().toISOString().split("T")[0],
        content: generateContractText()
      };
      saved.push(contract);
      localStorage.setItem("savedContracts", JSON.stringify(saved));
      alert("✅ Contract saved!");
    }

    function viewSavedContracts() {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      const section = document.getElementById("savedSection");
      const tbody = document.getElementById("savedContractsBody");
      section.style.display = "block";
      tbody.innerHTML = "";
      saved.forEach((c, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${c.client}</td>
          <td>${c.project}</td>
          <td>${c.date}</td>
          <td>
            <button class="btn small" onclick="openPreview(${i})">👁 View</button>
            <button class="btn small danger" onclick="deleteContract(${i})">🗑 Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function openPreview(index) {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      alert("📄 Contract Preview:\n\n" + saved[index].content);
    }

    function deleteContract(index) {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      saved.splice(index, 1);
      localStorage.setItem("savedContracts", JSON.stringify(saved));
      viewSavedContracts();
    }

   async function exportContractPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "pt", format: "a4" });

  const isPro = localStorage.getItem("proUser") === "true";
  const margin = 40;
  let y = margin;

  // ===== HEADER =====
  doc.setFontSize(16);
  doc.setFont("helvetica", "bold");
  doc.text("Freelance Contract", margin, y);
  y += 30;

  // ====== LEFT COLUMN ======
  const leftStart = margin;
  let leftY = y;

  const businessInfo = [
    `Business Name: ${document.getElementById("businessName").value}`,
    `Business Address: ${document.getElementById("businessAddress").value}`,
    `KVK: ${document.getElementById("businessKVK").value}`,
    `VAT: ${document.getElementById("businessBTW").value}`,
    `IBAN: ${document.getElementById("businessIBAN").value}`,
    `Phone: ${document.getElementById("businessPhone").value}`
  ];

  const clientInfo = [
    `Client Name: ${document.getElementById("clientName").value}`,
    `Client Address: ${document.getElementById("clientAddress").value}`,
    `Email: ${document.getElementById("clientEmail").value}`,
    `Phone: ${document.getElementById("clientPhone").value}`
  ];

  const projectInfo = [
    `Project Title: ${document.getElementById("projectTitle").value}`,
    `Start Date: ${document.getElementById("startDate").value}`,
    `End Date: ${document.getElementById("endDate").value}`,
    `Deliverables: ${document.getElementById("deliverables").value}`
  ];

  const leftBlocks = [
    ["Business Info", businessInfo],
    ["Client Info", clientInfo],
    ["Project", projectInfo]
  ];

  doc.setFontSize(12);
  leftBlocks.forEach(([title, lines]) => {
    doc.setFont("helvetica", "bold");
    doc.text(title, leftStart, leftY);
    doc.setFont("helvetica", "normal");
    lines.forEach(line => {
      leftY += 14;
      doc.text(line, leftStart, leftY);
    });
    leftY += 20;
  });

  // ====== RIGHT COLUMN ======
  const rightStart = 310;
  let rightY = y;

  const paymentTerms = [
    `Payment Terms: ${document.getElementById("paymentTerms").value}`,
    `Payment Amount: ${document.getElementById("paymentAmount").value}`,
    `Currency: ${document.getElementById("currency").value}`
  ];

  const legal = [
    `Legal Terms:`,
    document.getElementById("legalTerms").value
  ];

  const signatures = [
    `Business Signature: ${document.getElementById("signatureBusiness").value}`,
    `Client Signature: ${document.getElementById("signatureClient").value}`,
    `Signed Date: ${document.getElementById("signatureDate").value}`
  ];

  const rightBlocks = [
    ["Payment Terms", paymentTerms],
    ["Legal", legal],
    ["Signature", signatures]
  ];

  rightBlocks.forEach(([title, lines]) => {
    doc.setFont("helvetica", "bold");
    doc.text(title, rightStart, rightY);
    doc.setFont("helvetica", "normal");
    lines.forEach(line => {
      const wrapped = doc.splitTextToSize(line, 230);
      wrapped.forEach(w => {
        rightY += 14;
        doc.text(w, rightStart, rightY);
      });
    });
    rightY += 20;
  });

  // ===== FOOTER =====
  if (!isPro) {
    doc.setFontSize(10);
    doc.setTextColor(150);
    doc.text("Generated with SmartWerk — www.smartwerk.nl", margin, 800);
  }

  // ===== SAVE PDF =====
  const contractNumber = document.getElementById("contractNumber").value || "Contract";
  doc.save(`${contractNumber}.pdf`);
}
    document.addEventListener("DOMContentLoaded", () => {
  const exportBtn = document.getElementById("exportPdfBtn");
  if (exportBtn) {
    exportBtn.addEventListener("click", exportContractPDF);
  }
});
    document.getElementById("exportPdfBtn").addEventListener("click", exportContractPDF);
  </script>
</body>
</html>
