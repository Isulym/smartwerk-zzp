<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>📃 Freelance Contract — SmartWerk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style-contract.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header class="topbar">
      <a class="brand" href="templates.html">📃 Freelance Contract</a>
      <nav class="right">
        <a href="dashboard.html" class="btn">← Back to Dashboard</a>
        <a href="templates.html" class="btn">← Back to Templates</a>
      </nav>
    </header>

    <form id="contractForm">
      <h2>🧾 Business Info</h2>
      <input id="businessName" placeholder="Business Name" required />
      <input id="businessAddress" placeholder="Business Address" />
      <input id="businessKvK" placeholder="KvK Number" />
      <input id="businessVAT" placeholder="VAT Number" />

      <h2>👤 Client Info</h2>
      <input id="clientName" placeholder="Client Name" required />
      <input id="clientAddress" placeholder="Client Address" />
      <input id="clientEmail" placeholder="Client Email" />
      <input id="clientPhone" placeholder="Client Phone" />

      <h2>💼 Project</h2>
      <input id="projectTitle" placeholder="Project Title" required />
      <textarea id="projectDescription" placeholder="Project Description"></textarea>

      <h2>⏱ Timeline & Deliverables</h2>
      <textarea id="timeline" placeholder="Timeline and Deliverables..."></textarea>

      <h2>💶 Payment Terms</h2>
      <textarea id="paymentTerms" placeholder="Payment Terms..."></textarea>

      <h2>📜 Legal</h2>
      <textarea id="legalTerms" placeholder="Legal Terms and Conditions..."></textarea>

      <h2>✍️ Signatures</h2>
      <input id="signatureBusiness" placeholder="Business Signature" />
      <input id="signatureClient" placeholder="Client Signature" />
      <input id="contractDate" type="date" />

      <div class="actions">
        <button type="button" id="aiFillBtn" class="btn">⚡ AI Fill</button>
        <button type="button" id="saveContractBtn" class="btn primary">💾 Save Contract</button>
        <button type="button" id="viewContractsBtn" class="btn">📂 View Saved Contracts</button>
        <button type="button" id="exportPdfBtn" class="btn">📄 Export PDF</button>
      </div>
    </form>

    <div id="savedContractsSection" style="display:none;">
      <h2>📂 Saved Contracts</h2>
      <table>
        <thead>
          <tr><th>Contract No</th><th>Client</th><th>Project</th><th>Date</th><th>Actions</th></tr>
        </thead>
        <tbody id="savedContractsBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    // Save contract
    document.getElementById("saveContractBtn").addEventListener("click", () => {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      const contract = {
        contractNumber: "C-" + Date.now(),
        clientName: document.getElementById("clientName").value,
        projectTitle: document.getElementById("projectTitle").value,
        date: new Date().toLocaleDateString(),
        businessName: document.getElementById("businessName").value,
        businessAddress: document.getElementById("businessAddress").value,
        businessKvK: document.getElementById("businessKvK").value,
        businessVAT: document.getElementById("businessVAT").value,
        clientAddress: document.getElementById("clientAddress").value,
        clientEmail: document.getElementById("clientEmail").value,
        clientPhone: document.getElementById("clientPhone").value,
        projectDescription: document.getElementById("projectDescription").value,
        timeline: document.getElementById("timeline").value,
        paymentTerms: document.getElementById("paymentTerms").value,
        legalTerms: document.getElementById("legalTerms").value,
        signatureBusiness: document.getElementById("signatureBusiness").value,
        signatureClient: document.getElementById("signatureClient").value,
        contractDate: document.getElementById("contractDate").value,
      };
      saved.push(contract);
      localStorage.setItem("savedContracts", JSON.stringify(saved));
      alert("✅ Contract saved");
    });

    // View saved contracts
    document.getElementById("viewContractsBtn").addEventListener("click", () => {
      document.getElementById("savedContractsSection").style.display = "block";
      loadSavedContracts();
    });

    function loadSavedContracts() {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      const tbody = document.getElementById("savedContractsBody");
      tbody.innerHTML = "";
      saved.forEach((c, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${c.contractNumber}</td>
          <td>${c.clientName}</td>
          <td>${c.projectTitle}</td>
          <td>${c.date}</td>
          <td>
            <button class="btn small" onclick="loadContract(${i})">👁 View</button>
            <button class="btn small danger" onclick="deleteContract(${i})">🗑 Delete</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    function loadContract(index) {
      const c = JSON.parse(localStorage.getItem("savedContracts"))[index];
      for (let key in c) {
        const el = document.getElementById(key);
        if (el) el.value = c[key];
      }
      alert("✅ Contract loaded into form");
    }

    function deleteContract(index) {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      saved.splice(index, 1);
      localStorage.setItem("savedContracts", JSON.stringify(saved));
      loadSavedContracts();
    }

    // AI Fill (dummy)
    document.getElementById("aiFillBtn").addEventListener("click", () => {
      document.getElementById("projectDescription").value = "Redesign and optimization of the client's website.";
      document.getElementById("timeline").value = "Project starts 10.09.2025 and ends 30.09.2025.";
      document.getElementById("paymentTerms").value = "€1000 upfront, €1000 after delivery.";
      document.getElementById("legalTerms").value = "Standard freelance contract terms apply.";
    });

    // Export PDF
    document.getElementById("exportPdfBtn").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(12);
      doc.text("Freelance Contract", 15, 15);
      const lines = [
        "Business: " + document.getElementById("businessName").value,
        "Client: " + document.getElementById("clientName").value,
        "Project: " + document.getElementById("projectTitle").value,
        "Description: " + document.getElementById("projectDescription").value,
        "Timeline: " + document.getElementById("timeline").value,
        "Payment Terms: " + document.getElementById("paymentTerms").value,
        "Legal Terms: " + document.getElementById("legalTerms").value,
        "Signatures: " + document.getElementById("signatureBusiness").value + " / " + document.getElementById("signatureClient").value,
        "Date: " + document.getElementById("contractDate").value,
      ];
      doc.text(lines, 15, 25);
      doc.save("Freelance-Contract.pdf");
    });
  </script>
</body>
</html>
