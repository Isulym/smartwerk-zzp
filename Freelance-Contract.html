<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>📃 Freelance Contract — SmartWerk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style-Freelance-Contract.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header class="topbar">
      <a class="brand" href="templates.html">📃 Freelance Contract</a>
      <nav class="right">
        <a href="dashboard.html" class="btn">← Back to Dashboard</a>
        <a href="templates.html" class="btn">← Back to Templates</a>
      </nav>
    </header>

    <form id="contractForm">
      <h2>🧾 Business Info</h2>
      <input id="businessName" placeholder="Business Name" required />
      <input id="businessAddress" placeholder="Business Address" />
      <input id="businessKvK" placeholder="KvK Number" />
      <input id="businessVAT" placeholder="VAT Number" />

      <h2>👤 Client Info</h2>
      <input id="clientName" placeholder="Client Name" required />
      <input id="clientAddress" placeholder="Client Address" />
      <input id="clientEmail" placeholder="Client Email" />
      <input id="clientPhone" placeholder="Client Phone" />

      <h2>💼 Project</h2>
      <input id="projectTitle" placeholder="Project Title" required />
      <textarea id="projectDescription" placeholder="Project Description"></textarea>

      <h2>⏱ Timeline & Deliverables</h2>
      <textarea id="timeline" placeholder="Timeline and Deliverables..."></textarea>

      <h2>💶 Payment Terms</h2>
      <textarea id="paymentTerms" placeholder="Payment Terms..."></textarea>

      <h2>📜 Legal</h2>
      <textarea id="legalTerms" placeholder="Legal Terms and Conditions..."></textarea>

      <h2>✍️ Signatures</h2>
      <input id="signatureBusiness" placeholder="Business Signature" />
      <input id="signatureClient" placeholder="Client Signature" />
      <input id="contractDate" type="date" />

      <div class="actions">
        <button type="button" id="aiFillBtn" class="btn">⚡ AI Fill</button>
        <button type="button" id="saveContractBtn" class="btn primary">💾 Save Contract</button>
        <button type="button" id="viewContractsBtn" class="btn">📂 View Saved Contracts</button>
        <button type="button" id="exportPdfBtn" class="btn">📄 Export PDF</button>
      </div>
    </form>
    
  <div class="form-section">
  <label>
    <input type="checkbox" id="togglePro" />
    Enable PRO (no branding in PDF)
  </label>
</div>

    <div id="savedContractsSection" style="display:none;">
      <h2>📂 Saved Contracts</h2>
      <table>
        <thead>
          <tr><th>Contract No</th><th>Client</th><th>Project</th><th>Date</th><th>Actions</th></tr>
        </thead>
        <tbody id="savedContractsBody"></tbody>
      </table>
    </div>
  </div>

  <script>

    // === PRO toggle ===
const togglePro = document.getElementById("togglePro");
if (togglePro) {
  togglePro.checked = localStorage.getItem("proUser") === "true";
  togglePro.addEventListener("change", (e) => {
    localStorage.setItem("proUser", e.target.checked ? "true" : "false");
  });
}
    
    // Save contract
    document.getElementById("saveContractBtn").addEventListener("click", () => {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      const contract = {
        contractNumber: "C-" + Date.now(),
        clientName: document.getElementById("clientName").value,
        projectTitle: document.getElementById("projectTitle").value,
        date: new Date().toLocaleDateString(),
        businessName: document.getElementById("businessName").value,
        businessAddress: document.getElementById("businessAddress").value,
        businessKvK: document.getElementById("businessKvK").value,
        businessVAT: document.getElementById("businessVAT").value,
        clientAddress: document.getElementById("clientAddress").value,
        clientEmail: document.getElementById("clientEmail").value,
        clientPhone: document.getElementById("clientPhone").value,
        projectDescription: document.getElementById("projectDescription").value,
        timeline: document.getElementById("timeline").value,
        paymentTerms: document.getElementById("paymentTerms").value,
        legalTerms: document.getElementById("legalTerms").value,
        signatureBusiness: document.getElementById("signatureBusiness").value,
        signatureClient: document.getElementById("signatureClient").value,
        contractDate: document.getElementById("contractDate").value,
      };
      saved.push(contract);
      localStorage.setItem("savedContracts", JSON.stringify(saved));
      alert("✅ Contract saved");
    });

    // View saved contracts
    document.getElementById("viewContractsBtn").addEventListener("click", () => {
      document.getElementById("savedContractsSection").style.display = "block";
      loadSavedContracts();
    });

    function loadSavedContracts() {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      const tbody = document.getElementById("savedContractsBody");
      tbody.innerHTML = "";
      saved.forEach((c, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${c.contractNumber}</td>
          <td>${c.clientName}</td>
          <td>${c.projectTitle}</td>
          <td>${c.date}</td>
          <td>
            <button class="btn small" onclick="loadContract(${i})">👁 View</button>
            <button class="btn small danger" onclick="deleteContract(${i})">🗑 Delete</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    function loadContract(index) {
      const c = JSON.parse(localStorage.getItem("savedContracts"))[index];
      for (let key in c) {
        const el = document.getElementById(key);
        if (el) el.value = c[key];
      }
      alert("✅ Contract loaded into form");
    }

    function deleteContract(index) {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      saved.splice(index, 1);
      localStorage.setItem("savedContracts", JSON.stringify(saved));
      loadSavedContracts();
    }

    // AI Fill (dummy)
    document.getElementById("aiFillBtn").addEventListener("click", () => {
      document.getElementById("projectDescription").value = "Redesign and optimization of the client's website.";
      document.getElementById("timeline").value = "Project starts 10.09.2025 and ends 30.09.2025.";
      document.getElementById("paymentTerms").value = "€1000 upfront, €1000 after delivery.";
      document.getElementById("legalTerms").value = "Standard freelance contract terms apply.";
    });

    // Export PDF
document.addEventListener("DOMContentLoaded", () => {
  const exportBtn = document.getElementById("exportPdfBtn");
  if (exportBtn) {
    exportBtn.addEventListener("click", async () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Отримуємо дані з форми
      const businessName = document.getElementById("businessName")?.value || "";
      const clientName = document.getElementById("clientName")?.value || "";
      const projectTitle = document.getElementById("projectTitle")?.value || "";
      const projectDescription = document.getElementById("projectDescription")?.value || "";
      const timeline = document.getElementById("timeline")?.value || "";
      const paymentTerms = document.getElementById("paymentTerms")?.value || "";
      const legalTerms = document.getElementById("legalTerms")?.value || "";
      const freelancerName = document.getElementById("freelancerName")?.value || "";
      const clientSign = document.getElementById("clientSign")?.value || "";
      const signatureDate = document.getElementById("signatureDate")?.value || "";

      let y = 20;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(16);
      doc.text("Freelance Contract", 105, y, { align: "center" });

      y += 10;
      doc.setFont("helvetica", "normal");
      doc.setFontSize(11);

      const addSection = (title, lines) => {
        doc.setFont("helvetica", "bold");
        doc.text(title, 20, y);
        y += 6;
        doc.setFont("helvetica", "normal");
        lines.forEach(line => {
          doc.text(line, 25, y);
          y += 6;
        });
        y += 4;
      };

      addSection("Business Info", [`Name: ${businessName}`]);
      addSection("Client Info", [`Name: ${clientName}`]);
      addSection("Project", [
        `Title: ${projectTitle}`,
        `Description: ${projectDescription}`,
      ]);
      addSection("Timeline", [timeline]);
      addSection("Payment Terms", [paymentTerms]);
      addSection("Legal Terms", [legalTerms]);
      addSection("Signatures", [
        `Freelancer: ${freelancerName}`,
        `Client: ${clientSign}`,
        `Date: ${signatureDate}`,
      ]);

      // Branding (якщо не PRO)
      const isPro = document.getElementById("enablePro")?.checked;
      if (!isPro) {
        doc.setFontSize(9);
        doc.setTextColor(150);
        doc.text("Generated with SmartWerk — smartwerk.nl", 105, 285, { align: "center" });
      }

      doc.save(`Contract-${Date.now()}.pdf`);
    });
  }
});
  </script>
</body>
</html>
