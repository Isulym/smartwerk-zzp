<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üìÉ Freelance Contract - SmartWerk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style-Freelance-Contract.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <header class="topbar">
    <nav class="left">
      <a href="dashboard.html" class="btn">‚Üê Back to Dashboard</a>
      <a href="templates.html" class="btn">‚Üê Back to Templates</a>
    </nav>
  </header>

  <h1>üìÉ Create Freelance Contract</h1>
  <p class="small-note">Fill in the contract details, generate PDF/DOCX, save locally or use AI to help you.</p>

  <div class="section"><h2>Business Info</h2>
    <input id="businessName" placeholder="Your Business Name" />
    <input id="businessKvK" placeholder="KvK Number (optional)" />
    <input id="businessVAT" placeholder="VAT Number (optional)" />
    <input id="businessIBAN" placeholder="IBAN (optional)" />
  </div>

  <div class="section"><h2>Client Info</h2>
    <input id="clientName" placeholder="Client Name" />
    <input id="clientAddress" placeholder="Client Address (optional)" />
  </div>

  <div class="section"><h2>Project</h2>
    <textarea id="projectDescription" placeholder="Describe the project scope..."></textarea>
    <textarea id="timeline" placeholder="Timeline / Milestones (optional)"></textarea>
  </div>

  <div class="section"><h2>Payment Terms</h2>
    <input id="rate" placeholder="Total Rate / Hourly Rate" />
    <textarea id="paymentTerms" placeholder="E.g. 50% upfront, 50% after delivery (optional)"></textarea>
  </div>

  <div class="section"><h2>Legal</h2>
    <textarea id="terminationClause" placeholder="Termination terms, cancellation period, etc."></textarea>
    <textarea id="jurisdiction" placeholder="This contract is governed by the laws of the Netherlands."></textarea>
  </div>

  <div class="section"><h2>Signature</h2>
    <input id="signatureName" placeholder="Your Name" />
    <input type="date" id="contractDate" />
  </div>

  <div class="btn-group">
    <button onclick="fillAI()">‚ö° AI Fill</button>
    <button onclick="saveContract()">üíæ Save Contract</button>
    <button onclick="viewSavedContracts()">üìÇ View Saved Contracts</button>
    <button type="button" id="exportPdfBtn" class="btn">üìÑ Export PDF</button>
  </div>

  <div class="section">
    <h2>Preview</h2>
    <div id="contractPreview">Contract will appear here...</div>
  </div>

  <div class="section" id="savedSection" style="display:none;">
    <h2>üìÅ Saved Contracts</h2>
    <table>
      <thead>
        <tr><th>Client</th><th>Project</th><th>Date</th><th>Actions</th></tr>
      </thead>
      <tbody id="savedContractsBody"></tbody>
    </table>
  </div>

  <script>
    function generateContractText() {
      const today = new Date().toLocaleDateString();
      return `
FREELANCE CONTRACT

Date: ${document.getElementById('contractDate').value || today}
Business: ${businessName.value}
KvK: ${businessKvK.value}
VAT: ${businessVAT.value}
IBAN: ${businessIBAN.value}

Client: ${clientName.value}
Address: ${clientAddress.value}

Project:
${projectDescription.value}

Timeline:
${timeline.value}

Payment Terms:
${rate.value}
${paymentTerms.value}

Legal:
${terminationClause.value}
${jurisdiction.value}

Signature: ${signatureName.value}
      `.trim();
    }

    function updatePreview() {
      document.getElementById('contractPreview').textContent = generateContractText();
    }

    document.querySelectorAll("input, textarea").forEach(f => f.addEventListener("input", updatePreview));

    function fillAI() {
      businessName.value = "SmartWerk Solutions";
      businessKvK.value = "12345678";
      businessVAT.value = "NL001234567B01";
      businessIBAN.value = "NL91ABNA0417164300";
      clientName.value = "Creative Agency BV";
      clientAddress.value = "Keizersgracht 123, Amsterdam";
      projectDescription.value = "Develop a custom invoicing tool with real-time tax calculation.";
      timeline.value = "Week 1: Planning, Week 2‚Äì3: Development, Week 4: Testing";
      rate.value = "‚Ç¨2,000 fixed";
      paymentTerms.value = "50% upfront, 50% upon delivery.";
      terminationClause.value = "Each party can terminate with 14 days' notice.";
      jurisdiction.value = "Dutch law applies.";
      signatureName.value = "John Freelancer";
      contractDate.value = new Date().toISOString().split("T")[0];
      updatePreview();
    }

    function saveContract() {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      const contract = {
        client: clientName.value,
        project: projectDescription.value.slice(0, 30),
        date: contractDate.value || new Date().toISOString().split("T")[0],
        content: generateContractText()
      };
      saved.push(contract);
      localStorage.setItem("savedContracts", JSON.stringify(saved));
      alert("‚úÖ Contract saved!");
    }

    function viewSavedContracts() {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      const section = document.getElementById("savedSection");
      const tbody = document.getElementById("savedContractsBody");
      section.style.display = "block";
      tbody.innerHTML = "";
      saved.forEach((c, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${c.client}</td>
          <td>${c.project}</td>
          <td>${c.date}</td>
          <td>
            <button class="btn small" onclick="openPreview(${i})">üëÅ View</button>
            <button class="btn small danger" onclick="deleteContract(${i})">üóë Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function openPreview(index) {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      alert("üìÑ Contract Preview:\n\n" + saved[index].content);
    }

    function deleteContract(index) {
      const saved = JSON.parse(localStorage.getItem("savedContracts") || "[]");
      saved.splice(index, 1);
      localStorage.setItem("savedContracts", JSON.stringify(saved));
      viewSavedContracts();
    }

function exportContractPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const get = (id) => document.getElementById(id)?.value || '';

  const contractNumber = get("contractNumber");
  const businessName = get("businessName");
  const businessAddress = get("businessAddress");
  const businessKVK = get("businessKVK");
  const businessBTW = get("businessBTW");
  const businessIBAN = get("businessIBAN");
  const businessPhone = get("businessPhone");

  const clientName = get("clientName");
  const clientAddress = get("clientAddress");
  const clientEmail = get("clientEmail");
  const clientPhone = get("clientPhone");

  const projectTitle = get("projectTitle");
  const projectDescription = get("projectDescription");
  const projectTimeline = get("projectTimeline");
  const paymentTerms = get("paymentTerms");
  const legalTerms = get("legalTerms");

  const signatureName = get("signatureName");
  const signatureDate = get("signatureDate");

  let y = 15;
  doc.setFontSize(12);
  doc.text(`Freelance Contract`, 15, y);

  y += 10;
  doc.setFontSize(10);
  doc.setFont(undefined, 'bold');
  doc.text("Business Info:", 15, y);
  doc.setFont(undefined, 'normal');
  doc.text(`${businessName}`, 15, y + 5);
  doc.text(`Address: ${businessAddress}`, 15, y + 10);
  doc.text(`KVK: ${businessKVK}`, 15, y + 15);
  doc.text(`BTW: ${businessBTW}`, 15, y + 20);
  doc.text(`IBAN: ${businessIBAN}`, 15, y + 25);
  doc.text(`Phone: ${businessPhone}`, 15, y + 30);

  y += 40;
  doc.setFont(undefined, 'bold');
  doc.text("Client Info:", 15, y);
  doc.setFont(undefined, 'normal');
  doc.text(`${clientName}`, 15, y + 5);
  doc.text(`Address: ${clientAddress}`, 15, y + 10);
  doc.text(`Email: ${clientEmail}`, 15, y + 15);
  doc.text(`Phone: ${clientPhone}`, 15, y + 20);

  y += 35;
  doc.setFont(undefined, 'bold');
  doc.text("Project Details:", 15, y);
  doc.setFont(undefined, 'normal');
  doc.text(`Title: ${projectTitle}`, 15, y + 5);
  doc.text(`Description: ${projectDescription}`, 15, y + 10);
  doc.text(`Timeline: ${projectTimeline}`, 15, y + 15);

  y += 25;
  doc.setFont(undefined, 'bold');
  doc.text("Payment Terms:", 15, y);
  doc.setFont(undefined, 'normal');
  doc.text(`${paymentTerms}`, 15, y + 5);

  y += 15;
  doc.setFont(undefined, 'bold');
  doc.text("Legal Terms:", 15, y);
  doc.setFont(undefined, 'normal');
  doc.text(`${legalTerms}`, 15, y + 5);

  y += 25;
  doc.setFont(undefined, 'bold');
  doc.text("Signatures:", 15, y);
  doc.setFont(undefined, 'normal');
  doc.text(`Name: ${signatureName}`, 15, y + 5);
  doc.text(`Date: ${signatureDate}`, 15, y + 10);

  // Branding / watermark
  const removeBranding = localStorage.getItem("proUser") === "true";
  if (!removeBranding) {
    doc.setFontSize(8);
    doc.setTextColor(150);
    doc.text("Generated with SmartWerk ‚Äî smartwerk.nl", 15, 285);
  }

  doc.save(`Contract-${contractNumber || 'Draft'}.pdf`);
}
    document.getElementById("exportPdfBtn").addEventListener("click", exportContractPDF);
  </script>
</body>
</html>
