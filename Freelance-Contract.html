<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>📃 Freelance Contract - SmartWerk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style-Freelance-Contract.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <header class="topbar">
    <nav class="left">
      <a href="dashboard.html" class="btn">← Back to Dashboard</a>
      <a href="templates.html" class="btn">← Back to Templates</a>
    </nav>
  </header>

  <h1>📃 Create Freelance Contract</h1>
  <p class="small-note">Fill in the contract details, generate PDF/DOCX, save locally or use AI to help you.</p>

  <div class="section">
    <h2>Business Info</h2>
    <input id="businessName" placeholder="Your Business Name" />
    <input id="businessKvK" placeholder="KvK Number (optional)" />
    <input id="businessVAT" placeholder="VAT Number (optional)" />
    <input id="businessIBAN" placeholder="IBAN (optional)" />
  </div>

  <div class="section">
    <h2>Client Info</h2>
    <input id="clientName" placeholder="Client Name" />
    <input id="clientAddress" placeholder="Client Address (optional)" />
  </div>

  <div class="section">
    <h2>Project</h2>
    <textarea id="projectDescription" placeholder="Describe the project scope..."></textarea>
    <textarea id="timeline" placeholder="Timeline / Milestones (optional)"></textarea>
  </div>

  <div class="section">
    <h2>Payment Terms</h2>
    <input id="rate" placeholder="Total Rate / Hourly Rate" />
    <textarea id="paymentTerms" placeholder="E.g. 50% upfront, 50% after delivery (optional)"></textarea>
  </div>

  <div class="section">
    <h2>Legal</h2>
    <textarea id="terminationClause" placeholder="Termination terms, cancellation period, etc."></textarea>
    <textarea id="jurisdiction" placeholder="This contract is governed by the laws of the Netherlands."></textarea>
  </div>

  <div class="section">
    <h2>Signature</h2>
    <input id="signatureName" placeholder="Your Name" />
    <input type="date" id="contractDate" />
  </div>

  <div class="btn-group">
    <button onclick="fillAI()">⚡ AI Fill</button>
    <button onclick="saveContract()">💾 Save Contract</button>
    <button onclick="viewSavedContracts()">📂 View Saved Contracts</button>
    <button id="exportPdfBtn">📄 Export PDF</button>
    <button onclick="downloadDOCX()">Download DOCX</button>
  </div>

  <div class="section">
    <h2>Preview</h2>
    <div id="contractPreview" style="white-space: pre-line;">Contract will appear here...</div>
  </div>

  <div class="section" id="savedContractsSection" style="display:none">
    <h2>Saved Contracts</h2>
    <table>
      <thead>
        <tr>
          <th>Client</th>
          <th>Project</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="savedContractsBody"></tbody>
    </table>
  </div>

  <script>
    function generateContractText() {
      const today = new Date().toLocaleDateString();
      return `
FREELANCE CONTRACT

Date: ${document.getElementById('contractDate').value || today}
Business: ${businessName.value}
KvK: ${businessKvK.value}
VAT: ${businessVAT.value}
IBAN: ${businessIBAN.value}

Client: ${clientName.value}
Address: ${clientAddress.value}

Project:
${projectDescription.value}

Timeline:
${timeline.value}

Payment Terms:
${rate.value}
${paymentTerms.value}

Legal:
${terminationClause.value}
${jurisdiction.value}

Signature: ${signatureName.value}
      `.trim();
    }

    function updatePreview() {
      document.getElementById('contractPreview').textContent = generateContractText();
    }

    document.querySelectorAll("input, textarea").forEach(f => f.addEventListener("input", updatePreview));
    updatePreview();

    function fillAI() {
      businessName.value = "SmartWerk Freelance";
      businessKvK.value = "12345678";
      businessVAT.value = "NL000099998B57";
      businessIBAN.value = "NL99BANK0123456789";
      clientName.value = "Client Company B.V.";
      clientAddress.value = "Keizersgracht 123, 1015CJ Amsterdam";
      projectDescription.value = "Develop a multilingual responsive website for online services.";
      timeline.value = "Week 1: UI/UX. Week 2: Dev. Week 3: Testing.";
      rate.value = "€3500 fixed";
      paymentTerms.value = "50% upfront, 50% upon delivery";
      terminationClause.value = "Termination with 7 days notice from either side.";
      jurisdiction.value = "This contract is governed by the laws of the Netherlands.";
      signatureName.value = "John Freelancer";
      contractDate.value = new Date().toISOString().split('T')[0];
      updatePreview();
    }

    function saveContract() {
      const saved = JSON.parse(localStorage.getItem("contracts") || "[]");
      saved.push({
        client: clientName.value,
        project: projectDescription.value.slice(0, 50),
        date: contractDate.value || new Date().toLocaleDateString(),
        text: generateContractText()
      });
      localStorage.setItem("contracts", JSON.stringify(saved));
      alert("✅ Contract saved!");
    }

    function viewSavedContracts() {
      const saved = JSON.parse(localStorage.getItem("contracts") || "[]");
      const section = document.getElementById("savedContractsSection");
      const tbody = document.getElementById("savedContractsBody");
      section.style.display = "block";
      tbody.innerHTML = "";
      saved.forEach((c, i) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${c.client}</td>
          <td>${c.project}</td>
          <td>${c.date}</td>
          <td>
            <button onclick="loadContract(${i})">👁 View</button>
            <button onclick="deleteContract(${i})">🗑 Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function loadContract(index) {
      const saved = JSON.parse(localStorage.getItem("contracts") || "[]");
      const c = saved[index];
      if (!c) return;
      alert("Loaded contract:\n\n" + c.text);
    }

    function deleteContract(index) {
      const saved = JSON.parse(localStorage.getItem("contracts") || "[]");
      saved.splice(index, 1);
      localStorage.setItem("contracts", JSON.stringify(saved));
      viewSavedContracts();
    }

    document.getElementById("exportPdfBtn").addEventListener("click", () => {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const text = generateContractText().split("\n");
      let y = 15;
      text.forEach(line => {
        doc.text(line, 15, y);
        y += 7;
      });

      const isPro = localStorage.getItem("proUser") === "true";
      if (!isPro) {
        doc.setFontSize(10);
        doc.setTextColor(150);
        doc.text("Generated by SmartWerk — smartwerk.nl", 15, 285);
      }

      doc.save("SmartWerk-Freelance-Contract.pdf");
    });

    function downloadDOCX() {
      const text = generateContractText();
      const blob = new Blob([text], { type: "application/msword" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `SmartWerk-Freelance-Contract.doc`;
      link.click();
    }
  </script>
</body>
</html>
