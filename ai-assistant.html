<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartWerk AI Assistant</title>
  <style>
    :root { --bg:#0e0e0e; --panel:#111; --muted:#bbb; --btn:#2a2a2a; --white:#fff; }
    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; background:#000; color:var(--white); font-family:system-ui, Arial, sans-serif; }
    .container { height:100vh; display:flex; flex-direction:column; }
    .header { background:#1e1e1e; padding:14px 16px; font-weight:700; text-align:center; }
    .ctx { background:#111; border-top:1px solid #222; border-bottom:1px solid #222; }
    .ctx-head { display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 14px; flex-wrap:wrap; }
    .ctx-head strong { font-size:14px; }
    .ctx-head .actions { display:flex; gap:8px; }
    button { background:var(--btn); color:var(--white); border:0; border-radius:8px; padding:8px 12px; cursor:pointer; }
    button:hover { opacity:.9; }
    .muted { color:var(--muted); font-size:12px; }
    pre { margin:14px 12px; padding:10px; background:#0d0d0d; border:1px solid #222; border-radius:8px; white-space:pre-wrap; max-height:220px; overflow:auto; }
    .spacer { flex:1; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">üß† SmartWerk AI Assistant</div>

    <!-- –ü–∞–Ω–µ–ª—å –∫–æ–Ω—Ç–µ–∫—Å—Ç—É -->
    <div id="ctx-wrap" class="ctx" style="display:none">
      <div class="ctx-head">
        <div>
          <strong>SmartWerk: loaded latest calculation context</strong>
          <div class="muted">–¶–µ–π —Ç–µ–∫—Å—Ç –±—É–¥–µ –∫–æ—Ä–∏—Å–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç–∏ —è–∫ –ø–µ—Ä—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É —á–∞—Ç.</div>
        </div>
        <div class="actions">
          <button id="copyCtx">Copy</button>
          <button id="clearCtx">Clear</button>
        </div>
      </div>
      <pre id="ctx-text"></pre>
    </div>

    <div class="spacer"></div>
  </div>

  <!-- Chatbase embed (–ø–ª–∞–≤–∞—é—á–∞ ¬´–±—É–ª—å–±–∞—à–∫–∞¬ª —á–∞—Ç—É) -->
  <script>
    window.embeddedChatbotConfig = {
      chatbotId: "uy7T8ni8hKnK8A2Hb3on1s",
      domain: "www.chatbase.co"
    };
  </script>
  <script src="https://www.chatbase.co/embed.min.js"
          chatbotId="uy7T8ni8hKnK8A2Hb3on1s"
          domain="www.chatbase.co"
          defer></script>

  <script>
    // 1) –ó—á–∏—Ç—É—î–º–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç —ñ–∑ localStorage (–π–æ–≥–æ –∫–ª–∞–¥–µ–º–æ –∑ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞)
    const ctxRaw = localStorage.getItem('smartwerk_chat_context');
    let ctx = null;
    try { ctx = ctxRaw ? JSON.parse(ctxRaw) : null; } catch { ctx = null; }

    // 2) –§–æ—Ä–º—É—î–º–æ –∫–æ—Ä–æ—Ç–∫–µ —Ä–µ–∑—é–º–µ, —è–∫—â–æ –≥–æ—Ç–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç—É –Ω–µ–º–∞—î
    function makeSummaryText(c){
      if (!c) return '';
      if (c.textSummary) return String(c.textSummary).trim();

      const L = [];
      const t = c.results || {};
      if (c.period)   L.push(`Period: ${c.period}`);
      if (c.hoursWorked!=null || c.hourlyRate!=null || c.income!=null){
        L.push(`Hours: ${c.hoursWorked ?? ''}, Rate: ‚Ç¨${c.hourlyRate ?? ''}, Income: ‚Ç¨${c.income ?? ''}`);
      }
      if (t){
        L.push(
          `Gross: ‚Ç¨${t.grossIncome ?? '0.00'}, Expenses: ‚Ç¨${t.totalExpenses ?? '0.00'}, ` +
          `Taxable: ‚Ç¨${t.taxableProfit ?? '0.00'}, ZZP: ‚Ç¨${t.zzpDeductions ?? '0.00'}, ` +
          `MKB: ‚Ç¨${t.mkbVrijstelling ?? '0.00'}, Final Taxable: ‚Ç¨${t.finalTaxable ?? '0.00'}, ` +
          `Income Tax: ‚Ç¨${t.incomeTax ?? '0.00'}, ZVW: ‚Ç¨${t.zvwAmount ?? '0.00'}, BTW: ‚Ç¨${t.btwAmount ?? '0.00'}, ` +
          `Total Tax: ‚Ç¨${t.totalTax ?? '0.00'}`
        );
      }
      if (c.reportingNotes) L.push(`Notes: ${c.reportingNotes}`);
      return L.join('\n');
    }

    // 3) –ü–æ–∫–∞–∑—É—î–º–æ –ø–∞–Ω–µ–ª—å (–∞–±–æ —Ö–æ–≤–∞—î–º–æ, —è–∫—â–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –Ω–µ–º–∞—î)
    const wrap = document.getElementById('ctx-wrap');
    const pre  = document.getElementById('ctx-text');
    if (ctx) {
      pre.textContent = makeSummaryText(ctx);
      wrap.style.display = 'block';
    } else {
      wrap.style.display = 'none';
    }

    // 4) Copy
    document.getElementById('copyCtx').addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(pre.textContent || '');
        alert('Summary copied ‚Äî paste it into the chat as first message.');
      } catch {
        alert('Could not copy. Select text and copy manually.');
      }
    });

    // 5) Clear
    document.getElementById('clearCtx').addEventListener('click', () => {
      localStorage.removeItem('smartwerk_chat_context');
      wrap.style.display = 'none';
      pre.textContent = '';
      alert('Context cleared.');
    });
  </script>
</body>
</html>
